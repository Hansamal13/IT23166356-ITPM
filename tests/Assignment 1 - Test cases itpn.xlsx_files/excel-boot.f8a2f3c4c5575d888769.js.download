var Microsoft;!function(){"use strict";var e,t,i,s,o,n={d:function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},r={};n.r(r),n.d(r,{Application:function(){return as},CommandIds:function(){return pe},DocRebootSupportMode:function(){return rs},EventIds:function(){return we},createApplication:function(){return cs},createCancellationToken:function(){return Bi}}),(t=e||(e={}))[t.t=0]="msoulscat_ES_EWAJS",t[t.i=1]="msoulscat_ES_EWAJSGrid",t[t.h=6]="msoulscat_ES_EWAJSChart",t[t.l=202]="msoulscat_MSOSP_FileMenuCommands",t[t.u=220]="msoulscat_MSOSP_AddInCommands",t[t.p=225]="msoulscat_MSOSP_OTelJS",t[t.m=227]="msoulscat_MSOSP_OTelJSInWebWoker",t[t.v=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",t[t._=301]="msoulscat_Wac_WordViewer",t[t.A=306]="msoulscat_Wac_BrowserGeneral",t[t.P=320]="msoulscat_Wac_TaskPane",t[t.F=339]="msoulscat_Wac_OneNoteGeneral",t[t.R=340]="msoulscat_Wac_Ribbon",t[t.U=356]="msoulscat_Wac_WacFeedback",t[t.O=379]="msoulscat_Wac_WopiPendingApplication",t[t.k=383]="msoulscat_Wac_Telemetry",t[t.H=391]="msoulscat_Wac_WacCatchUpActivities",t[t.$=394]="msoulscat_Wac_Dictation",t[t.N=395]="msoulscat_Wac_OneNoteSync",t[t.B=700]="msoulscat_Wac_VisioApp",t[t.J=1601]="msoulscat_OneNoteOnline_EditableCache",t[t.q=800]="msoulscat_Wac_PptAnimation",t[t.j=833]="msoulscat_Wac_PptLive",t[t.K=834]="msoulscat_Wac_PptMWeb",t[t.X=835]="msoulscat_Wac_PptGc2General",t[t.Z=836]="msoulscat_Wac_PptGc2GraphicHost",t[t.Y=837]="msoulscat_Wac_PptGc2Operation",t[t.ee=852]="msoulscat_Wac_PptGc2EditCanvas",t[t.te=844]="msoulscat_Wac_PptDataSync",t[t.ie=848]="msoulscat_Wac_PptFluidRuntime",t[t.se=815]="msoulscat_Wac_PptShape",t[t.oe=817]="msoulscat_Wac_PptSession",t[t.ne=830]="msoulscat_Wac_PptSlideshow",t[t.re=822]="msoulscat_Wac_PptView",t[t.ae=846]="msoulscat_Wac_PptVideos",t[t.ce=1303]="msoulscat_Uci_Insights",t[t.he=2300]="msoulscat_Wac_VersionHistory",t[t.le=302]="msoulscat_Wac_WordPresence",t[t.ue=3e3]="msoulscat_Wac_OAuth",t[t.pe=3005]="msoulscat_Wac_WordVersionHistory",t[t.me=3006]="msoulscat_Wac_LivePersonaCard",t[t.fe=3012]="msoulscat_Wac_CatchUpFlyout",t[t.we=3016]="msoulscat_Wac_WordDesigner",t[t.ge=3021]="msoulscat_Wac_ModernFontPicker",t[t.ve=3027]="msoulscat_Wac_UnifiedUiHost",t[t.Ie=3033]="msoulscat_Wac_EquationTools",t[t.Se=1401]="msoulscat_Osf_Latency",t[t._e=1402]="msoulscat_Osf_Notification",t[t.be=1403]="msoulscat_Osf_Runtime",t[t.Ce=3041]="msoulscat_Wac_AiMaker",t[t.ye=3043]="msoulscat_Wac_AiRewrite",t[t.Te=3044]="msoulscat_Wac_AiInsert",t[t.Ee=3047]="msoulscat_Wac_AiSummarize",t[t.Ae=3048]="msoulscat_Wac_CopilotCompose",t[t.Pe=3049]="msoulscat_Wac_Skittles",t[t.Fe=3050]="msoulscat_Wac_CopilotChat",t[t.Re=3051]="msoulscat_Wac_Syntex",t[t.Ue=3052]="msoulscat_Wac_WireGraph",t[t.Oe=3053]="msoulscat_Wac_CshCopilot",t[t.We=3055]="msoulscat_Wac_CopilotProactiveSummary",t[t.Me=3056]="msoulscat_Wac_CopilotProactiveShared",t[t.xe=3057]="msoulscat_Wac_CopilotCursor",t[t.ke=3059]="msoulscat_Wac_WasmGeneral",t[t.He=3060]="msoulscat_Wac_WasmTextLayout",t[t.$e=3061]="msoulscat_Wac_WasmSmartArt",t[t.Ne=3062]="msoulscat_Wac_WasmClient",t[t.De=3063]="msoulscat_Wac_WasmNative",t[t.Le=3068]="msoulscat_Wac_UniversalPrint",t[t.Ve=4e3]="msoulscat_AIHub_CreateModuleTelemetry",t[t.Be=4001]="msoulscat_AIHub_CreateModuleAugloop",t[t.Je=4002]="msoulscat_AIHub_CreateModuleDAS",t[t.Ge=4003]="msoulscat_AIHub_CreateModuleConfig",t[t.qe=4004]="msoulscat_AIHub_CreateModuleContext",t[t.ze=4005]="msoulscat_AIHub_CreateModuleGraph",t[t.je=4006]="msoulscat_AIHub_CreateModuleExperiences",t[t.Ke=4007]="msoulscat_AIHub_CreateModuleHttp",t[t.Xe=4008]="msoulscat_AIHub_CreateModuleRouting",t[t.Ze=4009]="msoulscat_AIHub_CreateModuleStorage",t[t.Qe=4010]="msoulscat_AIHub_CreateModuleStore",t[t.Ye=4011]="msoulscat_AIHub_CreateModuleUI",t[t.et=4012]="msoulscat_AIHub_CreateModuleSharePoint",t[t.tt=4013]="msoulscat_AIHub_CreateModuleLicensing",t[t.st=4100]="msoulscat_AIHub_CreateModuleUI_Artifacts",t[t.ot=4101]="msoulscat_AIHub_CreateModuleUI_BrandKit",t[t.nt=4102]="msoulscat_AIHub_CreateModuleUI_Forms",t[t.rt=4103]="msoulscat_AIHub_CreateModuleUI_Homepage",t[t.ct=4104]="msoulscat_AIHub_CreateModuleUI_Text",t[t.ht=4105]="msoulscat_AIHub_CreateModuleUI_Video",(s=i||(i={}))[s.Error=10]="Error",s[s.Warning=15]="Warning",s[s.Important=20]="Important",s[s.Info=50]="Info",s[s.Verbose=100]="Verbose",s[s.Spam=200]="Spam",function(e){e[e.Firefox=0]="Firefox",e[e.Opera=1]="Opera",e[e.IE=2]="IE",e[e.Edge=3]="Edge",e[e.Chrome=4]="Chrome",e[e.Safari=5]="Safari",e[e.TeamsElectron=6]="TeamsElectron",e[e.AndroidWebView=7]="AndroidWebView",e[e.Unknown=8]="Unknown"}(o||(o={}));const a=window.navigator,c=a?a.userAgent:void 0;function h(){if(c){if(c.indexOf("Firefox")>-1)return o.Firefox;if(c.indexOf("Opera")>-1||c.indexOf("OPR")>-1)return o.Opera;if(c.indexOf("Trident")>-1)return o.IE;if(c.indexOf("Electron")>-1&&c.indexOf("Teams")>-1)return o.TeamsElectron;if(c.indexOf("Android")>-1&&c.indexOf("wv")>-1)return o.AndroidWebView;if(c.indexOf("Edg")>-1)return o.Edge;if(c.indexOf("Chrome")>-1)return o.Chrome;if(c.indexOf("Safari")>-1)return o.Safari}return o.Unknown}function l(){try{return!!c&&c.indexOf("iPad")>=0||!!c&&c.indexOf("Macintosh")>=0&&m()&&!(c&&c.indexOf("iPhone")>=0)||!!c&&c.indexOf("Android")>=0||m()}catch{return!1}}function d(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch{return!1}}function u(){return h()===o.IE&&!(h()===o.IE&&null!=document.documentMode&&void 0!==document.documentMode&&document.documentMode>=11)}function p(){try{return window.external&&window.external.getHostEnvironmentValue&&'{"os-sku":"189"}'===window.external.getHostEnvironmentValue("os-sku")}catch(e){return!1}}function m(){return!!a&&a.maxTouchPoints>0}const f=["eurppc"],w="RemoteUls.ashx",g="RemoteTelemetry.ashx";function v(e){return 8===e.toLowerCase().indexOf("ffc")}function I(e){return 8===e.toLowerCase().indexOf("ppc")}function S(e){const t=e.match(/^https:\/\/((?!word)\w+)(-\w+)+\..*$/i);return t&&t[1]?t[1]:"public"}function _(e,t){if(!t||-1===f.indexOf(t.toLowerCase()))return e;const i=e.match(/(^http[s]:\/\/)((?!word)\w*[-])?(.*)/i);return i?`${i[1]}${t}-${i[3]}`:e}function b(e){const t=e.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!t)throw new Error("Invalid URL");return t[1]}function C(e,t){const i=e.match(/^(.*?\/\/)([^\/:]+)(.*)$/);if(!i)throw new Error("Invalid URL");const s=i[2];if(void 0===t)return s;if(t<0)throw new Error("subDomainParts should be at least 1");return s.split(".").slice(-(t+1)).join(".")}function y(e,t,i){i&&(e[t.toLowerCase()]=i)}function T(e,t){e[t.toLowerCase()]=""}function E(e,t){const i=e.toLowerCase(),s=t.toLowerCase();let o=i.indexOf("&"+s+"=");if(-1===o&&(o=i.indexOf("?"+s+"=")),-1===o)return"";const n=o+(t.length+2),r=e.indexOf("&",n);return e.substring(n,-1===r?void 0:r)}function A(e,t,i,s){if(!i)return e;let o=e;const n=o.indexOf("?");let r="&";n===o.length-1||"&"===o.slice(-1)||"&>"===o.slice(-2)?r="":-1===n&&(r="?");const a=t.toLowerCase()+"=",c=new RegExp("\\W"+a,"i").exec(o);if("?"!==r&&c){if(s){const e=c.index+1,t=o.indexOf("&",e);o=o.substring(0,e)+a+i+(-1===t?"":o.substring(t))}return o}return o.concat(r,a,i)}function P(e){const t={},i=e.indexOf("?");return-1===i||i===e.length-1||e.substring(i+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach((e=>{if(e){const i=e.indexOf("=");-1!==i&&i!==e.length-1&&(t[e.substring(0,i).toLowerCase()]=e.substring(i+1))}})),t}function F(e,t){if(!e)return e;let i=e;const s=i.indexOf("?"),o=t.toLowerCase()+"=",n=i.toLowerCase().indexOf(o,s);if(n>=0){const e=i.indexOf("&",n);return i=i.substring(0,n)+(-1===e?"":i.substring(e+1)),"&"===i.slice(-1)&&(i=i.slice(0,-1)),i}return e}function R(e){if(!e)return"";const t=-1===e.indexOf("#")?e.length:e.indexOf("#");let i=e.lastIndexOf("/",t);if(-1!==i&&i+1===e.indexOf("://")+3)return"";i+=1;let s=e.indexOf("?");if(s=s>=t?-1:s,-1!==s&&i>s)return"";const o=-1===s?t:s;return i>=o?"":e.substring(i,o)}function U(e){const t=new RegExp("(c[1-5])h?(-)");return e.replace(t,"$1h$2")}function O(e,t,i){const s=new RegExp("[?&]"+t+"=("+(i||"1")+")\\b","i"),o=e.match(s);return!(!o||i&&o[1]!==i)}function W(e,t){const i=E(e,t);return i?decodeURI(i):i}function M(e){return e?e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0]:""}function x(t,s){return{shouldPreload:(e,i,s)=>t(e,i,s),preload:(t,o,n,r)=>{s(t,o,r,n).forEach((t=>{!function(t,s,o,n,r){const a=document.createElement("link");if(a.setAttribute("crossorigin","anonymous"),a.rel=k,a.href=t,s){const o=R(t);s.ULS.lt(561059910,e.O,i.Info,`Preloading resource: ${o}`);const n=()=>{s.ULS.lt(561059911,e.O,i.Error,`Resource failed to load: ${o}`)};a.addEventListener("error",n)}a.setAttribute("as","script"),n&&a.setAttribute("integrity",n),document.head.appendChild(a)}(t[0],n,0,t[1])}))}}}const k=function(){const e=h();return e===o.Firefox||e===o.IE?"prefetch":"preload"}(),H={en:"1033",cs:"1029",da:"1030",de:"1031",el:"1032",fi:"1035",fr:"1036",hu:"1038",it:"1040",ja:"1041",ko:"1042",nl:"1043",nb:"1044",sk:"1051",sv:"1053",tr:"1055",uk:"1058",sl:"1060",es:"3082",pl:"1045",ro:"1048",ru:"1049"};function $(e=!1,t){return{shouldPreconnect:e=>N&&(!t||t(e)),preconnect:t=>function(e){const t=document.createElement("link");t.rel="preconnect",t.href=e,t.crossOrigin="anonymous",document.head.appendChild(t)}(e?U(t):t)}}const N=!0;var D;function L(e,t,i){if(!t)return;const s=window.navigator;if(s&&s.sendBeacon)try{return void s.sendBeacon(t,e)}catch{}!function(e,t,i){const s=new XMLHttpRequest;s.readyState!==XMLHttpRequest.UNSENT&&s.readyState!==XMLHttpRequest.DONE||(s.open("POST",t,i),s.send(e))}(e,t,i)}!function(e){e.Unknown="UNKNOWN",e.Initialized="INITIALIZED",e.Prebooted="PREBOOTED",e.Booting="BOOTING",e.Booted="BOOTED",e.Failed="FAILED",e.Disposing="DISPOSING",e.Disposed="DISPOSED"}(D||(D={}));const V={BUILD_NUMBER:"###VERSION###",BUILD_NUMBER_MINOR:-1};function B(){try{return V.BUILD_NUMBER}catch(e){return V.BUILD_NUMBER}}const J=".min";var G,q;function z(e,t,i){!function(e,t,i,s=!0){const o={type:t.toString(),payloadJson:JSON.stringify(i)};L(JSON.stringify(o),e,s)}(e,G.JSAPI_STATE,{application:t,build:B(),state:i})}!function(e){e.JSAPI_STATE="JSAPI_STATE",e.H_V2="H_V2"}(G||(G={})),function(e){e[e.Trace=0]="Trace",e[e.Assert=1]="Assert"}(q||(q={}));const j=1e3;function K(){return window.performance.now()}function X(){return Math.round(window.performance.now()+window.performance.timeOrigin)}class Z{getTimeSpentLogging(){return this.dt}addLoggingTime(e){this.dt+=e}configure(e){const t=K();if(e.uploadCadenceInMs&&(this.ut=e.uploadCadenceInMs),e.uploadTriggerSize&&(this.ft=e.uploadTriggerSize),e.sessionId&&(this.wt=e.sessionId),e.remoteUlsEndpoint){if(!e.sessionId&&this.gt)throw new Error("Remote ULS endpoint is already set");this.gt=this.vt(e.remoteUlsEndpoint),this.It=X(),this.St()}this.dt+=K()-t}handleTrace(e){const t=K();e.message.length>3072&&(e.message=e.message.substring(0,3059)+"... [Trimmed]"),this._t.push(e),(this._t.length>this.ft||e.level===i.Error)&&this.St(),this.dt+=K()-t}getUserSessionId(){return this.wt}constructor(e){this.ut=3e4,this.ft=30,this.bt=0,this._t=[],this.It=X(),this.Ct=[],this.wt="",this.dt=0,this.flushOnClose=()=>{this.yt(!1,!1)},this.flush=()=>{this.St()},this.flushAndSetNewEndpoint=(e,t)=>{const i=this.vt(e);i.localeCompare(this.gt??"",void 0,{sensitivity:"accent"})&&(this.Ct.push((()=>{this.gt=i,t&&t()})),this.yt(!0,!0))},this.updateEndpointAndFlush=e=>{this.gt=this.vt(e),this.yt(!0,!0)},this.vt=e=>e+"?usid="+this.wt+"&officeserverversion="+B(),this.St=()=>{window.setTimeout((()=>this.yt(!0,!0)),0)},this.yt=(e,t)=>{const i=K();window.clearTimeout(this.Tt),this.gt&&(this._t.length>0&&(this.bt+=1,L(function(e,t,i,s){const o=[],n=e.map((e=>function(e,t,i){const s={};if(s.G=e.tag,s.T=e.timestamp-t,s.M=e.message,s.C=e.category,e.correlationId){let t=i.findIndex((t=>t===e.correlationId));t<0&&(t=i.push(e.correlationId)-1),s.I=t}const o=e.type*j+e.level;return s.D=o,s}(e,s,o))),r=function(e,t,i,s,o){const n={};return n.T=e,n.L=t,n.S=i,n.I=s,o&&o.length>0&&(n.W=o),n.V=1,n}(s,n,t,i,o);return JSON.stringify(r)}(this._t.splice(0,e?this.ft:this._t.length),this.wt,this.bt,this.It),this.gt,t),this.It=X()),0===this._t.length&&this.Ct.length>0&&(this.Ct.forEach((e=>{"requestIdleCallback"in window?window.requestIdleCallback(e):window.setTimeout(e,0)})),this.Ct=[]),e&&(this.Tt=window.setTimeout((()=>{this.St()}),this._t.length>this.ft||this.Ct.length>0?1e3:this.ut)),this.dt+=K()-i)},e&&this.configure(e)}}let Q,Y=[];var ee,te,ie;function se(e){const t=new Z(e);function s(e,i,s,o){const n=K();if(function(e){return 1===Y[e]}(e))return;const r={timestamp:X(),category:i,tag:e,level:s,type:q.Trace,message:o,correlationId:""};t.addLoggingTime(K()-n),t.handleTrace(r)}return{ULS:{lt:(e,t,i,o)=>{s(e,t,i,o)},shipAssertTag:(e,t,o,n)=>{o&&s(e,t,i.Error,n)},debugAssertTag:(e,t,i,s)=>{throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:t.flush,flushOnClose:t.flushOnClose,setCorrelationId:()=>{}},configure:e=>{t.configure(e)},settingsChangeHandler:e=>{var i,s;i=e.Et.getValue(ee.At,""),s=e.Et.getValue(ee.Pt,""),Q&&s===Q||(Y=[],Q=s,i&&i.split(",").forEach((e=>{const t=parseInt(e,10);t&&(Y[t]=1)}))),t.configure({uploadCadenceInMs:e.Et.getValue(ee.Ft,6e4)});const o=e.Et.getValue(ee.Rt,"").toString();""!==o&&t.flushAndSetNewEndpoint(o)},getTimeSpentLogging:()=>t.getTimeSpentLogging(),getUserSessionId:()=>t.getUserSessionId(),flushAndSetNewEndpoint:(e,i)=>{t.flushAndSetNewEndpoint(e,i)},updateEndpointAndFlush:e=>{t.updateEndpointAndFlush(e)}}}function oe(e){if(e){const t=e.lastIndexOf(".");if(-1!==t)return e.substring(t+1).toLowerCase()}return""}function ne(e){if(!e)return"";const t=Object.getOwnPropertyNames(e),i=Object.getOwnPropertyNames(Object.getPrototypeOf(e));return JSON.stringify(e,[...t,...i])}function re(t,s){return{isFeatureEnabled:o=>function(t,s,o){if(s)try{return s(t)}catch(t){o&&o.ULS.lt(594883024,e.O,i.Error,"IsFeatureEnabled callback error: "+ne(t))}}(o,t,s)}}function ae(e,t){const i={};if(Object.keys(ie).forEach((t=>{const s=e.isFeatureEnabled(ie[t]);void 0!==s&&(i[ie[t]]=s?"1":"0")})),t&&t.wdFlights){const e=t.wdFlights.toLowerCase();for(const t of e.split(","))"et-treatment"!==t&&"et-control"!==t||(i[ie.Ut]="et-treatment"===t?"1":"0")}return JSON.stringify(i)}(te=ee||(ee={})).Ot="BootstrapperMaxUlsHeartbeatTime",te.Wt="BootstrapperNoCompleteWarning1Time",te.Mt="BootstrapperNoCompleteWarning2Time",te.xt="BootstrapperNoCompleteWarning3Time",te.Pt="RemoteUlsETag",te.At="RemoteUlsSuppressions",te.kt="BootstrapperSettingsFetchPeriod",te.Ht="timestamp",te.$t="BootstrapperUlsHeartbeatIntervalMs",te.Nt="BootstrapperUlsHeartBeatIsEnabled",te.Ft="BootstrapperUlsUploadCadenceMs",te.Dt="RequestedCallThrottlingDefaultToViewMinimumValue",te.Rt="BulsEndpointUrl",te.Lt="EnableCommonHostDiagnosticsParams",te.Vt="EnableICNForWord",te.Bt="EnableModernEmbedViewForPowerPoint",te.Jt="EnableModernEmbedViewInOneUpForPowerPoint",te.Gt="EnableModernEmbedViewForPowerPointGlobalAppUrl",te.qt="EnableModernReadingViewForPowerPoint",te.zt="EnableModernViewForPowerPointIPad",te.jt="EnableEarlyFormSubmitMWeb",te.Kt="EnableIpadAndTabletRedirection",te.Xt="EnableM365IpadRedirection",te.Zt="EnablePassingCustomFontCatalogToViewer",te.Qt="EnableDefaultToModernForPowerPoint",te.Yt="ShouldLogJsApiKpisForWord",te.ei="WordSwitchToViewInTeamsJsapiV1Enabled",te.ti="EnableWordSessionRefreshTelemetry",te.ii="PowerPointUseEssDCHint",te.si="PowerPointUseAFDSupportedEssDCHint",te.oi="PowerPointEnableControl24DCsExcludeFromESS",te.ni="PowerPointListOfControl24DCsExcludedFromESS",te.ri="ModernEmbedViewBootstrapperFeatureGatesForPowerPoint",te.ai="ModernReadingViewBootstrapperFeatureGatesForPowerPoint",te.ci="ModernEmbedViewForPowerPointEnabledPercentage",te.hi="PowerPointESSCookieLookbackThresholdHour",te.li="PowerPointSetESSCookieLookbackExpEnabled",te.di="ExcelForceViewOnlyInTeamsJsapiV1",te.pi="EnableWordSessionRefreshLoggingCleanup",te.mi="WordRefreshTelemetryExpirationInDays",te.wi="IsSpoSandboxFixEnabled",te.gi="WordConsumptionViewToEditRedirectIsEnabled",te.vi="WordEditorBizchatSideBySideUnifiedReadIsEnabled",te.Ii="IPadPreviewerExpEnabled",te.Si="MwacWordEditorExperimentExperienceIsEnabled",te._i="IPadTeamsPreviewerEnabled",te.bi="IPadOutlookPreviewerEnabled",te.Ci="IPadOneDrivePreviewerEnabled",te.yi="IPadM365PreviewerEnabled",function(e){e.Ut="EnterpriseTemplates",e.Ti="ExcelAdaptiveLayoutDownload",e.Ei="ExcelLandingPageOfflineTelemetry",e.Ai="ExcelLandingPageObserverRetry",e.Pi="H2StaticContent",e.Fi="HashedUrl",e.Ri="ODCShareLinkPreload",e.Ui="OfficeComExcelJsApiV2",e.Oi="OfficeComPptJsApiV2",e.Wi="OfficeComUiHost",e.Mi="OfficeComWordJsApiV2",e.xi="OfficeHwaUiHost",e.ki="OfficeUnifiedUiHostTeams",e.Hi="WordViewToUnifiedRead",e.$i="DocAspxMsalLoad",e.Ni="WordWebInteractiveReadOnlyMode"}(ie||(ie={}));class ce{add(e){e&&this.Di.push(e)}remove(e){if(!e)return;const t=this.Di.indexOf(e);t>-1&&this.Di.splice(t,1)}removeAll(){this.Di=[]}dispatch(e,t){this.Di.forEach((i=>{try{i(e)}catch(e){t&&t(e)}}))}constructor(){this.Di=[]}}const he="Prod",le="Settings";class de{updateEnvironment(e){this.Li=(v(e)?"FF":he)+this.Vi+le,this.Bi()}initializePeriodicFetch(e,t){this.Li=(v(e)?"FF":he)+this.Vi+le,this.Bi(),this.Ji=e+"AppSettingsHandler.ashx?app="+this.Vi+"&usid="+t+"&build="+B(),this.Gi||(this.Gi=window.setTimeout(this.qi,3e4))}getValue(e,t){if(this.zi||this.Bi(),!this.zi||!this.zi.hasOwnProperty(e))return t;const i=this.zi[e],s=typeof t;if(typeof i===s)return i;if("string"==typeof i){if("number"===s)return parseInt(i,10);if("boolean"===s)return"true"===i}return t}addSettingsChangeListener(e){this.ji.add(e)}removeSettingsChangeListener(e){this.ji.remove(e)}dispose(){this.Gi&&window.clearTimeout(this.Gi),this.Ki&&self.cancelIdleCallback(this.Ki),this.Gi=void 0,this.Ki=void 0,this.zi=void 0,this.ji.removeAll()}constructor(t,s){this.Xi=0,this.Bi=()=>{try{if(!window||!window.localStorage)return;const e=window.localStorage.getItem(this.Li);if(!e)return;const t=JSON.parse(e);this.Zi(t)}catch(t){this.Qi.ULS.lt(592836768,e.O,i.Warning,"Failed to get settings from localStorage: "+ne(t))}},this.Zi=t=>!!this.Yi(t)&&(this.zi=t,this.ji.dispatch({Et:this},(t=>{this.Qi.ULS.lt(592836769,e.O,i.Error,"Settings listener error: "+ne(t))})),!0),this.Yi=t=>{if(t&&"object"==typeof t){if(t.hasOwnProperty(ee.Ht)&&!isNaN(t.timestamp))return!0;this.Qi.ULS.lt(592836770,e.O,i.Error,"Received invalid settings")}return!1},this.qi=()=>{if(!this.Ji)return;const t=new XMLHttpRequest;window.location.href.indexOf("wdnetcorerouting=true")>-1?t.setRequestHeader("X-NetCoreRouting","true"):window.location.href.indexOf("wdnetcorerouting=false")>-1&&t.setRequestHeader("X-NetCoreRouting","false"),t.open("GET",this.Ji),t.responseType="json",t.timeout=5e3,t.send(),t.onload=()=>{if(200===t.status&&t.response?(this.ts(t.response),this.Xi=0):(this.Qi.ULS.lt(592836771,e.O,i.Error,`Fetch settings error. Status: ${t.status}, curErrors: ${this.Xi}`),this.Xi+=1),this.Xi>7)return;let s=this.getValue(ee.kt,3e5);this.Xi>3&&(s+=(this.Xi-3+1)*(s/2)),this.Gi=window.setTimeout(this.qi,s)}},this.ts=e=>{"requestIdleCallback"in window?(this.Ki&&self.cancelIdleCallback(this.Ki),this.Ki=window.requestIdleCallback((()=>this.ss(e)),{timeout:1e4})):window.setTimeout((()=>this.ss(e)),0)},this.ss=t=>{if(!this.Zi(t)||!window||!window.localStorage)return;const s=JSON.stringify(t);try{window.localStorage.setItem(this.Li,s)}catch(t){this.Qi.ULS.lt(592836800,e.O,i.Warning,"Failed to set localStorage: "+ne(t))}},this.Vi=t,this.Li=he+t+le,this.Qi=s,this.ji=new ce,this.Bi()}}var ue,pe,me,fe,we;!function(e){e.appReboot="appReboot",e.boot="boot",e.closeTab="closeTab",e.createNew="createNew",e.dispose="dispose",e.frameTrust="frameTrust",e.getAuthToken="getAuthToken",e.getHostKeyValue="getHostKeyValue",e.handleBootState="handleBootState",e.postWacToken="postWacToken",e.rename="rename",e.setOverlayContent="setOverlayContent",e.storeHostKeyValue="storeHostKeyValue",e.switchMode="switchMode",e.updateBootComplete="updateBootComplete",e.setWacFlightValue="setWacFlightValue"}(ue||(ue={})),function(e){e.blurFocus="blurFocus",e.boot="boot",e.completeCreateNew="completeCreateNew",e.continueAccessibilityLoop="continueAccessibilityLoop",e.createNew="createNew",e.dispose="dispose",e.grabFocus="grabFocus",e.moveToFolder="moveToFolder",e.popState="popState",e.sendChannelId="sendChannelId",e.sendConvId="sendConvId",e.teamsUsersReply="teamsUsersReply",e.teamsUserMentionReply="teamsUserMentionReply",e.backButtonPressed="backButtonPressed",e.searchInvoked="searchInvoked",e.bootInterrupted="bootInterrupted",e.getClientUrl="getClientUrl",e.getWebUrl="getWebUrl",e.rename="rename",e.completeSharedFilePicker="completeSharedFilePicker",e.sendAccessToken="sendAccessToken",e.sendAuthToken="sendAuthToken",e.sendCustomAuthConfig="sendCustomAuthConfig",e.sendEmbeddedViewUrl="sendEmbeddedViewUrl",e.sendFrameTrustResult="sendFrameTrustResult",e.sendHWRTelemetry="sendHWRTelemetry",e.sendSessionInfo="sendSessionInfo",e.sendUserAccessAndPermissions="sendUserAccessAndPermissions",e.sendWopiInfo="sendWopiInfo",e.sendDavUrl="sendDavUrl",e.switchMode="switchMode",e.signalShared="signalShared",e.postWacToken="postWacToken"}(pe||(pe={})),function(e){e.os="App_AccessibilityLoopComplete",e.ns="Wac_ActionComplete",e.hs="WacInitialize_Ready",e.ls="Wac_AppFailed",e.ds="Wac_AppBootState",e.us="Wac_AppCompleted",e.ps="BrowserEvent",e.fs="UI_Close",e.ws="App_CloseTab",e.gs="UI_Conversation",e.vs="UI_CopyAndEdit",e.Is="App_CreateNewDocument",e.Ss="Wac_AppDataSavedStatus",e._s="UI_Download",e.bs="UI_PreDownloadFileInClient",e.Cs="UI_Edit",e.ys="Error",e.Ts="UI_FileEmbed",e.Es="UI_FileProperties",e.As="File_Rename",e.Ps="File_RenameFailed",e.Fs="UI_FileVersions",e.Rs="StateChanged",e.Us="App_IsFrameTrusted",e.Os="GetAccessToken",e.Ws="App_GetAuthToken",e.Ms="App_GetCustomAuthConfig",e.xs="App_GetHostKeyValue",e.ks="App_WopiInfoFromUrl",e.Hs="App_DavUrlFromIds",e.$s="App_LoadingStatus",e.Ns="App_SwitchMode",e.Ds="App_MoveToFolder",e.Ls="UI_OpenInMobileApp",e.Vs="UI_OpenInBrowser",e.Bs="UI_OpenInClient",e.Js="PageChanged",e.Gs="App_PushCommentContext",e.qs="App_PushState",e.zs="App_DocReboot",e.js="UI_RedeemForCommenting",e.Ks="App_RefreshSessionInfo",e.Xs="UI_ReplyWithChanges",e.Zs="UI_ReportAbuse",e.Qs="App_FilePicker",e.Ys="UI_SaveStatus",e.eo="WopiSession_Complete_Ack",e.io="SetOverlayContent",e.so="UI_Sharing",e.oo="UI_ShareForm",e.no="UI_SignIn",e.ao="App_StoreHostKeyValue",e.co="App_Unloaded",e.ho="App_UlsLog",e.lo="Wac_UnloadingApp",e.do="App_UpdateBootComplete",e.uo="PageCount",e.po="UI_CheckUserAccessAndGrantPermissions",e.mo="User_Activity",e.fo="Edit_Notification",e.wo="UI_Workflow",e.vo="ZoomChanged",e.Io="CAAEMessage",e.So="Excel_HostFrameCacheSave",e._o="Excel_HostFrameCacheEvict",e.bo="Excel_RegenerateFileBundle",e.Co="App_SwitchToWacFrame",e.yo="App_SaveSSRData",e.To="App_PurgeDataInHostCache",e.Eo="App_SaveHostRenderingV2Data",e.Ao="App_SaveHostUtilsData",e.Po="AcquireOAuthTokenTeams",e.Fo="App_SwitchNotebook",e.Ro="FailedBoot_CheckFileInfo",e.Uo="GetTeamsUsers",e.Oo="SendTeamsUserMention",e.Wo="NavigateBackToHost",e.Mo="App_GetClientUrlComplete",e.xo="App_GetWebUrlComplete",e.Ho="App_CopyLinkComplete",e.$o="App_SendConversationId",e.No="CloseTeamsConversation",e.Do="PageLoaded",e.Lo="Visio_BRS",e.Vo="Visio_SendLicenseInfo",e.Bo="Visio_Consumption_CLTComplete",e.Jo="Visio_SwitchMode_FromViewFrame",e.Go="Visio_ModeSwitch_ToHost_Ack",e.qo="Visio_UpdateEditUrl",e.zo="Visio_PageViewLoaded",e.jo="Visio_ActiveAppFrameLoadFailed",e.Ko="Visio_DisposeBkgFrame",e.Xo="Visio_ReadyToReceiveDocData",e.Zo="Visio_DocReboot_HostNav",e.Qo="Visio_SwitchToVisioFrame",e.Yo="WacAppPerfMetric",e.tn="App_ModifyURLState",e.sn="App_WacTokenAck",e.on="App_InitEnd",e.nn="App_SplashScreenShown",e.rn="App_SetWacFlightValue",e.an="App_PrintRedirect",e.cn="App_RequestFullScreen",e.hn="App_ShowCopilotBottomBar",e.ln="UI_ExternalDocumentShare",e.dn="AddNAATrustedOrigins"}(me||(me={})),function(e){e.un="Ack",e.pn="WacInitialize_Ready_Ack",e.mn="Wac_BeforeUnloadApp",e.fn="Blur_Focus",e.wn="Wac_AppFailed_Ack",e.gn="Wac_AppCompleted_Ack",e.vn="WopiStartSession_Complete",e.In="WopiPendingSession_Complete",e.Sn="Host_AccessibilityLoopComplete",e.Us="Host_IsFrameTrusted",e._n="Grab_Focus",e.bn="HostCacheDiagnostic",e.Cn="Host_KeyValue",e.yn="JsApiDiagnostics",e.Ds="Host_MoveToFolder",e.Tn="PageChanged_Ack",e.En="App_PopState",e.An="Host_SendChannelId",e.Pn="Host_SendConversationId",e.Fn="GetTeamsUsers_Reply",e.Rn="SendTeamsUserMention_Reply",e.Un="Host_BackButtonPressed",e.On="Host_SearchInvoked",e.Wn="BootInterrupted",e.Mn="Host_GetClientUrl",e.xn="Host_GetWebUrl",e.kn="File_Rename",e.Qs="Host_FilePicker",e.Hn="PostAccessToken",e.$n="Host_SetAuthToken",e.Nn="Host_SetCustomAuthConfig",e.Dn="App_PushCommentContext",e.Ln="CanEmbed",e.Vn="Host_RefreshSessionInfo",e.Bn="CheckUserAccessAndGrantPermissions_Result",e.Jn="Host_WopiInfoFromUrl",e.Gn="Host_DavUrlFromIds",e.qn="SetCurrentPage",e.zn="SetZoomLevel",e.jn="WopiPendingSession_Fail",e.Kn="SetOverlayContent",e.Xn="WopiPendingApplicationComplete_Received",e.Zn="Host_SwitchMode",e.Qn="Host_Unload",e.Yn="PageCount_Ack",e.er="ZoomChanged_Ack",e.ir="Host_ShareUI",e.sr="Host_Telemetry",e.nr="Visio_ConsumptionCLTComplete_Ack",e.rr="Visio_SwitchMode_FromHF_Ack",e.ar="Visio_SwitchMode_FromHostFrame",e.cr="Visio_FallbackToLegacySwitch",e.hr="Visio_DocumentData",e.lr="Host_PostWacToken"}(fe||(fe={})),function(e){e.AccessibilityLoopCompleted="AccessibilityLoopCompleted",e.ActionCompleted="ActionCompleted",e.BrowserEvent="BrowserEvent",e.CAAEMessage="CAAEMessage",e.Close="Close",e.InitEnd="InitEnd",e.Conversation="Conversation",e.CopyAndEdit="CopyAndEdit",e.CreateNewDocument="CreateNewDocument",e.Download="Download",e.PreDownloadFileInClient="PreDownloadFileInClient",e.Edit="Edit",e.Error="Error",e.FileEmbed="FileEmbed",e.FileProperties="FileProperties",e.FileRenamed="FileRenamed",e.FileVersions="FileVersions",e.FrameStateChanged="FrameStateChanged",e.FrameTrust="FrameTrust",e.GetAccessToken="GetAccessToken",e.GetAuthToken="GetAuthToken",e.GetCustomAuthConfig="GetCustomAuthConfig",e.GetWopiInfoFromUrl="GetWopiInfoFromUrl",e.GetDavUrlFromIds="GetDavUrlFromIds",e.ModeSwitched="ModeSwitched",e.MoveToFolder="MoveToFolder",e.OpenInMobileApp="OpenInMobileApp",e.OpenInBrowser="OpenInBrowser",e.OpenInClient="OpenInClient",e.PageChanged="PageChanged",e.PushState="PushState",e.Reboot="Reboot",e.RedeemForCommenting="RedeemForCommenting",e.RefreshSessionInfo="RefreshSessionInfo",e.ReplyWithChanges="ReplyWithChanges",e.ReportAbuse="ReportAbuse",e.SharedFilePicker="SharedFilePicker",e.SaveStatus="SaveStatus",e.Share="Share",e.ShareForm="ShareForm",e.SignIn="SignIn",e.SplashScreenShown="SplashScreenShown",e.UserAccessAndPermissions="UserAccessAndPermissions",e.UserActivity="UserActivity",e.UserEditActivity="UserEditActivity",e.Workflow="Workflow",e.ZoomChanged="ZoomChanged",e.AcquireOAuthTokenTeams="AcquireOAuthTokenTeams",e.LoadingStatus="LoadingStatus",e.SwitchNotebook="SwitchNotebook",e.FailedBootCheckFileInfo="FailedBootCheckFileInfo",e.GetTeamsUsers="GetTeamsUsers",e.SendTeamsUserMention="SendTeamsUserMention",e.NavigateBackToHost="NavigateBackToHost",e.GetClientUrlComplete="GetClientUrlComplete",e.GetWebUrlComplete="GetWebUrlComplete",e.CopyLinkComplete="CopyLinkComplete",e.SendConversationId="SendConversationId",e.CloseTeamsConversation="CloseTeamsConversation",e.PageLoaded="PageLoaded",e.FrameChanged="FrameChanged",e.PrintRedirect="PrintRedirect",e.RequestFullScreen="RequestFullScreen",e.ShowCopilotBottomBar="ShowCopilotBottomBar",e.ExternalDocumentShare="ExternalDocumentShare",e.AddNAATrustedOrigins="AddNAATrustedOrigins"}(we||(we={}));const ge={[pe.boot]:{dr:ue.boot},[pe.createNew]:{dr:ue.createNew},[pe.dispose]:{dr:ue.dispose},[pe.postWacToken]:{dr:ue.postWacToken},[pe.rename]:{dr:ue.rename},[pe.switchMode]:{dr:ue.switchMode},[me.ds]:{dr:ue.handleBootState},[me.ws]:{dr:ue.closeTab},[me.Us]:{dr:ue.frameTrust},[me.Ws]:{dr:ue.getAuthToken},[me.xs]:{dr:ue.getHostKeyValue},[me.zs]:{dr:ue.appReboot},[me.rn]:{dr:ue.setWacFlightValue},[me.io]:{dr:ue.setOverlayContent},[me.ao]:{dr:ue.storeHostKeyValue},[me.do]:{dr:ue.updateBootComplete},[pe.blurFocus]:{ur:fe.fn},[pe.continueAccessibilityLoop]:{ur:fe.Sn},[pe.grabFocus]:{ur:fe._n},[pe.moveToFolder]:{ur:fe.Ds},[pe.popState]:{ur:fe.En},[pe.sendChannelId]:{ur:fe.An},[pe.sendConvId]:{ur:fe.Pn},[pe.teamsUsersReply]:{ur:fe.Fn},[pe.teamsUserMentionReply]:{ur:fe.Rn},[pe.backButtonPressed]:{ur:fe.Un},[pe.searchInvoked]:{ur:fe.On},[pe.bootInterrupted]:{ur:fe.Wn},[pe.getClientUrl]:{ur:fe.Mn},[pe.getWebUrl]:{ur:fe.xn},[pe.sendAccessToken]:{ur:fe.Hn},[pe.sendAuthToken]:{ur:fe.$n},[pe.sendHWRTelemetry]:{ur:fe.sr},[pe.sendCustomAuthConfig]:{ur:fe.Nn},[pe.sendDavUrl]:{ur:fe.Gn},[pe.sendEmbeddedViewUrl]:{ur:fe.Ln},[pe.sendFrameTrustResult]:{ur:fe.Us},[pe.sendSessionInfo]:{ur:fe.Vn},[pe.sendUserAccessAndPermissions]:{ur:fe.Bn},[pe.sendWopiInfo]:{ur:fe.Jn},[pe.signalShared]:{ur:fe.ir},[pe.completeSharedFilePicker]:{ur:fe.Qs},[me.os]:{pr:we.AccessibilityLoopCompleted},[me.ns]:{pr:we.ActionCompleted},[me.ps]:{pr:we.BrowserEvent},[me.Io]:{pr:we.CAAEMessage},[me.fs]:{pr:we.Close},[me.gs]:{pr:we.Conversation},[me.vs]:{pr:we.CopyAndEdit},[me.Is]:{pr:we.CreateNewDocument},[me._s]:{pr:we.Download},[me.bs]:{pr:we.PreDownloadFileInClient},[me.Cs]:{pr:we.Edit},[me.ys]:{pr:we.Error},[me.Ts]:{pr:we.FileEmbed},[me.Es]:{pr:we.FileProperties},[me.As]:{pr:we.FileRenamed},[me.Fs]:{pr:we.FileVersions},[me.Os]:{pr:we.GetAccessToken},[me.Hs]:{pr:we.GetDavUrlFromIds},[me.Ms]:{pr:we.GetCustomAuthConfig},[me.ks]:{pr:we.GetWopiInfoFromUrl},[me.Rs]:{pr:we.FrameStateChanged},[me.Ns]:{pr:we.ModeSwitched},[me.Ds]:{pr:we.MoveToFolder},[me.Ls]:{pr:we.OpenInMobileApp},[me.Vs]:{pr:we.OpenInBrowser},[me.Bs]:{pr:we.OpenInClient},[me.Js]:{pr:we.PageChanged},[me.qs]:{pr:we.PushState},[me.js]:{pr:we.RedeemForCommenting},[me.Ks]:{pr:we.RefreshSessionInfo},[me.Xs]:{pr:we.ReplyWithChanges},[me.Qs]:{pr:we.SharedFilePicker},[me.Zs]:{pr:we.ReportAbuse},[me.Ys]:{pr:we.SaveStatus},[me.so]:{pr:we.Share},[me.oo]:{pr:we.ShareForm},[me.no]:{pr:we.SignIn},[me.po]:{pr:we.UserAccessAndPermissions},[me.mo]:{pr:we.UserActivity},[me.fo]:{pr:we.UserEditActivity},[me.wo]:{pr:we.Workflow},[me.vo]:{pr:we.ZoomChanged},[me.Po]:{pr:we.AcquireOAuthTokenTeams},[me.$s]:{pr:we.LoadingStatus},[me.Fo]:{pr:we.SwitchNotebook},[me.Ro]:{pr:we.FailedBootCheckFileInfo},[me.Uo]:{pr:we.GetTeamsUsers},[me.Oo]:{pr:we.SendTeamsUserMention},[me.Wo]:{pr:we.NavigateBackToHost},[me.Mo]:{pr:we.GetClientUrlComplete},[me.xo]:{pr:we.GetWebUrlComplete},[me.Ho]:{pr:we.CopyLinkComplete},[me.$o]:{pr:we.SendConversationId},[me.No]:{pr:we.CloseTeamsConversation},[me.Do]:{pr:we.PageLoaded},[me.on]:{pr:we.InitEnd},[me.nn]:{pr:we.SplashScreenShown},[me.an]:{pr:we.PrintRedirect},[me.cn]:{pr:we.RequestFullScreen},[me.hn]:{pr:we.ShowCopilotBottomBar},[me.ln]:{pr:we.ExternalDocumentShare},[me.dn]:{pr:we.AddNAATrustedOrigins}};function ve(){const e=new Uint8Array(31),t=function(e){const t={crypto:!1,perfNow:!1,exceptions:[]},i=window.crypto||window.msCrypto;if(i){t.crypto=!0;try{return i.getRandomValues(e),t}catch(e){t.exceptions.push(`crypto: ${ne(e)}`)}}t.perfNow=!0;for(let i=0;i<e.length;i+=1){try{let e=Math.floor(100*window.performance.now())%10;(e<0||e>9)&&(e=0);for(let t=0;t<e;t+=1)Math.random()}catch(e){t.exceptions.push(`Math.random: ${ne(e)}`)}e[i]=Math.floor(16*Math.random())}return t}(e);let i=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const s=15&e[i];return i+=1,("x"===t?s:3&s|8).toString(16)})),t]}function Ie(t,s){try{if(void 0===window.performance)return void s.ULS.lt(595948609,e.O,i.Info,"Performance not supported");const o=window.performance.getEntriesByType("resource");if(void 0===o||o.length<=0)return void s.ULS.lt(595948610,e.O,i.Info,"No resources under performance");const n=new RegExp(t+"(-boot\\.min|(\\.(app|preview))?\\.boot)(\\.[0-9a-f]{20})?\\.js","i");for(let t=o.length-1;t>=0;t-=1){const r=o[t],a=r.name.match(n);if(a){let t=JSON.stringify(r);return t=t.replace(new RegExp(r.name,"g"),a[0]),void s.ULS.lt(595948616,e.O,i.Info,t)}}s.ULS.lt(595948484,e.O,i.Info,"Could not find JSAPI resource timing entry")}catch(t){s.ULS.lt(595948617,e.O,i.Info,`Could not trace the resource timing: ${ne(t)}`)}}function Se(e){const t={...e.host,sessionId:e.hostSessionId,domain:location?location.host:void 0};delete t.siteId,delete t.webId,delete t.uiHostTabId;const i={};if(e.wdParams){const t=JSON.parse(JSON.stringify(e.wdParams).toLowerCase());["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((e=>{t[e]&&(i[e]=t[e])}));const s=/^\w{8}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{12}$/i;i.wdprevioussession&&!s.test(i.wdprevioussession)&&delete i.wdprevioussession,i.wdpreviouscorrelation&&!s.test(i.wdpreviouscorrelation)&&delete i.wdpreviouscorrelation}const s={...e.rebootOverride};delete s.ackExpected,delete s["ui-language"],delete s.wdUserSession,delete s.rebootMode,delete s.documentUrl;const o=e.wopi;return{accessToken:o?{length:o.accessToken.length,expiry:o.expiry}:"N/A",wacToken:o&&o.wacToken?{length:o.wacToken.length}:void 0,bootParams:e.bootParams,build:B(),host:t,intent:e.intent,jsApiVersion:"v2",rebootOverride:s,region:S(e.appBaseUrl),sessionOrigin:e.hostInitDiagnostics?e.hostInitDiagnostics.entryPoint:void 0,sessionContext:e.sessionContext,throttling:e.throttling,ui:e.ui,viewMode:e.viewMode,meeting:e.meeting?{id:e.meeting?.id,isPresenter:e.meeting?.isPresenter}:void 0,wdParams:i}}function _e(){const e={perfNowSupported:!0,browser:o[h()],touchMode:l(),highContrast:d(),windows10x:p()};try{const t=window.navigator,i=t.connection||t.mozConnection||t.webkitConnection;i&&(e.netOnline=t.onLine,e.netDownlink=i.downlink,e.netDownlinkMax=i.downlinkMax,e.netEffectiveType=i.effectiveType,e.netRtt=i.rtt,e.netSaveData=i.saveData,e.netType=i.type),e.deviceMemory=t.deviceMemory,e.logicalProcessors=t.hardwareConcurrency}catch{}return e}var be;function Ce(e){const t=window.performance.timing;t&&(e.hostPageNavigationStartTime||(e.hostPageNavigationStartTime=t.navigationStart),e.hostPageFetchStartTime||(e.hostPageFetchStartTime=t.fetchStart),e.hostPageRequestStartTime||(e.hostPageRequestStartTime=t.requestStart),e.hostPageResponseStartTime||(e.hostPageResponseStartTime=t.responseStart),e.hostPageResponseEndTime||(e.hostPageResponseEndTime=t.responseEnd),e.hostPageDomCompleteTime||(e.hostPageDomCompleteTime=t.domComplete));const i=window.performance.navigation;if(i&&(void 0===e.hostPageRedirectCount&&(e.hostPageRedirectCount=i.redirectCount),!e.hostPageNavigationType)){let t="UNKNOWN";switch(i.type){case 0:t="NAVIGATE";break;case 1:t="RELOAD";break;case 2:t="BACK_FORWARD";break;case 255:t="RESERVED"}e.hostPageNavigationType=t}}!function(e){e[e.Unknown=0]="Unknown",e[e.Normal=1]="Normal",e[e.Minor=2]="Minor",e[e.Medium=3]="Medium",e[e.Major=4]="Major",e[e.Critical=5]="Critical"}(be||(be={}));class ye{dispose(){window.removeEventListener("beforeunload",this.mr,{capture:!0}),window.removeEventListener("pagehide",this.wr,{capture:!0}),window.removeEventListener("visibilitychange",this.gr,{capture:!0}),window.removeEventListener("unload",this.vr,{capture:!0})}constructor(e,t){this.mr=()=>Te(e,"OnBeforeUnload",t),this.wr=()=>Te(e,"OnPageHide",t),this.gr=()=>Te(e,"VisibilityChange_"+document.visibilityState,t),this.vr=()=>Te(e,"OnUnload",t),window.addEventListener("beforeunload",this.mr,{capture:!0,once:!0}),window.addEventListener("pagehide",this.wr,{capture:!0}),window.addEventListener("visibilitychange",this.gr,{capture:!0}),window.addEventListener("unload",this.vr,{capture:!0,once:!0})}}function Te(t,s,o){t.ULS.lt(595957843,e.O,i.Important,`Page lifecycle: ${s} fired`+(o?", flushing logger":"")),o&&t.ULS.flush()}const Ee=["https://augloop.office.com/v2","api://visio.officeapps.live.com/va/00695ed2-3202-4156-8da1-69f60065e255","394866fc-eedb-4f01-8536-3ff84b16be2a","https://officescripting.microsoft.com","https://officescripting-int.microsoft.com","https://nleditor.osi.office.net/nleditor","https://editor.svc.cloud.microsoft/nleditor","e03a13ee-9730-4cae-8525-47559c8cf18a","https://powerquery.microsoft.com","api://app.powerbi.com/00000009-0000-0000-c000-000000000000","https://immersivereader.cloud.microsoft","https://forms.office.com"],Ae="AddinTrustedOrigin";class Pe{async isResourceTrustedForMessage(t){if(!t||!t.Resource)return!1;const s=t.Resource,o=t.AddinTrustId,n=function(e){if(!e)return!1;const t=e.toLowerCase();for(const e of Ee)if(e===t||`${e}/`===t)return!0;return!1}(s);if(n||!o)return n;if(this.Ir[o])return Fe(s,this.Ir[o]);let r;const a=new Promise((e=>{r=(t,i)=>{o===t&&e(Fe(s,i))},this.Sr.push(r)}));let c=-1;const h=new Promise((t=>{c=window.setTimeout((()=>{this.Qi.ULS.lt(560754786,e.O,i.Warning,`isResourceTrustedForMessage - timeout waiting for addinTrustId: ${o}`),t(!1)}),2e3)})),l=await Promise.race([a,h]);return this.Sr=this.Sr.filter((e=>e!==r)),window.clearTimeout(c),l}dispose(){this.Ir={},this.Sr=[],window.removeEventListener("message",this._r)}constructor(t){this.Ir={},this.Sr=[],this._r=t=>{if(t&&t.origin)try{const s=t.data;if("string"==typeof s&&s.includes(Ae)){const o=JSON.parse(s),n=o.AddinTrustId;n&&o.MessageId===Ae&&(this.Qi.ULS.lt(560754784,e.O,i.Info,`didReceiveMessage addinTrustId ${n}`),this.Ir[n]=t.origin,this.Sr.forEach((e=>{e(n,t.origin)})))}}catch(t){this.Qi.ULS.lt(560754785,e.O,i.Error,"AuthTokenTrustValidator didReceiveMessage failed")}},this.Qi=t,window.addEventListener("message",this._r)}}function Fe(e,t){try{if(!e||!t)return!1;const i=33,s=126,o=/[?&#%\\]/;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<i||n>s)return!1;const r=e.charAt(t);if(o.test(r))return!1}const n="api:",r="https:";let a=e;a.substring(0,n.length).toLowerCase()===n&&(a=`${r}${a.substring(n.length)}`);const c=new URL(a);return c.protocol===r&&t.toLowerCase()===c.origin.toLowerCase()}catch{return!1}}class Re{get diagnostics(){return{hostInitDiagnostics:this.hostInitDiagnostics,appInitDiagnostics:this.appInitDiagnostics}}raiseEvent(t,s){this.logger.ULS.lt(574654541,e.O,i.Info,`Raising event: ${t}`);try{this.br(t,s)}catch(t){this.logger.ULS.lt(593506838,e.O,i.Error,`Event handler error: ${ne(t)}`)}}addActionHandler(e,t){this.Cr[e]||(this.Cr[e]=[]),this.Cr[e].push(t)}removeActionHandler(e,t){const i=this.Cr[e];if(i&&i.length>0){const e=i.indexOf(t);e>-1&&i.splice(e,1)}}run(t,s,o){if(this.state===D.Disposed&&this.backgroundSession)return this.logger.ULS.lt(525203609,e.O,i.Info,`Redirecting to background session: ${t}`),this.backgroundSession.run(t,s,o);const n=[],r=this.Cr[t];if(r&&r.length>0)n.push(this.yr(t,s));else{const r=ge[t];if(r){const a=r.dr,c=r.ur;if(a){this.logger.ULS.lt(574654542,e.O,i.Info,`Running flow: ${a}`);const r=this.Tr[a](t,s,this,this.Er[a],o).catch((e=>(this.Ar(a,e),{completion:"failure",errorSource:"jsapi",error:e})));n.push(r)}else c&&(this.container&&this.container.postMessage(c,s),n.push(Promise.resolve({completion:"success"})))}else n.push(Promise.resolve({completion:"failure"})),this.logger.ULS.lt(593500189,e.O,i.Warning,`Unhandled command: ${t}`)}return Promise.race(n)}dispose(){if(this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.Et.dispose(),this.pageStateObserver.dispose(),this.authTokenTrustValidator.dispose(),this.Cr={},!this.pendingReboot){const e=this.application.sessions,t=e.indexOf(this.session);t>-1&&e.splice(t,1)}}constructor(t,s,o,n,r,a,c){this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.appBootState="Unknown",this.pendingReboot=!1,this.skipWopiValidation=!1,this.skipFileNameCheck=!1,this.appContext={},this.isLoggerFromOwl=!1,this.appUrl="",this.appBaseUrl="",this.appBasePath="",this.remoteTelemetryUrl="",this.Cr={},this.onMessage=t=>{const s=t.MessageId,o=t.Values||{},n=this.Cr[s];if(n&&n.length>0)this.yr(s,o);else{const n=ge[s];if(n){const r=n.dr,a=n.pr;r?(this.logger.ULS.lt(574654543,e.O,i.Info,`Running flow: ${r}`),this.Tr[r](s,o,this,this.Er[r]).catch((e=>{this.Ar(r,e)}))):a&&(a===we.Share&&(o.sendTimeAsClickTime=t.SendTime),this.raiseEvent(a,o))}}},this.Ar=(t,s)=>{this.logger.ULS.lt(596459925,e.O,i.Error,`${t} flow error: ${ne(s)}`),this.remoteTelemetryUrl&&z(this.remoteTelemetryUrl,this.appInfo.name,"flowException")},this.yr=(t,s)=>{this.logger.ULS.lt(574654544,e.O,i.Info,`Dispatching action: ${t}`);const o=this.Cr[t].slice().reverse();for(let n=o.length-1;n>-1;n-=1)try{o[n](t,s)}catch(s){this.logger.ULS.lt(596444186,e.O,i.Error,`${t} action handler error: ${ne(s)}`)}return Promise.resolve({completion:"success"})},this.state=D.Unknown;const[h,l]=ve();this.isLoggerFromOwl=!!o.logger,this.logger=o.logger??se(),this.logger.ULS.lt(593506837,e.O,i.Info,JSON.stringify(l)),this.sessionId=h,this.hostSessionId=o.hostSessionId,this.host=t.host,this.hostName=this.host.uiHostName||this.host.storageHostName,this.user=t.user,this.bootstrapperUrl=t.bootstrapperUrl,this.ui=t.ui||{},this.viewMode=t.viewMode,this.application=n,this.appInfo=s,this.session=r,this.featureManager=re(t.host.capabilities&&t.host.capabilities.isFeatureEnabledCallback,this.logger),this.Et=new de(s.name,this.logger),this.preloader=s.preloader,[this.Tr,this.Er]=a(this.featureManager),this.br=c,this.clientDiagnostics=_e(),this.pageStateObserver=new ye(this.logger,!0),this.authTokenTrustValidator=new Pe(this.logger)}}class Ue{get id(){return this.Pr.sessionId}get diagnostics(){return this.Pr.diagnostics}run(e,t,i){return this.Pr.run(e,t,i)}boot(e,t){return this.Pr.run(pe.boot,e,t)}dispose(e){return this.Pr.run(pe.dispose,void 0,e)}constructor(e,t,i,s,o,n){!function(e){if(!e)throw new TypeError("SessionInitParams");if(!e.hostSessionId)throw new TypeError("HostSessionId")}(i),this.Pr=new Re(e,t,i,s,this,n,((e,t)=>o({type:e,data:t,session:this}))),this.Pr.state=D.Initialized}}const Oe=365,We=864e5;function Me(e){if(!e)return"";const t=""+document.cookie,i=new RegExp("(?:^|; )"+e+"=([^;]*)"),s=t.match(i);return!s||s.length<2?"":s[1]}function xe(e,t,i,s=ke.none,o){const n=e+"="+t;let r="";const a=new Date;a.setTime(a.getTime()+Oe*We);let c=new Date;c.setTime(c.getTime()+i*We),c>a&&(c=a),c&&(r=";expires="+c.toUTCString());const h=n+r+";SameSite="+ke[s];return document.cookie=o?h+"; Secure":h,!(!document.cookie||-1===document.cookie.indexOf(n))||s===ke.none&&xe(e,t,i,ke.doNotSet,o)}var ke,He;!function(e){e[e.doNotSet=0]="doNotSet",e[e.none=1]="none",e[e.lax=2]="lax",e[e.strict=3]="strict"}(ke||(ke={}));class $e{setTargetOrigin(t){const s=b(t).toLowerCase();this.Fr&&this.Fr!==s&&this.Qi.ULS.lt(593232847,e.O,i.Warning,`Updating origin: [${M(this.Fr)}]->[${M(s)}]`),this.Fr=s,this.Rr=C(s,2),this.Ur=v(s),this.Or=I(s)}setTargetFrame(e,t){this.Wr=e,this.Mr=!!t}setMessageHandler(e){this.kr=e}removeMessageHandler(){this.kr=void 0}postMessage(t,s,o){if(!this.Wr||!this.Wr.contentWindow)return void this.Qi.ULS.lt(593232848,e.O,i.Error,"Missing target to send message: "+t);this.Qi.ULS.lt(593232849,e.O,i.Info,"Sending message: "+t);const n={MessageId:t,SendTime:X(),CorrelationId:o,Values:s};this.Wr.contentWindow.postMessage(JSON.stringify(n),this.Fr)}dispose(){window.removeEventListener("message",this.Hr,!1),this.kr=void 0}constructor(t,s,o,n){this.Fr="",this.Rr="",this.Ur=!1,this.Or=!1,this.Mr=!1,this.$r=!1,this.Hr=t=>{let s,o=!1,n=!0,r="",a=!1;if(this.Wr&&this.Wr.contentWindow&&(o=!0,n=t.source===this.Wr.contentWindow),t.origin&&(r=C(t.origin,2).toLowerCase(),a=r===this.Rr,!a&&this.Nr&&(r=C(t.origin).toLowerCase(),a=this.Nr.includes(r))),!this.Ur&&(!this.Or||a&&n)||this.Qi.ULS.lt(593232850,e.O,i.Info,"Window: available["+o+"] valid["+n+"]; Origin: valid["+a+"] expected["+this.Rr+"] actual["+r+"]"),!a||this.Mr&&!n)return;try{if("string"!=typeof t.data)return void this.Qi.ULS.lt(505771930,e.O,i.Info,"Event data is not of type string");s=JSON.parse(t.data)}catch(t){return void this.Qi.ULS.lt(593232851,e.O,i.Info,`Failed to parse event data: ${ne(t)}`)}const c=s.MessageId;if(c){if(this.Qi.ULS.lt(593232854,e.O,i.Info,`Received message: ${c}, correlation: ${s.CorrelationId}`),c!==me.us&&c!==me.$s||this.setTargetOrigin(t.origin),s.Values&&s.Values.ackExpected&&this.postMessage(fe.un,void 0,s.CorrelationId),this.$r&&c===me.Yo)return window._pageTimings=window._pageTimings??{},void(window._pageTimings[s.Values.name]=s.Values.time);if(this.kr)try{this.kr(s)}catch(t){this.Qi.ULS.lt(594556386,e.O,i.Error,`Message handler error: ${ne(t)}`)}else this.Qi.ULS.lt(591933923,e.O,i.Error,"No message handler")}else(this.Ur||this.Or)&&this.Qi.ULS.lt(593232853,e.O,i.Info,"Missing message id")},this.Qi=s,this.setTargetOrigin(t),this.Nr=n,o&&this.setMessageHandler(o),this.$r=!!window.location?.search?.match(/wdpa=1/gi)||"1"===Me("EnableMetricLogging"),window.addEventListener("message",this.Hr,!1)}}function Ne(e,t){h()===o.Safari?e.style.display=t?"none":"block":e.style.visibility=t?"hidden":"visible"}function De(e,t,i){y(t,He.Dr,String(i?window.outerHeight:e.offsetHeight)),y(t,He.Lr,String(i?window.outerWidth:e.offsetWidth)),y(t,He.Vr,String(l())),y(t,He.Br,String(d())),y(t,He.Jr,String(p())),y(t,He.Gr,String(function(){try{return window.matchMedia("(prefers-color-scheme: dark)").matches}catch{return!1}}())),y(t,He.qr,String(function(){try{return window.matchMedia("(prefers-contrast: more)").matches}catch{return!1}}())),y(t,He.zr,String(function(){try{return window.matchMedia("(forced-colors: active)").matches||window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch{return!1}}())),y(t,He.jr,String(window.innerHeight)),y(t,He.Kr,String(window.innerWidth))}function Le(t){try{return window===window.top||window.parent===window.top&&window.location.origin===window.top.origin}catch(s){return t&&t.ULS.lt(591525084,e.O,i.Info,`Trust check error: ${ne(s)}`),!1}}!function(e){e.Xr="access_token",e.Zr="access_token_ttl",e.Qr="wac_token",e.Yr="bundleSrc",e.ea="bundleStaleness",e.ta="DocID",e.ia="SiteID",e.sa="WebID",e.oa="ETag",e.na="feature_status",e.ra="fileExtension",e.aa="fileGetUrl",e.ca="customFontCatalogUrl",e.ha="fileName",e.la="fileSize",e.Jr="forceSLR",e.Dr="frameHeightPx",e.Lr="frameWidthtPx",e.Br="highContrast",e.ua="highDpi",e.pa="host_diagnostics",e.ma="hostName",e.fa="huictrls",e.wa="owner_id",e.ga="sc",e.va="softBlockedBrowser",e.Ia="templateUrl",e.Vr="touchMode",e.Sa="user_id",e._a="hfck",e.ba="hfcv",e.Ca="timeZoneId",e.Gr="darkCssMedia",e.zr="forcedColors",e.qr="prefersContrast",e.ya="caae",e.Ta="meetingId",e.Ea="meetingTitle",e.Aa="meetingType",e.Pa="scheduledStartTime",e.Fa="scheduledEndTime",e.Ra="isPresenter",e.Ua="meetingOrganizerId",e.Oa="meetingJoinUrl",e.Wa="isMeetingTeamsRoom",e.Ma="jsapibuild",e.xa="owlver",e.ka="owlro",e.Ha="caaemode",e.$a="traceparent",e.Na="tracestate",e.Da="supports_zipit",e.La="sipcn",e.Va="devcs",e.Ba="dceit",e.jr="frameInnerHeightPx",e.Kr="frameInnerWidthPx"}(He||(He={}));class Ve{get element(){return this.Ja}get frameId(){return this.Ga}get formId(){return this.qa}get isTopFrameTrusted(){return this.za}boot(t,s,o,n,r,a,c){this.Qi=o,this.Ka=new $e(t,o,this.kr,n.additionalReceivingDomainList);const h=n.useAdditionalDiv,l=n.permissionsPolicy;this.Xa&&!h?(this.Xa.setAttribute("allow",l),this.Qi.ULS.lt(588793045,e.O,i.Info,"Wac frame reused")):(this.Xa=function(e,t,i,s,o,n,r,a,c,h){e.style.top="0",e.style.bottom="0",e.style.left="0",e.style.right="0",e.style.height="100%",e.style.width="100%";const l=e.ownerDocument,d=l.createElement("iframe");if(d.id=t,d.name=t,d.src="",d.title="Office on the web Frame",d.marginWidth="0",d.marginHeight="0",d.style.top="0",d.style.bottom="0",d.style.left="0",d.style.right="0",d.style.height="100%",d.style.width="100%",d.style.display="block",d.style.position="absolute",d.style.backgroundColor="transparent",d.style.border="none",d.frameBorder="0",d.setAttribute("allowfullscreen","true"),d.setAttribute("allowTransparency","true"),d.setAttribute("allow",i),Ne(d,r),s&&(e.style.minHeight=s,d.style.minHeight=s),o&&(e.style.minWidth=o,d.style.minWidth=o),a&&d.setAttribute("role","none"),n){const t=l.createElement("div");t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0",t.style.height="100%",t.style.width="100%",t.style.backgroundColor="#393a3d",t.style.backfaceVisibility="hidden",s&&(t.style.minHeight=s),o&&(t.style.minWidth=o),t.appendChild(d),e.appendChild(t)}else e.appendChild(d);return c&&d.addEventListener("load",c,{once:!0}),h&&d.addEventListener("error",h,{once:!0}),d}(this.Ja,this.Ga,l,n.minHeight,n.minWidth,h,n.isInvisible,n.setNoneRole,a,c),this.Qi.ULS.lt(588793046,e.O,i.Info,"Wac frame created")),r(),this.Ka.setTargetFrame(this.Xa,n.enforceSameWindow),h&&(this.Za=this.Xa.parentElement),n.useFrameFixForTeams&&o.ULS.lt(509143245,e.O,i.Info,"Frame fix enabled for teams uiHost"),De(this.Xa,s,n.useFrameFixForTeams),s.parentOrigin=window.origin||"",this.Qa=function(e,t,i,s,o){const n=e.ownerDocument,r=n.createElement("form");r.id=i,r.name=i,r.action=s,r.target=t,r.method="POST";for(const e in o){const t=n.createElement("input");t.type="hidden",t.name=e,t.value=o[e],r.appendChild(t)}return e.appendChild(r),r}(this.Ja,this.Ga,this.qa,t,s),this.Qa.submit()}setVisibility(e){this.Xa&&Ne(this.Xa,e)}setMessageHandler(e){this.kr=e,this.Ka&&this.Ka.setMessageHandler(e)}setWrapperPostMessage(e){this.Ya=e}removeMessageHandler(){this.kr=void 0,this.Ka&&this.Ka.removeMessageHandler()}postMessage(e,t){this.Ya?this.Ya(e,t):this.Ka&&this.Ka.postMessage(e,t)}dispose(e,t){return new Promise((i=>{if(this.Qa&&(this.Ja.removeChild(this.Qa),this.Qa=void 0),this.Ka&&(this.Ka.dispose(),this.Ka=void 0,this.kr=void 0),this.Ya&&(this.Ya=void 0),this.Qi=void 0,!this.Xa||!this.Za&&e)i();else{const e=()=>{this.Za?(this.Za.removeChild(this.Xa),this.Ja.removeChild(this.Za)):this.Ja.removeChild(this.Xa),this.Xa=void 0,this.Za=void 0,i()};t?e():(this.Xa.src="about:blank",window.setTimeout(e,0))}}))}constructor(e,t){!function(e){if(!e||!e.appendChild)throw TypeError("Container")}(e),this.Ja=e,this.Ga=t,this.qa=t+"_Form",this.za=Le()}}class Be{get name(){return this.ec.name}get version(){return B()}addEventListener(e){this.tc.add(e)}removeEventListener(e){this.tc.remove(e)}createContainer(e){const t=`WacFrame_${this.ec.name}_${this.containers.length}`,i=new Ve(e,t);return this.containers.push(i),i}createSession(e){const t=new Ue(this.ic,this.ec,e,this,this.oc,this.nc);return this.sessions.push(t),t}dispose(e){const t=this.sessions.map((t=>t.dispose(e).catch((e=>{}))));return Promise.all(t).then((e=>(this.tc.removeAll(),this.sessions=[],this.containers=[],{completion:"success"})))}constructor(e,t,i){this.sessions=[],this.containers=[],this.oc=e=>{this.tc.dispatch(e)},function(e){if(!e)throw new TypeError("ApplicationInitParams");const t=e.host;if(!t||!t.storageHostName)throw new TypeError("HostInfo");const i=e.user;if(!i||null==i.id)throw new TypeError("UserInfo")}(e),this.ic=e,this.ec=t,this.nc=i,this.tc=new ce,function(e){if(e&&(V.BUILD_NUMBER=e,e.includes("."))){const t=e.split(".");V.BUILD_NUMBER_MINOR=parseInt((t[0]||"").concat((t[1]||"").padStart(3,"0")),10)}}(e.host.owlVersion)}}let Je=!1,Ge=!1;function qe(){Je=!1}function ze(t,s,o,n,r,a,c){if(s.ULS.lt(595714433,e.O,i.Important,`Starting disposing the application. unloadApp:${t}; disposed:${Je}; unloading:${Ge}`),Je||Ge&&t)return void s.ULS.lt(595714908,e.O,i.Info,"Application is already disposed or unloading");const h={logger:s,postMessenger:o,innerApplicationFrame:n,onDisposed:r,onFrameRemoved:a,unloadTimeoutInMs:c||1e3,forceAppUnload:!1,disposeStartTime:X(),appUnloadTimedOut:!1};if(t&&n)return Ge=!0,h.forceAppUnload=!0,(l=h).forceAppUnloadStartTime=X(),l.logger.ULS.lt(595855490,e.O,i.Info,"Sending postmessage to unload app"),l.logger.ULS.flush(),l.postMessenger.registerMessagePayloadHandler(me.co,(t=>function(t,s){t.forceAppUnloadEndTime=X(),t.appUnloadedMessageValues=s,t.logger.ULS.lt(595855491,e.O,i.Info,"AppUnloaded received from app"),je(t)}(l,t))),l.postMessenger.sendPostMessage(l.innerApplicationFrame,fe.Qn,{}),void window.setTimeout((()=>function(t){!Ge&&Je||(t.appUnloadTimedOut=!0,t.logger.ULS.lt(595855492,e.O,i.Info,"ApplicationUnload timed out, forcing dispose"),je(t))}(l)),l.unloadTimeoutInMs);var l;je(h)}function je(t){if(!Je)try{Je=!0,Ge=!1,function(e){e.innerApplicationFrame&&(e.innerApplicationFrame.src="about:blank",window.setTimeout((()=>{e.innerApplicationFrame&&e.innerApplicationFrame.parentElement&&e.innerApplicationFrame.parentElement.removeChild(e.innerApplicationFrame),e.onFrameRemoved&&e.onFrameRemoved()}),0))}(t),function(t){const s={disposeStartTime:t.disposeStartTime,disposeEndTime:X(),forceAppUnload:t.forceAppUnload,appUnloadTimedOut:t.appUnloadTimedOut};if(t.forceAppUnloadStartTime&&(s.appUnloadStartTime=t.forceAppUnloadStartTime),t.forceAppUnloadEndTime&&(s.appUnloadEndTime=t.forceAppUnloadEndTime),t.appUnloadedMessageValues){const e=t.appUnloadedMessageValues,i=Number(e.hostMessageReceived);t.forceAppUnloadStartTime&&!isNaN(i)&&(s.hostToAppPostMessageLatency=i-t.forceAppUnloadStartTime);const o=Number(e.appMessageSent);!isNaN(o)&&t.forceAppUnloadEndTime&&(s.appToHostPostMessageLatency=t.forceAppUnloadEndTime-o);const n=Number(e.appUnloadStart),r=Number(e.appUnloadEnd);if(isNaN(n)||isNaN(r)||(s.appUnloadLatency=r-n),e.serverTimings){const t=e.serverTimings;for(const e in t)s["st-"+e.toString()]=t[e]}}t.logger.ULS.lt(595855436,e.O,i.Info,"App disposed "+JSON.stringify(s)),t.logger.ULS.flushOnClose()}(t),t.onDisposed&&t.onDisposed()}catch(s){t.logger.ULS.lt(595714434,e.O,i.Error,`Error disposing: ${ne(s)}`)}}var Ke;!function(e){e.AppInitError="AppInitError",e.ApiDisabledError="ApiDisabledError",e.CannotLoadFirstPage="CannotLoadFirstPage",e.InvalidWopiInfo="InvalidWopiInfo",e.TimeoutWacReady="TimeoutWacReady",e.WacFailed="WacFailed"}(Ke||(Ke={}));class Xe{}Xe.logger=se();class Ze{constructor(t){this.rc={},this.resetCache=()=>{if(!this.ac)return!1;try{return localStorage.removeItem(this.dataSettingsCacheKey),!0}catch(t){return Xe.logger.ULS.lt(557114832,e.O,i.Error,`${this.dataSettingsCacheKey}: Failure trying to Delete data in localStorage: ${ne(t)}`),!1}},this.setCache=t=>{if(t&&this.ac)try{localStorage.setItem(this.dataSettingsCacheKey,JSON.stringify(t))}catch(t){Xe.logger.ULS.lt(557114833,e.O,i.Error,`${this.dataSettingsCacheKey}: Error while saving settings in cache: ${ne(t)}`)}},this.getIntegerSetting=e=>{const t=this.cc(e);if(null!=t&&"number"==typeof t){const e=t;if(!isNaN(e))return e}return null},this.getBooleanSetting=e=>{const t=this.cc(e);return null!=t&&"boolean"==typeof t?t:null},this.getStringSetting=e=>{const t=this.cc(e);return null!=t&&"string"==typeof t?t:null},this.cc=t=>{if(!this.ac)return null;try{if(t in this.rc)return this.rc[t];const e=localStorage.getItem(this.dataSettingsCacheKey);if(null!==e){const i=JSON.parse(e)[t];return this.rc[t]=i,i}}catch(s){Xe.logger.ULS.lt(557114834,e.O,i.Error,`${this.dataSettingsCacheKey}: Failure trying to find ${t} setting in localStorage: ${ne(s)}`)}return null},this.dataSettingsCacheKey=t,this.ac=!1;try{localStorage&&(this.ac=!0)}catch(t){Xe.logger.ULS.lt(538018719,e.O,i.Warning,`Local storage not supported: ${ne(t)}`)}}}class Qe extends Ze{static get Instance(){return Qe.hc||(Qe.hc=new Qe)}constructor(){super(Qe.lc)}}Qe.lc="OneNote_hostUtilsSettingsCache";const Ye="Excel";function et(e,t){return e+"_layouts/"+g+(t?"?usid="+t:"")}function tt(e,t){return et(st(e),t)}function it(e,t,i,s,o,n=!1){e.SessionInformation.IsCore&&(e.SessionInformation.HideViewerToolbar=!0),function(e,t){const i=e.SessionInformation;if(i.WdParams||(i.WdParams={}),i.WdParams.wd)return;t.substring(1).split("&").filter((e=>{if(0===e.indexOf("wd")){const t=e.split("=");t[0].length>2&&(i.WdParams[t[0]]=t[1])}}));const s=e.RebootOverrideData;s&&s.previousSessionId&&(i.WdParams.wdprevioussession=s.previousSessionId),Qe.Instance.getBooleanSetting("OneNoteHostSessionOriginFixEnabled")}(e,window.location.search);const r=o||new de(Ye,i),a=st(e.ApplicationUrl);return{container:e.Container,sessionInformation:e.SessionInformation,applicationUrl:e.ApplicationUrl,wopiPrecheckInfo:e.WopiPrecheckInfo,applicationCustomSettings:e.ApplicationCustomSettings,diagnostics:{HostInitDiagnostics:e.Diagnostics,ClientDiagnostics:_e(),AppInitDiagnostics:{officeSessionId:t,officeBootstrapperVersion:B(),hostName:e.SessionInformation.HostName},SessionTraces:{}},fnOnInitializeSuccess:e.FnOnInitializeSuccess,fnOnInitializeFailure:e.FnOnInitializeFailure,sessionId:t,applicationBasePath:a,remoteTelemetryUrl:et(a,t),wopiInfo:e.WopiInfo,forceSingleStepBoot:n,isCreateNew:e.WopiPrecheckInfo.IsNewFile||O(e.ApplicationUrl,"new"),featureManager:s||re(e.FnIsFeatureEnabled,i),Et:r,newFileTemplateSource:e.NewFileTemplateSource,rebootOverrideData:e.RebootOverrideData,pageStateObserver:new ye(i,!0)}}function st(e){const t=e.match(/^(.*?\/\/[^\/]+\/[^\/]+\/)(.*)$/);if(!t)throw new Error("Invalid URL");return t[1]}function ot(e,t){t&&t.Diagnostics&&Object.keys(t.Diagnostics).forEach((i=>e[i]=t.Diagnostics[i]))}function nt(t,i,s){i.ULS.lt(596459999,e.O,s,"SessionTraces: "+JSON.stringify(t))}function rt(e,t){t.stop();const i=t.getVisibilityChangeEvents();null!=i&&i.length>0&&(e.AppInitDiagnostics.documentLoadedWithTabSwitch=!0,e.SessionTraces.tabSwitchDiagnostics=JSON.stringify(i)),t.dispose()}function at(t,s,o){try{const n=function(e,t){const i={...t};delete i.UserId,delete i.OwnerId,delete i.SiteId,delete i.WebId,delete i.Upn,delete i.TenantId,delete i.UiHostTabId,delete i.OriginalWdParam,delete i.WdParams;const s=i,o=t.WdParams?JSON.parse(JSON.stringify(t.WdParams).toLowerCase()):{};s.WdParams={},["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((e=>{o[e]&&(s.WdParams[e]=o[e])}));const n=/^\w{8}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{12}$/i;return s.WdParams.wdprevioussession&&!n.test(s.WdParams.wdprevioussession)&&delete s.WdParams.wdprevioussession,s.WdParams.wdpreviouscorrelation&&!n.test(s.WdParams.wdpreviouscorrelation)&&delete s.WdParams.wdpreviouscorrelation,s.UiEmbedMode=O(e,"uiembed"),s.UiHostName=E(e,"uih")||"N/A",s.HostDomain=location?location.hostname:"",s}(s.applicationUrl,s.sessionInformation);n.Build=B(),n.Region=S(s.applicationUrl);const r={...s.rebootOverrideData};delete r.ackExpected,delete r["ui-language"],delete r.wdUserSession,delete r.rebootMode,delete r.documentUrl,n.RebootOverride=r;const a=s.diagnostics.HostInitDiagnostics;a&&(t.ULS.lt(596444238,e.O,i.Info,"HostInitDiagnostics: "+JSON.stringify(s.diagnostics.HostInitDiagnostics)),n.SessionOrigin=a.entryPoint),o&&t.ULS.lt(595937313,e.O,i.Info,JSON.stringify(o)),t.ULS.lt(595632928,e.O,i.Info,function(){if(window&&window.navigator){const e=window.navigator,t=e.connection||e.mozConnection||e.webkitConnection;if(t)return"EffectiveType: "+t.effectiveType+", BandwidthMps: "+t.downlink+", ConnectionType: "+t.type}return""}());const c=s.wopiInfo;c&&c.AccessToken&&c.AccessTokenExpiry||t.ULS.lt(595894553,e.O,i.Warning,"There are some missing parameters"),c&&(c.AccessToken&&(n.AccessTokenLength=c.AccessToken.length),n.AccessTokenExpiry=c.AccessTokenExpiry,c.WacToken&&(n.WacTokenLength=c.WacToken.length)),"Microsoft Teams"===s.sessionInformation.HostName&&t.ULS.lt(507122579,e.O,i.Important,"Excel setting Force View only for Teams WXP Files session."),n.JsApiVersion="v1",t.ULS.lt(596444237,e.O,i.Important,JSON.stringify({session:n,client:s.diagnostics.ClientDiagnostics}))}catch(s){t.ULS.lt(558155802,e.O,i.Error,`Failed to log initialization info: ${ne(s)}`)}}const ct="/x/",ht="_layouts/",lt="xlviewerinternal.aspx",dt="xlembed.aspx",ut="xlpreview.aspx",pt=ht+lt,mt=ht+dt,ft=ht+ut,wt=["c1h-","c2h-","c3h-","c4h-","c5h-","c1-","c2-","c3-","c4-","c5-"];function gt(e){return new RegExp(lt,"i").test(e)}function vt(e){return new RegExp(dt,"i").test(e)}function It(e){return new RegExp(ut,"i").test(e)}const St=3,_t=2500,bt=4e3,Ct=3e3,yt="OfflineMode_";let Tt,Et,At,Pt,Ft,Rt,Ut,Ot,Wt,Mt;function xt(t,s,o,n){Rt=t,Ut=s,Ot=void 0,Wt=o,Mt=n,Tt=!1,Et=!1,At=0,Dt(),setTimeout((()=>{Rt.ULS.lt(593589517,e.O,i.Info,"ExcelLandingPageObserver:initExcelLandingPageObserver heartbeat signal called after ms: "+Ct)}),Ct),setTimeout((()=>{Nt()}),Pt),Wt&&Wt.isFeatureEnabled(ie.Ei)&&(window.localStorage?window.addEventListener("offline",Lt):Rt.ULS.lt(593589518,e.O,i.Info,"ExcelLandingPageObserver:initExcelLandingPageObserver localstorage not supported by Browser. Skip saving in cache")),Rt.ULS.lt(594622165,e.O,i.Info,`ExcelLandingPageObserver:initExcelLandingPageObserver called with OfflineTelemetry: ${Wt?Wt.isFeatureEnabled(ie.Ei):"False [featureManager undefined]"}`)}function kt(e){"PageLoadSkeleton Presented"===e?Tt=!0:"BootstapContext Recieved"===e&&(Et=!0)}function Ht(){if(Wt&&Wt.isFeatureEnabled(ie.Ei))if(window.localStorage)for(let t=0;t<localStorage.length;t+=1)try{const s=localStorage.key(t);if(s.substring(0,yt.length)===yt){const t=localStorage.getItem(s);Rt.ULS.lt(593589520,e.O,i.Info,"ExcelLandingPageObserver:uploadOfflineModeTelemetry Message"+t),localStorage.removeItem(s)}}catch(t){Rt.ULS.lt(593589521,e.O,i.Error,"ExcelLandingPageObserver:uploadOfflineModeTelemetry exception during loading from cache. Exception: "+ne(t))}else Rt.ULS.lt(593589519,e.O,i.Info,"ExcelLandingPageObserver:uploadOfflineModeTelemetry localstorage not supported by Browser. Skip uploading")}function $t(e){return gt(e)||vt(e)}function Nt(){At>=St?Rt.ULS.lt(595350870,e.O,i.Info,"ExcelLandingPageObserver: checkFirstFlushArrived  Max Limit reached for retry attempts"+St):(Dt(),Tt?setTimeout((()=>{(!Et||At>0)&&Rt.ULS.lt(595350872,e.O,i.Info,"ExcelLandingPageObserver: checkSecondFlushArrived Second Flush status: "+Et+" after first flush retry attempt: "+At)}),Ft):(At+=1,Rt.ULS.lt(595350871,e.O,i.Info,"ExcelLandingPageObserver: checkFirstFlushArrived  Retry Request: "+At),Wt&&Wt.isFeatureEnabled(ie.Ai)&&1===At&&document.getElementById(Ut).submit(),setTimeout((()=>{Nt()}),Pt)))}function Dt(){Pt=1.5*_t,Ft=1.5*bt;const t=function(){if(!window||!window.navigator)return;const e=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;return e?e.effectiveType:void 0}();if(void 0!==t)switch(void 0!==Ot&&Ot!==t&&Rt.ULS.lt(595350873,e.O,i.Info,"ExcelLandingPageObserver: initializeTimeOutIntervals previousConnection: "+Ot+" currentConnection: "+t+" First Flush: "+Tt+" Second Flush:"+Et),Ot=t,t){case"4g":Pt=1.5*_t,Ft=1.5*bt;break;case"3g":Pt=2*_t,Ft=2*bt;break;case"2g":Pt=4*_t,Ft=6*bt;break;case"slow-2g":Pt=8*_t,Ft=10*bt}}function Lt(){try{const e=X(),t=yt+Mt+"_"+e,i={"Sessionid:":Mt,OfflineTime:e};localStorage.setItem(t,JSON.stringify(i))}catch(t){Rt.ULS.lt(593589522,e.O,i.Error,"ExcelLandingPageObserver:logOfflineModeTelemetry exception during saving into cache exception: "+ne(t))}}const Vt="XlHc_";let Bt;const Jt=5184e6;function Gt(t,s=void 0,o=void 0){Bt=t;try{if(window.localStorage)if(o){const e=(e,t)=>{zt(t)};o.addActionHandler(me.So,e);const t=(e,t)=>{jt(t)};o.addActionHandler(me._o,t)}else s&&(s.registerMessagePayloadHandler(me.So,(e=>{zt(e)})),s.registerMessagePayloadHandler(me._o,(e=>{jt(e)})));else Bt.ULS.lt(574677217,e.O,i.Warning,"ExcelHostFrameCacheManager: initHostFrameCacheManager: localstorage not supported by Browser. Skip saving HostFrame cache save")}catch(t){Bt.ULS.lt(574677218,e.O,i.Warning,"ExcelHostFrameCacheManager: initHostFrameCacheManager: error while initializing.")}}function qt(t,s,o){try{Bt||(Bt=t);let n=`${s[He.ta]}_${o}_${s[He.ma]}_${s[He.Sa]}`;if(n=Vt+function(e){let t=0;const i=e.length;let s=0;if(i>0)for(;s<i;)t=(t<<5)-t+e.charCodeAt(s)|0,s+=1;return t}(n),s[He._a]=n,window.localStorage){const e=localStorage.getItem(n);null!==e&&(s[He.ba]=e)}else Bt.ULS.lt(574677219,e.O,i.Warning,"ExcelHostFrameCacheManager: setHostFrameCachePostData: localstorage not supported by Browser. Skip saving HostFrame cache save")}catch(t){Bt.ULS.lt(574677248,e.O,i.Warning,"ExcelHostFrameCacheManager: setHostFrameCachePostData: error while setting host frame cache post data.")}}function zt(t){if(t&&t.hasOwnProperty("cacheItemKey")&&0===t.cacheItemKey.indexOf(Vt)&&t.hasOwnProperty("cacheItemValue"))try{window.localStorage.setItem(t.cacheItemKey,t.cacheItemValue),Bt.ULS.lt(574677249,e.O,i.Info,"ExcelHostFrameCacheManager: handleHostFrameSaveMessage: setting localstorage HostFrame cache item")}catch(t){Bt.ULS.lt(574677250,e.O,i.Warning,"ExcelHostFrameCacheManager: handleHostFrameSaveMessage: error while saving HostFrame to local storage. error: "+ne(t))}else Bt.ULS.lt(574677251,e.O,i.Warning,"ExcelHostFrameCacheManager: handleHostFrameSaveMessage: HostFrame cache save message does not contain all expected values, skipping HostFrame cache save")}function jt(t){if(t&&t.hasOwnProperty("workbookList")&&t.hasOwnProperty("evictAllExceptListed"))try{const s=t.evictAllExceptListed,o=JSON.parse(t.workbookList);Bt.ULS.lt(574677252,e.O,i.Info,"ExcelHostFrameCacheManager: handleHostFrameEvictMessage: removing items from cache. workbookList length: "+o.length+", evictAllExceptListed: "+s),!0===s?function(t){const s=new Date,o=new Date(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()).getTime();for(let s=0;s<localStorage.length;s+=1){const n=localStorage.key(s);let r=!1;if(0===n.indexOf(Vt)){if(t.indexOf(n)<0)r=!0;else{const t=localStorage.getItem(n);let s;try{s=JSON.parse(t)}catch(t){Bt.ULS.lt(574677255,e.O,i.Warning,"ExcelHostFrameCacheManager: evictAllItemsExcept: unable to check for stale HostFrame cache, error parsing HostFrame cache item, error: "+ne(t))}s?o-s.LastModified>Jt&&(r=!0):r=!0}r&&(localStorage.removeItem(n),Bt.ULS.lt(574677256,e.O,i.Verbose,"ExcelHostFrameCacheManager: EvictAllItemsExcept: Removed HostFrame cache item"))}}}(o):function(t){for(let s=0;s<t.length;s+=1)localStorage.removeItem(t[s]),Bt.ULS.lt(574677257,e.O,i.Verbose,"ExcelHostFrameCacheManager: EvictSpecificItems: Removed HostFrame cache item")}(o)}catch(t){Bt.ULS.lt(574677253,e.O,i.Warning,"ExcelHostFrameCacheManager: handleHostFrameEvictMessage: error while evicting HostFrame from local storage. error: "+ne(t))}else Bt.ULS.lt(574677254,e.O,i.Warning,"ExcelHostFrameCacheManager: handleHostFrameEvictMessage: HostFrame cache evict message does not contain all expected values")}var Kt;!function(e){e.bootWithoutWopiInfo="",e.unifiedSingleFlush="Unified_SingleFlush",e.unifiedIrmEnabled="Unified_IrmEnabled",e.unifiedViewActionUrl="Unified_ViewActionUrl",e.unifiedNotEditOrViewActionUrl="Unified_NotEditOrViewActionUrl",e.forceSingleStepBoot="Force_SingleStepBoot",e.wordUiEmbedReadOnlyEarlyRedirect="WordUiEmbed_ReadOnlyEarlyRedirect",e.wordUiEmbedIrmEnabledEarlyRedirect="WordUiEmbed_IrmEnabledEarlyRedirect",e.wordViewToUnifiedReadRedirect="WordView_UnifiedReadRedirect",e.wordMobileUnifiedReadRedirect="WordMobile_UnifiedReadRedirect"}(Kt||(Kt={}));const Xt="WebApplicationFrame",Zt="office_form";function Qt(e,t,i=!1){let s=e.applicationUrl;e.wopiPrecheckInfo.IsNewFile&&s.replace("unified=1","edit=1&new=1");let o={};if("Microsoft Teams"===e.sessionInformation.HostName&&(o.fvo="1",s=F(s,"unified")),e.sessionInformation.UseBizChatTheme&&(o.ubct="1"),o.jsApi="1",o.jsapiver="v1",i&&(o.NewSession="1"),o.corrid=e.sessionId,o.usid=e.sessionId,o.sftc="1",(e.applicationCustomSettings&&e.applicationCustomSettings.IsCore||e.sessionInformation.IsCore)&&(o.core="1"),e.sessionInformation.HideViewerToolbar&&(o.hvt="1"),e.sessionInformation.HideEditUpsellDialog&&(o.hdeditdlg="1"),e.sessionInformation.DisableFocusOnBoot&&(o.disableFocusOnBoot="1"),e.sessionInformation.HighContrastMode&&(o.hcm=encodeURIComponent(e.sessionInformation.HighContrastMode)),e.sessionInformation.SupportsAtMentions&&(o.sams="1"),e.sessionInformation.SupportsAccessibilityLoop&&(o.accloop="1"),e.sessionInformation.SupportsDocReboot){const t=e.sessionInformation.SupportsDocReboot;o.sdr=!0===t?"1":t.toString()}e.sessionInformation.SupportsCreateNewDocument&&(o.scnd="1"),e.sessionInformation.SupportsAuthToken&&(o.sat="1"),window.docAspxMsalEnabled&&"onedrivecom"!==P(e.applicationUrl).uih&&(e.sessionInformation.AuthTokenStrategy="PairwiseBroker"),e.sessionInformation.AuthTokenStrategy&&(o.ats=e.sessionInformation.AuthTokenStrategy),e.sessionInformation.SupportsCustomAuthConfig&&(o.cac="1"),e.sessionInformation.TopOrigin&&(o.to=encodeURIComponent(e.sessionInformation.TopOrigin)),e.sessionInformation.IsDeeplyNestedAuthSupportedInTeams&&(o.dnaa="1"),e.sessionInformation.SupportsMoveToFolder&&(o.mtf="1"),e.sessionInformation.SupportsCommonFilePicker&&(o.sfp="1"),e.sessionInformation.OpenLinksInNewWindow&&(o.onw="1"),e.sessionInformation.UseDarkTheme&&(o.udt="1"),e.sessionInformation.SupportsExcelExternalLinks&&(o.xlel="1"),e.sessionInformation.SupportsRefreshAccessToken&&(o.rat="1"),(e.sessionInformation.HideHeader||"DocGen"===e.sessionInformation.ContentAssemblyMode||"Templatization"===e.sessionInformation.ContentAssemblyMode||"ContentAssemblyEdit"===e.sessionInformation.ContentAssemblyMode||"ContentAssemblyView"===e.sessionInformation.ContentAssemblyMode)&&(o.hhdr="1"),e.sessionInformation.HideAppLauncherInHeader&&(o.halh="1"),e.sessionInformation.HideChatInHeader&&(o.hch="1"),e.sessionInformation.HideMeInHeader&&(o.hmh="1"),e.sessionInformation.HideSearchInHeader&&(o.hsh="1"),e.sessionInformation.HideWorkflowInHeader&&(o.hwfh="1"),e.sessionInformation.HideSettingsInHeader&&(o.hsth="1"),e.sessionInformation.ShowAppIconInHeader&&(o.sih="1"),e.sessionInformation.UseNeutralColorInHeader&&(o.unh="1"),e.sessionInformation.HideBreadCrumbInViewer&&(o.hbcv="1"),e.sessionInformation.HideTitleInViewer&&(o.htv="1"),e.sessionInformation.HideWACOneDriveFileLocationPicker&&(o.hodflp="1"),e.sessionInformation.NoBrowserModalDialogs&&(o.nbmd="1"),e.applicationCustomSettings&&e.applicationCustomSettings.FixDiagnosticsJson&&(o.fixdiag="1"),e.wopiPrecheckInfo.ReadOnly&&(o.readOnly="1",e.wopiPrecheckInfo.ReadOnly&&(o.mode="Read")),"DocGen"!==e.sessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==e.sessionInformation.ContentAssemblyMode||(o.readOnly="1"),e.sessionInformation.UIEmbed&&(o.uiEmbed="1"),e.sessionInformation.IsSynthetic&&(o.syn="1"),e.sessionInformation.SupportsDirectDownload&&(o.sdd="1"),e.sessionInformation.SupportsDirectPrint&&(o.sdp="1"),e.sessionInformation.DisableOfficeAddins&&(o.doa="1"),e.sessionInformation.UiHostIntegrationType&&(o.uihit=encodeURIComponent(e.sessionInformation.UiHostIntegrationType)),e.sessionInformation.MetaUiHostVersion&&(o.muv=encodeURIComponent(e.sessionInformation.MetaUiHostVersion)),e.applicationCustomSettings&&e.applicationCustomSettings.InAppDocumentPreview&&(o.InAppDocPreview="1"),t.isSingleStepBoot?(t.bootFlowType===Kt.unifiedSingleFlush&&(e.isCreateNew||(o.instantedit="1",o.wopicomplete="1")),o.wdRedirectionReason=t.bootFlowType):(o.instantedit="1",o.fileSrc=encodeURIComponent(e.sessionInformation.HostName),o.pmOrigin=encodeURIComponent(b(window.location.href)),e.isCreateNew&&(o.new="1",e.wopiPrecheckInfo.IsNewFileFromHostTemplate&&(o.wdTpl="fromhost"))),e.wopiPrecheckInfo.PreseededSessionKey&&(o.preseededSessionKey=encodeURIComponent(e.wopiPrecheckInfo.PreseededSessionKey)),e.wopiPrecheckInfo.PreseededWacSessionId&&(o.preseededWacSessionId=encodeURIComponent(e.wopiPrecheckInfo.PreseededWacSessionId)),e.wopiPrecheckInfo.RequestedCallThrottling&&(o.rct=e.wopiPrecheckInfo.RequestedCallThrottling),e.wopiPrecheckInfo.ClientThrottlingProtection&&(o.ctp=e.wopiPrecheckInfo.ClientThrottlingProtection);{const t=e.wopiPrecheckInfo.FileSize;t&&t>=52428800&&t<=104857600&&(o.ilf="1")}return e.applicationCustomSettings&&e.applicationCustomSettings.additionalApplicationParameters&&(o={...e.applicationCustomSettings.additionalApplicationParameters,...o}),e.rebootOverrideData&&e.rebootOverrideData.queryOverrides&&(o={...o,...e.rebootOverrideData.queryOverrides}),e.sessionInformation.AfdFlighting&&(o.afdflight=Math.floor(100*Math.random()+1).toString()),function(e,t,i,s,o){let n=P(e);("teams"===n.uih&&"UnifiedUiHostTeams"!==t.UiHostIntegrationType&&"TeamsModern"!==t.UiHostIntegrationType||"owa"===n.uih)&&(n.hhdr="1");const r=e.indexOf("?"),a=-1===r?e.concat("?"):e.substring(0,r+1);t.UiLocale&&(n.ui=encodeURIComponent(t.UiLocale)),t.DataLocale&&(n.rs=encodeURIComponent(t.DataLocale)),t.HostSessionId&&(n.hid=encodeURIComponent(t.HostSessionId)),t.DisableChat&&(n.dchat="1"),t.SessionContext&&(n.sc=encodeURIComponent(t.SessionContext)),i&&i.WopiSrc&&(n.wopisrc=encodeURIComponent(i.WopiSrc)),t.CookieCompliant&&(n.mscc="1"),s&&(s.entryPoint&&(n.wdorigin=encodeURI(s.entryPoint)),s.userClickTime&&(n.wdhostclicktime=s.userClickTime.toString())),n={...n,...t.WdParams,...o};const c={};for(const e in n)c[e.toLowerCase()]=n[e];const h=[];for(const e in c)c[e]&&h.push(e.concat("=",c[e]));return a.concat(h.join("&"))}(s,e.sessionInformation,e.wopiInfo,e.diagnostics.HostInitDiagnostics,o)}function Yt(e){return e.AccessTokenExpiry?e.AccessTokenExpiry.getTime().toString():"0"}const ei={[pe.blurFocus]:fe.fn,[pe.continueAccessibilityLoop]:fe.Sn,[pe.grabFocus]:fe._n,[pe.moveToFolder]:fe.Ds,[pe.popState]:fe.En,[pe.rename]:fe.kn,[pe.sendAccessToken]:fe.Hn,[pe.sendAuthToken]:fe.$n,[pe.sendCustomAuthConfig]:fe.Nn,[pe.sendEmbeddedViewUrl]:fe.Ln,[pe.sendSessionInfo]:fe.Vn,[pe.sendUserAccessAndPermissions]:fe.Bn,[pe.sendWopiInfo]:fe.Jn,[pe.sendDavUrl]:fe.Gn,[pe.completeSharedFilePicker]:fe.Qs,[pe.switchMode]:fe.Zn,[pe.signalShared]:fe.ir};class ti{registerMessagePayloadHandler(e,t){if(this.dc[e])throw new Error("Duplicate registration!");this.dc[e]=t}removeMessageHandler(e){delete this.dc[e]}sendPostMessage(t,s,o){if(!t||!t.contentWindow)return void this.Qi.ULS.lt(595948308,e.O,i.Info,"Missing target for SendPostMessage");this.Qi.ULS.lt(596464334,e.O,i.Info,"Sending message: "+s);const n={MessageId:s,SendTime:X(),Values:o};this.uc(t.contentWindow,JSON.stringify(n),this.Fr)}activate(e,t){this.mc=e,this.Mr=!!t,this.fc||(window.addEventListener("message",this.wc,!1),this.fc=!0)}postMessageForCommand(t,s,o){const n=ei[s];n?(this.Qi.ULS.lt(595702598,e.O,i.Info,`Sending message ${n} for command ${s}`),this.sendPostMessage(t,n,o)):this.Qi.ULS.lt(595702599,e.O,i.Warning,`No mapping for command ${s}`)}dispose(){this.dc={},this.fc&&(window.removeEventListener("message",this.wc,!1),this.fc=!1)}constructor(t,s){if(this.fc=!1,this.dc={},this.Fr="",this.Rr="",this.Mr=!1,this.Ur=!1,this.Or=!1,this.$r=!1,this.gc=[],this.vc=!0,this.Ic=(t,s,o)=>{if(!t)return void this.Qi.ULS.lt(595736136,e.O,i.Info,"Missing target to send Ack back");const n={MessageId:fe.un,CorrelationId:o,SendTime:X()};this.Qi.ULS.lt(595732176,e.O,i.Info,"Sending Ack back"),t.postMessage(JSON.stringify(n),s)},this.wc=t=>{let s,o=!1,n=!0,r="",a=!1;if(this.mc&&this.mc.contentWindow&&(o=!0,n=t.source===this.mc.contentWindow),t.origin&&(r=C(t.origin,2).toLowerCase(),a=r===this.Rr,!a&&this.Nr&&(r=C(t.origin).toLowerCase(),a=this.Nr.includes(r))),!this.Ur&&(!this.Or||a&&n)||this.Qi.ULS.lt(595730526,e.O,i.Info,`Window is available: ${o}, window is valid: ${n}, origin is valid: ${a}, expected origin: ${this.Rr}, actual origin: ${r}`),!a||this.Mr&&!n)return;try{s=JSON.parse(t.data)}catch(t){return void this.Qi.ULS.lt(596464282,e.O,i.Info,`Failed to parse event data: ${ne(t)}.`)}const c=s.MessageId;if(!c)return void((this.Ur||this.Or)&&this.Qi.ULS.lt(595730520,e.O,i.Info,"Could not find message id"));if(this.Qi.ULS.lt(595714715,e.O,i.Info,`Received messageId: ${c}, correlation: ${s.CorrelationId}`),c!==me.us&&c!==me.$s||this.Sc(t.origin),this.$r&&c===me.Yo)return window._pageTimings=window._pageTimings??{},void(window._pageTimings[s.Values.name]=s.Values.time);s.Values&&s.Values.ackExpected&&this.Ic(t.source,t.origin,s.CorrelationId);const h=this.dc[c];if(!h)return this.Qi.ULS.lt(596464289,e.O,i.Info,`No handler found for message id: ${c}`),void(this.vc&&c===me.Ws&&(this.gc.push(s),this.Qi.ULS.lt(543207888,e.O,i.Info,`Kept for later process: ${c}`)));this.Qi.ULS.lt(596464288,e.O,i.Info,`Processing message: ${c}`),c===me.so&&(s.Values={...s.Values||{},sendTimeAsClickTime:s.SendTime});try{h(s.Values||{})}catch(t){this.Qi.ULS.lt(593773704,e.O,i.Error,`Handler error: ${ne(t)}`)}this.vc&&c===me.us&&this._c()},this._c=()=>{this.vc=!1,this.gc.forEach((t=>{const s=t.MessageId,o=this.dc[s];if(o){this.Qi.ULS.lt(543207890,e.O,i.Info,`Processing message after boot complete: ${s}`);try{o(t.Values||{})}catch(t){this.Qi.ULS.lt(543207891,e.O,i.Error,`Handler error: ${ne(t)}`)}}else this.Qi.ULS.lt(543207889,e.O,i.Info,`No handler found after boot complete: ${s}`)})),this.gc=[]},this.uc=(e,t,i)=>{e.postMessage(t,i)},this.Sc=t=>{const s=t.toLowerCase();this.Fr&&this.Fr!==s&&this.Qi.ULS.lt(596128131,e.O,i.Warning,`Updating origin: [${M(this.Fr)}]->[${M(s)}]`),this.Fr=s,this.Rr=C(s,2),this.Ur=v(s),this.Or=I(s)},!t)throw new Error("Missing origin for PostMessageHandler");this.Ur=v(t),this.Or=I(t),this.Qi=s,this.Sc(t),this.$r=!!window.location?.search?.match(/wdpa=1/gi)||"1"===Me("EnableMetricLogging")}}const ii="Boot_HeartBeat",si="_FrameError";class oi{setFrameError(){this.bc=!0}setTimeoutStage(e){this.Cc=e,this.yc=ii+"_"+e+(this.bc?si:"")}restart(){const t=this.Tc.getValue(ee.Nt,!1);this.Ec=K()+(this.Ac?this.Ac:this.Tc.getValue(ee.Ot,6e5));const s=this.Ur?3e3:5e3;this.Pc=window.setInterval((()=>{t&&this.Qi.ULS.lt(595724178,e.O,i.Info,this.yc),K()>this.Ec&&(this.stop(),this.Fc(),this.Rc&&this.Rc())}),this.Tc.getValue(ee.$t,s)),this.Uc.push(window.setTimeout(this.Fc,this.Tc.getValue(ee.Wt,3e4),1)),this.Uc.push(window.setTimeout(this.Fc,this.Tc.getValue(ee.Mt,12e4),2)),this.Uc.push(window.setTimeout(this.Fc,this.Tc.getValue(ee.xt,18e4),3))}stop(){this.Ec=0,this.Pc&&(window.clearInterval(this.Pc),this.Pc=void 0),this.Uc.forEach((e=>{window.clearTimeout(e)})),this.Uc=[]}constructor(t,s,o,n,r){this.Ec=0,this.Uc=[],this.Ur=!1,this.yc=ii,this.bc=!1,this.Cc="FrameCreated",this.Fc=t=>{const s="Boot_NotComplete_"+(t||"Final")+"_"+this.Cc+(this.bc?si:"");this.Qi.ULS.lt(594901218,e.O,i.Warning,s),this.Qi.ULS.flush()},this.Ur=t,this.Tc=s,this.Qi=o,this.Rc=n,this.Ac=r,this.restart()}}function ni(e){localStorage.setItem(e.flightKey,e.flightValue.toString())}const ri=(t,s,o,n,r)=>t!==me.rn?Promise.reject("Wrong flow"):new Promise((t=>{const n=s.flightKey,r=s.flightValue;o.logger.ULS.lt(507343134,e.ve,i.Info,`setWacFlightValue ${n}: ${r}`),ni(s),t({completion:"success"})}));function ai(e){const t=window.navigator;if(t&&t.virtualKeyboard&&void 0!==t.virtualKeyboard.overlaysContent&&window===top)return t.virtualKeyboard.overlaysContent=e}const ci=(e,t,i,s,o)=>e!==me.io?Promise.reject("Wrong flow"):new Promise((e=>{ai(t.overlayContent),i.container&&i.container.postMessage(fe.Kn,void 0),e({completion:"success"})}));function hi(e){return Me(e.hostKey)}const li=(t,s,o,n,r)=>t!==me.xs?Promise.reject("Wrong flow"):new Promise((t=>{const n=s.hostKey;o.logger.ULS.lt(574408915,e.O,i.Info,`getHostKeyValue ${n}`);const r=hi(s);o.container&&o.container.postMessage(fe.Cn,{hostKey:n,hostValue:r}),t({completion:"success"})}));function di(e){xe(e.hostKey,e.hostValue,Oe)}const ui=(t,s,o,n,r)=>t!==me.ao?Promise.reject("Wrong flow"):new Promise((t=>{const n=s.hostKey,r=s.hostValue;o.logger.ULS.lt(574408914,e.O,i.Info,`storeHostKeyValue ${n}: ${r}`),di(s),t({completion:"success"})}));class pi{Boot(){this.Qi.ULS.lt(596444241,e.O,i.Info,"Initializing WAC frame");const t=Qt(this.Oc,this.Wc,!0),s=function(t,s){const o={};if(t.wopiInfo&&(o[He.Xr]=t.wopiInfo.AccessToken,o[He.Zr]=Yt(t.wopiInfo),t.wopiInfo.WacToken&&(o[He.Qr]=t.wopiInfo.WacToken)),t.wopiPrecheckInfo.BundleInfo&&t.wopiPrecheckInfo.BundleInfo.Url&&t.wopiPrecheckInfo.BundleInfo.Url.length>0)if(o[He.Yr]=t.wopiPrecheckInfo.BundleInfo.Url,null!=t.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==t.wopiPrecheckInfo.BundleInfo.BundleStaleness){const n=t.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();s.ULS.lt(593503580,e.O,i.Info,"Content bundle staleness - "+n),o[He.ea]=n}else s.ULS.lt(593503581,e.O,i.Info,"Content bundle staleness does not exist");if(t.wopiPrecheckInfo.FileGetUrl&&(o[He.aa]=t.wopiPrecheckInfo.FileGetUrl),t.wopiPrecheckInfo.CustomFontCatalogUrl&&(o[He.ca]=t.wopiPrecheckInfo.CustomFontCatalogUrl),t.wopiPrecheckInfo.FileName){const e=oe(t.wopiPrecheckInfo.FileName);e&&(o[He.ra]=e),o[He.ha]=t.wopiPrecheckInfo.FileName}t.newFileTemplateSource&&t.newFileTemplateSource.FileSize?o[He.la]=t.newFileTemplateSource.FileSize.toString():t.wopiPrecheckInfo.FileSize&&(o[He.la]=t.wopiPrecheckInfo.FileSize.toString()),t.sessionInformation.UserId&&(o[He.Sa]=t.sessionInformation.UserId),t.sessionInformation.OwnerId&&(o[He.wa]=t.sessionInformation.OwnerId),t.sessionInformation.SessionContext&&(o[He.ga]=t.sessionInformation.SessionContext),void 0!==t.sessionInformation.SupportsZipIt&&(o[He.Da]=t.sessionInformation.SupportsZipIt.toString()),t.diagnostics.HostInitDiagnostics&&(o[He.pa]=JSON.stringify({HostInitializeDiagnostics:t.diagnostics.HostInitDiagnostics,ClientDiagnostics:t.diagnostics.ClientDiagnostics})),o[He.na]=ae(t.featureManager,t.sessionInformation.WdParams),t.applicationCustomSettings&&t.applicationCustomSettings.HostUIControls&&(o[He.fa]=JSON.stringify(t.applicationCustomSettings.HostUIControls)),o[He.ua]=String(window.devicePixelRatio>1.24),o[He.va]=String(u()),o[He.ma]=t.sessionInformation.HostName;const n=t.newFileTemplateSource;n&&n.FileGetUrl&&(o[He.Ia]=n.FileGetUrl),n&&n.DocUniqueId?o[He.ta]=n.DocUniqueId:t.wopiPrecheckInfo.DocUniqueId&&(o[He.ta]=t.wopiPrecheckInfo.DocUniqueId),n&&n.ETag?o[He.oa]=n.ETag:t.wopiPrecheckInfo.ETag&&(o[He.oa]=t.wopiPrecheckInfo.ETag),o[He.Ca]=(new Intl.DateTimeFormat).resolvedOptions().timeZone,"Templatization"!==t.sessionInformation.ContentAssemblyMode&&"DocGen"!==t.sessionInformation.ContentAssemblyMode&&"ContentAssemblyEdit"!==t.sessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==t.sessionInformation.ContentAssemblyMode||(o[He.ya]="1"),t.sessionInformation.ContentAssemblyMode&&(o[He.Ha]=t.sessionInformation.ContentAssemblyMode);const r=t.sessionInformation.Meeting;r&&(r.id&&(o[He.Ta]=r.id),r.title&&(o[He.Ea]=r.title),r.type&&(o[He.Aa]=r.type),r.scheduledStartTime&&(o[He.Fa]=r.scheduledStartTime),r.scheduledEndTime&&(o[He.Fa]=r.scheduledEndTime),r.joinUrl&&(o[He.Oa]=encodeURIComponent(r.joinUrl)),r.organizerId&&(o[He.Ua]=r.organizerId),r.isPresenter&&(o[He.Ra]=r.isPresenter.toString()),r.isMeetingTeamsRoom&&(o[He.Wa]=r.isMeetingTeamsRoom.toString()));const a=t.sessionInformation.OwlVersion;a&&(o[He.xa]=a);const c=t.sessionInformation.OwlRollout;c&&(o[He.ka]=c);const h=t.sessionInformation.SupportsInPlaceCreateNew;h&&(o[He.La]=h.toString()),t.sessionInformation.DisableEmbedViewCodeSnippet&&(o[He.Va]="1"),t.sessionInformation.DisableCoEditInTeams&&(o[He.Ba]="1"),o[He.Ma]=B();const l=t.sessionInformation.TraceParent;if(l){o[He.$a]=l;const e=t.sessionInformation.TraceState;e&&(o[He.Na]=e)}return o}(this.Oc,this.Qi);if(this.Mc.registerMessagePayloadHandler(me.ds,this.xc),this.Mc.registerMessagePayloadHandler(me.ws,this.kc),this.Oc.sessionInformation.SupportsFrameTrustCheck||this.Mc.registerMessagePayloadHandler(me.Us,this.Hc),this.Mc.registerMessagePayloadHandler(me.io,this.$c),this.Mc.registerMessagePayloadHandler(me.xs,this.Nc),this.Mc.registerMessagePayloadHandler(me.ao,this.Dc),this.Mc.registerMessagePayloadHandler(me.rn,this.Lc),this.Wc.ignoreWacFramePostMessages||this.Vc(v(t)),this.Bc(t,s),this.Wc.ignoreWacFramePostMessages){const e=this.Jc();this.Gc(e)}return this.Qi.ULS.lt(595661019,e.O,i.Info,"Created Wac Frame"),this.mc}constructor(t,s,o,n,r,a){if(this.qc=!1,this.Bc=(e,t)=>{this.zc.officeFrameCreateTime=X(),this.jc.frameCreateStartTime=this.zc.officeFrameCreateTime;const i=this.Oc.applicationCustomSettings&&this.Oc.applicationCustomSettings.appFrameName;this.mc=function(e,t,i,s,o,n,r){const a=function(e,t,i){const s=e.ownerDocument.createElement("iframe");s.name=i||Xt,s.id=Xt,s.src="",s.title="Office Online Frame",s.width="100%",s.height="100%",s.marginWidth="0",s.marginHeight="0",s.style.left="0",s.style.top="0",s.style.right="0",s.style.bottom="0",s.style.display="block",s.style.position="absolute",s.style.backgroundColor="transparent",s.style.border="none",s.frameBorder="0",s.setAttribute("allowfullscreen","true"),s.setAttribute("allowTransparency","true");const o=b(t);return s.setAttribute("allow",`microphone ${o}; autoplay ${o}; camera ${o}; clipboard-read ${o}; clipboard-write ${o}; keyboard-map ${o}; display-capture ${o}`),e.appendChild(s),s}(e,t,r);return $t(t)&&xt(o,Zt,s,n),qt(o,i,""),function(e,t,i,s){De(e,s);const o=t.ownerDocument,n=o.createElement("form");n.id=Zt,n.name=Zt,n.action=i,n.target=e.name,n.method="POST";for(const e in s){const t=o.createElement("input");t.type="hidden",t.name=e,t.value=s[e],n.appendChild(t)}return t.appendChild(n),n.submit(),e}(a,e,t,i)}(this.Oc.container,e,t,this.Oc.featureManager,this.Qi,this.Oc.sessionId,i),this.Mc.activate(this.mc)},this.Vc=e=>{this.Mc.registerMessagePayloadHandler(me.us,this.Kc),this.Mc.registerMessagePayloadHandler(me.ls,this.Xc),this.Tt=window.setTimeout(this.Zc,15e3),this.Qc=new oi(e,this.Oc.Et,this.Qi,(()=>{z(this.Oc.remoteTelemetryUrl,Ye,"bootTimeout")}))},this.Lc=t=>{const s=t.flightKey,o=t.flightValue;this.Qi.ULS.lt(507343133,e.ve,i.Info,`storeWacFlightKeyValue ${s}: ${o}`);try{ni(t)}catch(t){this.Qi.ULS.lt(507340380,e.ve,i.Error,`Handler error: ${ne(t)}`)}},this.xc=t=>{const s=t&&t.state?t.state:"unknown";this.Qi.ULS.lt(595714271,e.O,i.Info,`WAC Boot App state:[${s}]`),kt(s)},this.Hc=t=>{const s=Le(this.Qi);this.Qi.ULS.lt(595653903,e.O,i.Info,`Top frame is trusted: ${s}`),this.Yc(fe.Us,{isTopFrameTrusted:s})},this.$c=t=>{const s=ai(t&&t.overlayContent);this.Qi.ULS.lt(587487432,e.O,i.Info,`Overlay content: ${s}`),this.Yc(fe.Kn,void 0)},this.Kc=t=>{if(this.Qi.ULS.lt(595986314,e.O,i.Info,"Received wac complete message"),this.Qi.ULS.flush(),window.clearTimeout(this.Tt),this.Qc&&this.Qc.stop(),Ht(),this.qc)return void this.Qi.ULS.lt(596444234,e.O,i.Info,"Received multiple wac complete or failure messages");this.qc=!0,this.Yc(fe.gn,{}),ot(this.zc,t);const s=this.Jc();this.Gc(s),this.Oc.Et.getValue(ee.Lt,!1)&&(this.Oc.diagnostics.HostInitDiagnostics||(this.Oc.diagnostics.HostInitDiagnostics={}),Ce(this.Oc.diagnostics.HostInitDiagnostics)),this.eh(this.Oc.diagnostics)},this.kc=()=>{this.Qi.ULS.lt(579342464,e.O,i.Info,"Received close tab message");try{window.close()}catch{this.Qi.ULS.lt(579213188,e.O,i.Warning,"Failed to close the browser tab")}},this.Jc=()=>({innerApplicationFrame:this.mc}),this.Xc=t=>{if(this.Qi.ULS.lt(595986315,e.O,i.Error,"Received wac failed message"),this.Qi.ULS.flush(),window.clearTimeout(this.Tt),this.Qc&&this.Qc.stop(),this.qc)return void this.Qi.ULS.lt(596444235,e.O,i.Info,"Received multiple wac complete or failure messages");this.qc=!0,this.Yc(fe.wn,{});const s={errorType:Ke.WacFailed,errorObject:{}};t&&(s.errorObject=t.Error,this.jc.error=s),this.th(s)},this.Nc=t=>{const s=t.hostKey;this.Qi.ULS.lt(574433173,e.O,i.Info,`GetHostKeyValue ${s}`);const o=hi(t);null!=o&&this.Yc(fe.Cn,{hostKey:s,hostValue:o})},this.Dc=t=>{const s=t.hostKey,o=t.hostValue;this.Qi.ULS.lt(574433174,e.O,i.Info,`storeHostKeyValue ${s}: ${o}`),di(t)},this.Zc=()=>{this.qc||this.Qi.ULS.lt(596444236,e.O,i.Warning,"Timeout. SessionTraces:"+JSON.stringify(this.jc))},this.eh=e=>{this.Yc(fe.yn,{HostInitializeDiagnostics:e.HostInitDiagnostics,ClientDiagnostics:e.ClientDiagnostics})},this.Yc=(t,s)=>{this.mc&&this.mc.contentWindow?this.Mc.sendPostMessage(this.mc,t,s):this.Qi.ULS.lt(595955718,e.O,i.Info,"Attempted to send postmessage: "+t)},void 0===s)throw new TypeError("bootFlowInfo");if(s.isSingleStepBoot&&void 0===t.wopiInfo)throw new TypeError("wopiInfo");this.Oc=t,this.Wc=s,this.Qi=o,this.Mc=n,this.Gc=r,this.th=a,this.zc=t.diagnostics.AppInitDiagnostics,this.jc=t.diagnostics.SessionTraces,this.jc.wopiInitializeTime=X()}}class mi{Complete(t,s){if(this.ih)this.Qi.ULS.lt(596444184,e.O,i.Warning,"Complete called after Complete/Fail already called");else{this.Qi.ULS.lt(596444185,e.O,i.Info,"Complete called."),this.Oc.diagnostics.HostInitDiagnostics&&(this.Oc.diagnostics.HostInitDiagnostics.hostCompleteCallTime=X()),this.ih=!0,this.sh=t,this.jc.wopiPendingCompleteTime=X();try{this.Wc.isSingleStepBoot?this.oh():this.nh(),this.rh&&this.Yc(fe.Xn,{}),this.ah(s)}catch(t){this.Qi.ULS.lt(596444186,e.O,i.Error,`Unexpected script error: ${ne(t)}`),z(this.Oc.remoteTelemetryUrl,Ye,"bootException")}finally{this.Qi.ULS.flush()}}}Fail(t){this.ih?this.Qi.ULS.lt(596444187,e.O,i.Warning,"Fail called after Complete/Fail already called"):(this.Qi.ULS.lt(596444188,e.O,i.Warning,"Fail called. Reason: "+(t?JSON.stringify(t):"N/A")),this.ih=!0,this.Wc.isSingleStepBoot?this.hh():this.lh(t),this.Qi.ULS.flush())}Dispose(e,t,i){ze(e||!1,this.Qi,this.Mc,this.mc,(()=>{delete this.mc,t&&t(),this.dh(),this.Mc.dispose()}),void 0,i)}PostWacToken(t,s,o){!function(t,s,o,n,r,a){const c=X();n.ULS.lt(507774684,e.O,i.Important,"postWacToken flow initiated");const h=()=>{a&&a.flush&&a.flush()};r?r.then((r=>{const l=()=>o.sendPostMessage(r,fe.lr,{wacToken:t,postWacTokenStart:s});l();const d=window.setInterval(l,100);o.registerMessagePayloadHandler(me.sn,(t=>{n.ULS.lt(507597019,e.O,i.Info,`postWacToken flow completed in ${X()-c} ms`),window.clearInterval(d),window.clearTimeout(u),a&&(a.PostWacTokenResult="success",a.PostWacTokenEndTime=X(),t&&void 0!==t.TokenAlreadySet&&(a.TokenAlreadySet=t.TokenAlreadySet),h())}));const u=window.setTimeout((()=>{n.ULS.lt(507597018,e.O,i.Warning,"postWacToken flow timed out after 60000 ms"),window.clearInterval(d),a&&(a.PostWacTokenResult="timeout",a.PostWacTokenEndTime=X(),h())}),6e4)})).catch((t=>{n.ULS.lt(507873094,e.O,i.Warning,`This should never reject, error: ${ne(t)}`),a&&(a.PostWacTokenResult="Unexpected JSAPI V1 error",a.PostWacTokenEndTime=X(),h())})):(n.ULS.lt(507846862,e.O,i.Warning,"`Promise` does not exist natively for this browser."),a&&(a.PostWacTokenResult="JSAPI V1 error: Promise not supported in browser",a.PostWacTokenEndTime=X(),h()))}(t,s,this.Mc,this.Qi,this.uh,o)}Boot(){this.Wc.isSingleStepBoot||this.ph(),this.Qi.ULS.flush()}constructor(t,s,o,n,r,a,c){this.rh=!1,this.mh=!1,this.ih=!1,this.fh=null,this.wh=!0,this.gh=!1,this.Ih=!1,this.ph=()=>{this.Qi.ULS.lt(596444231,e.O,i.Info,"Initializing Office frame WITHOUT WOPI info - first step of two step flow."),window.setTimeout(this.Sh,5e3),this.Mc.registerMessagePayloadHandler(me.hs,this._h),this.Mc.registerMessagePayloadHandler(me.eo,this.bh);const t=new pi(this.Oc,this.Wc,this.Qi,this.Mc,this.Gc,this.th);this.mc=t.Boot(),this.Ch&&this.Ch(this.mc)},this.nh=()=>{const t={ParallelizeStartSession:this.wh,WacFrameIsLoaded:this.rh,WacAcceptsStartSessionComplete:this.gh};this.Qi.ULS.lt(596444232,e.O,i.Info,"Completing the initialized application WITH the WOPI info - second step of two step flow. Current app state - "+JSON.stringify(t)),!this.wh||this.rh&&!this.gh?this.rh&&this.yh():this.Th()},this.oh=()=>{this.Qi.ULS.lt(596444233,e.O,i.Info,"Initializing Office frame WITH WOPI info - single step WOPI boot flow."),this.Oc.wopiInfo=this.sh;const t=new pi(this.Oc,this.Wc,this.Qi,this.Mc,this.Gc,this.th);this.mc=t.Boot(),this.Ch(this.mc)},this.lh=t=>{this.rh?(this.Qi.ULS.lt(595968481,e.O,i.Warning,"Fail called and wacframe is able to accept postmessages"),this.Eh(t)):(this.Qi.ULS.lt(595968482,e.O,i.Warning,"Fail was called on the session prior to WacReady."),this.fh=t)},this.Eh=t=>{this.Qi.ULS.lt(596444189,e.O,i.Warning,"Fail called, sending the failure postmessage to IFrame"),this.Yc(fe.jn,t)},this.hh=()=>{this.Qi.ULS.lt(596444190,e.O,i.Warning,"Fail called during single step boot, calling host failure callback..."),this.th({errorType:Ke.InvalidWopiInfo,errorObject:new TypeError("wopiInfo")})},this.Sh=()=>{this.rh||(this.Qi.ULS.lt(596444191,e.O,i.Warning,"Timeout Wac Ready"),this.th({errorType:Ke.TimeoutWacReady,errorObject:void 0}))},this.Ah=()=>{this.ih||(this.jc.timeoutCompleteOrFail=X(),this.Qi.ULS.lt(596444192,e.O,i.Warning,"Timeout Complete or Fail. SessionTraces:"+JSON.stringify(this.jc)))},this.Ph=(t,s,o)=>{this.Ih||(this.Qi.ULS.lt(596444193,e.O,i.Info,"SessionCompletion timed out with no ack."),this.Fh(t,s,o+1))},this._h=t=>{if(this.jc.readyMessageReceiveTime=X(),this.Yc(fe.pn,{}),this.rh)return void this.Qi.ULS.lt(596444194,e.O,i.Info,"Received multiple ready messages - frame is already loaded.");this.rh=!0,this.gh=t&&t.CanAcceptStartSessionComplete;const s={AcceptStartSessionComplete:this.gh,ParallelizeStartSession:this.wh,StartSessionResponseAvailable:!!this.Rh,WopiInfoAvailable:!!this.sh};this.Qi.ULS.lt(596444195,e.O,i.Info,"HandleWacReadyMessage - "+JSON.stringify(s)),this.ih&&(this.fh?this.Eh(this.fh):this.Yc(fe.Xn,{})),this.wh&&this.gh?this.Rh&&this.Uh():this.sh&&this.yh(),ot(this.zc,t)},this.bh=e=>{this.Ih=!0,this.jc.sessionCompleteAckReceivedTime=X()},this.Yc=(e,t)=>{this.Mc.sendPostMessage(this.mc,e,t)},this.Oh=(e,t)=>{this.Fh(e,t,1)},this.Fh=(t,s,o)=>{if(o>3)return void this.Qi.ULS.lt(596444224,e.O,i.Error,`Attempted to call complete, but received no ack from the frame. Time: ${X()}`);this.Qi.ULS.lt(596444225,e.O,i.Info,`Sending completion message to frame. Attempt number: ${o}, Time: ${X()}`);const n=X();1===o&&(this.Rh&&this.Rh.Diagnostics&&(this.Rh.Diagnostics.completeMessageCreateTime=n),this.jc.completeMessageCreateTime=n),s.Diagnostics.completeMessageSendTime=n,this.jc.completeMessageSendTime=n,this.Yc(t,s),window.setTimeout((()=>this.Ph(t,s,o)),1e3)},this.Th=()=>{this.Qi.ULS.lt(596444226,e.O,i.Info,"Making parallelized startSession request.");const t=this.Wh(this.sh),s="access_token="+encodeURIComponent(this.sh.AccessToken)+"&access_token_ttl="+encodeURIComponent(Yt(this.sh));this.jc.startSessionStartTime=X(),function(e,t,i,s){const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(o&&4===o.readyState){if(void 0===o.status||0===o.status)return;try{s&&s(o)}finally{null!=o&&(o.onreadystatechange=()=>{})}}},o.open("POST",e);for(const e in i)o.setRequestHeader(e,i[e]);o.send(t)}(t,s,{"Content-Type":"application/x-www-form-urlencoded"},this.Mh)},this.Mh=t=>{if(this.jc.startSessionCompleteTime=X(),this.jc.startSessionResponseStatus=t.status,this.Rh={StartSessionResponse:{RequestStatus:t.status,ResponseText:t.responseText},Diagnostics:{wopiPendingInitializeTime:this.jc.wopiPendingInitializeTime,wopiPendingCompleteTime:this.jc.wopiPendingCompleteTime,startSessionStartTime:this.jc.startSessionStartTime,startSessionCompleteTime:this.jc.startSessionCompleteTime,readyMessageReceiveTime:this.jc.readyMessageReceiveTime}},this.Qi.ULS.lt(596444227,e.O,i.Info,`StartSession request completed with status code: ${this.Rh.StartSessionResponse.RequestStatus}, Time: ${X()}`),this.rh&&this.gh)return void this.Uh();const s={WacFrameIsLoaded:this.rh,InitializeCompleted:this.mh};this.Qi.ULS.lt(596444228,e.O,i.Info,"StartSessionCompleted not called - "+JSON.stringify(s))},this.yh=()=>{if(this.mh)return;this.mh=!0,this.Qi.ULS.lt(596444229,e.O,i.Info,"Sending wopi info to the frame.");const t={WopiDetails:{WopiSrc:this.sh.WopiSrc,AccessToken:this.sh.AccessToken,AccessTokenTtl:Yt(this.sh)},Diagnostics:{wopiPendingInitializeTime:this.jc.wopiPendingInitializeTime,wopiPendingCompleteTime:this.jc.wopiPendingCompleteTime,readyMessageReceiveTime:this.jc.readyMessageReceiveTime}};this.sh.WacToken&&(t.WopiDetails.WacToken=this.sh.WacToken),this.Oh(fe.In,t)},this.Uh=()=>{200===this.Rh.StartSessionResponse.RequestStatus?this.mh||(this.mh=!0,this.Oh(fe.vn,this.Rh)):this.yh()},this.Wh=e=>{let t=this.Oc.applicationBasePath+"wordeditorstartsession.ashx";const i=Qt(this.Oc,this.Wc,!1);return t+="?"+i.substring(i.indexOf("?")+1),t=A(t,"WOPISrc",encodeURIComponent(e.WopiSrc)),t=A(t,"build",encodeURIComponent(B())),t=A(t,"WacUserType",encodeURIComponent("WOPI")),this.Oc.wopiPrecheckInfo.FileGetUrl&&(t=A(t,"fileGetUrlPresent","1")),t},this.ah=t=>{if(this.Oc.isCreateNew){if(!t||!t.NewFilePath)return void this.Qi.ULS.lt(596444230,e.O,i.Info,"Either NewFileInfo or NewFilePath are not provided for a new file.");history.replaceState({},"",t.NewFilePath),t.UpdatedPageTitle&&(document.title=t.UpdatedPageTitle)}},this.Oc=t,this.Wc=s,this.zc=t.diagnostics.AppInitDiagnostics,this.Qi=o,this.Mc=n,this.Gc=a,this.th=c,Promise&&(this.uh=new Promise((e=>this.Ch=e))),this.jc=t.diagnostics.SessionTraces,this.jc.wopiPendingInitializeTime=X(),this.dh=r,qe(),window.setTimeout(this.Ah,5e3)}}class fi{registerEventHandler(e){this.dc.push(e)}removeEventHandler(e){if(e){const t=this.dc.indexOf(e);this.dc.splice(t,1)}}stop(){document.removeEventListener("visibilitychange",this.xh)}getVisibilityChangeEvents(){return this.kh}dispose(){this.stop(),this.dc=[],this.kh=[]}constructor(){if(this.kh=[],this.dc=[],this.xh=()=>{const e={visibility:document.visibilityState,time:X(),initialState:!1};this.kh.push(e);for(const t of this.dc)t&&t(e)},"hidden"===document.visibilityState){const e={visibility:document.visibilityState,time:X(),initialState:!0};this.kh.push(e)}document.addEventListener("visibilitychange",this.xh)}}const wi=`excel-boot${J}.js`,gi=[];function vi(t){window.performance&&window.performance.getEntriesByType&&window.addEventListener("load",(()=>{try{for(const s of window.performance.getEntriesByType("resource")){const o=R(s.name);if("about:blank"!==s.name&&-1===o.indexOf(w)&&-1===o.indexOf("mhtml:file"))if(o===wi){let n=JSON.stringify(s);n=n.replace(new RegExp(s.name,"g"),o),t.ULS.lt(574662801,e.O,i.Info,n)}else if(-1!==gi.indexOf(o)){let n=JSON.stringify(s);n=n.replace(new RegExp(s.name,"g"),o),t.ULS.lt(595736532,e.O,i.Info,n)}}try{const s=window.performance.getEntriesByType("navigation");let o;o=s.length>0?s[0].type||"UndefinedType":"none",t.ULS.lt(555872898,e.O,i.Info,`Navigation type is: ${o}`)}catch(s){t.ULS.lt(556011586,e.O,i.Info,"ExcelPreloader.tryObserveResourceTiming: Exception thrown when trying to read navigation type. Exception: "+JSON.stringify(s))}window.performance.clearResourceTimings()}catch(s){t.ULS.lt(595732049,e.O,i.Info,"ExcelPreloader.tryObserveResourceTiming: could not trace resource timing, error is: "+JSON.stringify(s))}}),{once:!0})}const Ii="_api/SP.Utilities.WOPIHostUtility.GenerateFileBundle";let Si,_i;function bi(t,s=void 0,o=void 0){Si=t;try{if(o){const e=(e,t)=>{Ci(t)};o.addActionHandler(me.bo,e)}else s&&s.registerMessagePayloadHandler(me.bo,(e=>{Ci(e)}))}catch(t){Si.ULS.lt(572383452,e.O,i.Warning,`ExcelFileBundleRegenerationRequester.initRegenerateFileBundleMessageHandler: ${ne(t)}`)}}function Ci(t){if(t&&t.hasOwnProperty("fileUrl")&&t.hasOwnProperty("fileType"))try{const s=function(){const t=new Ti,s=new XMLHttpRequest;return s.timeout=3e4,s.withCredentials=!0,s.onreadystatechange=function(){s.readyState===XMLHttpRequest.DONE&&(200===s.status?(t.IsSucceeded=!0,t.HostCorrelationId=function(t){let s=null;try{const e=(new window.DOMParser).parseFromString(t,"text/xml");s=new URL(e.documentElement.textContent??"").searchParams.get("correlationId")}catch(t){Si.ULS.lt(572383454,e.O,i.Warning,`ExcelFileBundleRegenerationRequester.readSpoCorrelationFromResponse: ${ne(t)}`)}return s}(s.responseText)):t.FailureReason=`XhrHttp${s.status}`,yi(t))},s.onerror=function(e){t.FailureReason="XhrError",yi(t)},s}(),o=function(e){const t=new URL(e.fileUrl).origin,i=new URL(t);return i.pathname=Ii,i.searchParams.set("fileUrl",e.fileUrl),i.searchParams.set("fileType",e.fileType),i}(t);s.open("GET",o.toString(),!0),s.send()}catch(t){Si.ULS.lt(572381152,e.O,i.Warning,`ExcelFileBundleRegenerationRequester.handleRegenerateFileBundleMessage: ${ne(t)}`)}else Si.ULS.lt(572383453,e.O,i.Warning,`ExcelFileBundleRegenerationRequester.handleRegenerateFileBundleMessage: Message is missing parameter(s). values=null? ${!t},\n        fileUrl=null? ${t&&!t.hasOwnProperty("fileUrl")}, fileType=null? ${t&&!t.hasOwnProperty("fileType")}`)}function yi(t){Si.ULS.lt(572383455,e.O,i.Warning,`ExcelFileBundleRegenerationRequester.logResult: ${JSON.stringify(t)}`)}class Ti{constructor(){this.IsSucceeded=!1,this.HostCorrelationId=null,this.FailureReason=null}}function Ei(t,s=void 0,o=void 0){_i=t;const n=t=>{t.forEach((t=>{t?function(t,s,o){if(!Le(_i))return;const n="addqsp"===t?.toLowerCase(),r="removeqsp"===t?.toLowerCase();s?n?Ai(!0,!1,s,o):r?Ai(!1,!0,s,o):_i.ULS.lt(508864545,e.O,i.Error,"Does not contain expected values."):_i.ULS.lt(508864546,e.O,i.Warning,"handleHostFrameModifyURLState: qspName is null.")}(t.ops,t.qspName,t.qspValue):_i.ULS.lt(508864544,e.O,i.Warning,"handleHostFrameModifyURLState: MessageData is null.")}))};try{if(o){const e=(e,t)=>{n(t)};o.addActionHandler(me.tn,e)}else s&&s.registerMessagePayloadHandler(me.tn,(e=>{n(e)}))}catch(t){_i.ULS.lt(508864547,e.O,i.Error,"ExcelModifyURLStateManager: error while initializing.")}}function Ai(t,s,o,n){const r=new URLSearchParams(window.location.search);t&&n?r?.set(o,n):s&&r?.delete(o);try{window.history.replaceState({},"",window.location.origin+window.location.pathname+"?"+r.toString()),_i.ULS.lt(508864543,e.O,i.Info,` ${t?"Added":"Removed"} querystring param from url of hostframe`)}catch(t){_i.ULS.lt(508864542,e.O,i.Warning,`ExcelModifyURLStateManager: error while changing state of hostframe:\n        ${ne(t)}`)}}const Pi="excel";function Fi(t){t.ULS.lt(590914655,e.O,i.Info,`Time spent logging: ${t.getTimeSpentLogging()}`)}function Ri(e){return{...e.AppInitDiagnostics,...e.HostInitDiagnostics,SessionTraces:e.SessionTraces}}var Ui;!function(e){e.BrowserEvent="BrowserEvent",e.AcquireOAuthTokenTeams="AcquireOAuthTokenTeams",e.PageChanged="PageChanged",e.ZoomChanged="ZoomChanged",e.ContentRefreshBegin="ContentRefreshBegin",e.ContentRefreshEnd="ContentRefreshEnd",e.AppClosed="UI_Close",e.UserEdit="Edit_Notification",e.FileRename="File_Rename",e.FileShare="UI_Sharing",e.ShowFileVersions="UI_FileVersions",e.UIWorkflow="UI_Workflow",e.IsDisabled="IsDisabled",e.AccessibilityLoopComplete="App_AccessibilityLoopComplete",e.Unloaded="Unloaded",e.Disposed="Disposed",e.SwitchMode="App_SwitchMode",e.DocumentReboot="DocReboot",e.WopiInfoFromUrl="WopiInfoFromUrl",e.DavUrlFromIds="DavUrlFromIds",e.ModeSwitched="ModeSwitched",e.CreateNewDocument="App_CreateNewDocument",e.GetAuthToken="GetAuthToken",e.GetCustomAuthConfig="GetCustomAuthConfig",e.SetOverlayContent="SetOverlayContent",e.MoveToFolder="MoveToFolder",e.SharedFilePicker="SharedFilePicker"}(Ui||(Ui={}));class Oi{GetApplicationType(){return Ye}GetVersion(){return B()}GetSessionId(){return this.Hh}RegisterEventHandler(e,t){switch(e){case Ui.Unloaded:case Ui.Disposed:case Ui.DocumentReboot:case Ui.WopiInfoFromUrl:case Ui.DavUrlFromIds:case Ui.GetAuthToken:case Ui.GetCustomAuthConfig:case Ui.MoveToFolder:case Ui.SharedFilePicker:case Ui.SetOverlayContent:case Ui.FileShare:if(this.dc[e])throw new Error("Duplicate registration");this.dc[e]=t;break;default:this.Mc.registerMessagePayloadHandler(e,t)}}RemoveEventHandler(e,t){switch(e){case Ui.Unloaded:case Ui.Disposed:case Ui.DocumentReboot:case Ui.FileShare:case Ui.WopiInfoFromUrl:case Ui.DavUrlFromIds:case Ui.GetAuthToken:case Ui.GetCustomAuthConfig:case Ui.MoveToFolder:case Ui.SharedFilePicker:case Ui.SetOverlayContent:if(this.dc[e]!==t)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.dc[e];break;default:this.Mc.removeMessageHandler(e)}}RegisterErrorHandler(e){}RemoveErrorHandler(e){}PostCommand(e,t){this.Mc.postMessageForCommand(this.mc,e,t)}Dispose(t,s){ze(t||!1,this.Qi,this.Mc,this.mc,(()=>{delete this.mc,this.$h(),this.Mc.dispose(),this.Nh(Ui.Unloaded,{})}),(()=>{try{this.Nh(Ui.Disposed,{}),this.dc={}}catch(t){this.Qi.ULS.lt(589108815,e.O,i.Error,`onFrameRemoved error: ${ne(t)}`)}}),s)}constructor(t,s,o,n,r){this.dc={},this.Dh=()=>{this.Mc.registerMessagePayloadHandler(me.zs,this.Lh),this.Mc.registerMessagePayloadHandler(me.ks,this.Vh),this.Mc.registerMessagePayloadHandler(me.Hs,this.Bh),this.Mc.registerMessagePayloadHandler(me.Ws,this.Jh),this.Mc.registerMessagePayloadHandler(me.so,this.Gh),this.Mc.registerMessagePayloadHandler(me.Ms,this.qh),this.Mc.registerMessagePayloadHandler(me.Ds,this.zh),this.Mc.registerMessagePayloadHandler(me.Qs,this.jh)},this.Nh=(t,s)=>{const o=this.dc[t];if(o)try{o(s||{})}catch(t){this.Qi.ULS.lt(593773706,e.O,i.Error,`Handler error: ${ne(t)}`)}},this.Lh=e=>{e.previousSessionId=this.Hh,this.Nh(Ui.DocumentReboot,e)},this.Vh=e=>{this.Nh(Ui.WopiInfoFromUrl,e)},this.Bh=e=>{this.Nh(Ui.DavUrlFromIds,e)},this.Jh=e=>{Promise?this.Kh.isResourceTrustedForMessage(e).then((t=>{t?this.Nh(Ui.GetAuthToken,e):this.Mc.sendPostMessage(this.mc,fe.$n,{AuthToken:"",Error:"accessDenied",RequestId:e.RequestId,IdentityType:e.IdentityType})}),(()=>{this.Mc.sendPostMessage(this.mc,fe.$n,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:e.RequestId,IdentityType:e.IdentityType})})):this.Mc.sendPostMessage(this.mc,fe.$n,{AuthToken:"",Error:'"Promise" does not exist natively in browser',RequestId:e.RequestId,IdentityType:e.IdentityType})},this.Gh=e=>{this.Nh(Ui.FileShare,e)},this.qh=e=>{this.Nh(Ui.GetCustomAuthConfig,e)},this.zh=e=>{this.Nh(Ui.MoveToFolder,e)},this.jh=e=>{this.Nh(Ui.SharedFilePicker,e)},this.Hh=t,this.Qi=s,this.mc=r.innerApplicationFrame,this.Mc=o,this.$h=n,this.Kh=new Pe(s),this.Dh(),qe()}}function Wi(e,t,i){return!(!i?.host?.uiHostName||!["OutlookMobileAndroid","OutlookMobileiOS","OutlookIpad","OutlookAndroidTablet"].includes(i.host.uiHostName))||gt(e)&&!Mi(t)}const Mi=function(e){return[o.Chrome,o.Edge].includes(h())&&(!e||"https://onedrive.live.com"!==e.toLowerCase())};function xi(t,s,o,n,r){let a={};if(r)a=r;else try{a=JSON.parse("###JSAPIHASHES###")}catch(t){n&&n.ULS.lt(589178847,e.O,i.Info,"GetExcelResources failed to parse hash dictionary")}let c="";try{const s=b(t);c=s.includes("res")?`${s}/officeonline${ct}s/`:U(`${s}${ct}s/`),!s.includes("res")&&wt.some((e=>s.includes(e)))&&(c=s.includes("c5")?"https://res.df.onecdn.static.microsoft/officeonline/x/s/":s.includes("c4")?"https://res.public.onecdn.static.microsoft/officeonline/x/s/":"https://res-1.cdn.office.net/officeonline/x/s/"),n&&n.ULS.lt(505278556,e.O,i.Info,`GetExcelResources: ResourceBase url: ${c}`)}catch(s){c=U(`${b(t)}${ct}s/`),n&&n.ULS.lt(505280017,e.O,i.Error,`GetExcelResources: Error in building resourceBase: ${s}`)}const h=function(e){const t=e?e.toLowerCase().split("-")[0]:"en";return H[t]}(s??"en-US"),l=[["App_Scripts/EwaTS.js",!1],[`App_Scripts/gridRenderer${J}.js`,!1]],d=[];for(const[t,s]of l){const o=t.substring(t.lastIndexOf("/")+1);if(gi.push(o),s&&"1033"!==h)continue;const r=o.toLowerCase();if(console.log("lowerCaseFile"),a&&a[r]){const s=a[r].UrlHash,h=a[r].SriHash;if(s&&h){const r=c+s+"__layouts/"+t;d.push([r,"sha256-"+h]),n&&n.ULS.lt(589178849,e.O,i.Info,`GetExcelResources adding hashed url for ${o}`)}}}let u="";for(const e of d)u+=`${e[0]}, `;return n&&d.length>0&&n.ULS.lt(505278555,e.O,i.Important,`GetExcelResource urls: ${u}`),d}const ki=(t,s,o,n,r)=>t!==me.zs?Promise.reject("Wrong flow"):new Promise((t=>{let n;if(o.pendingReboot=!0,s.queryOverrides)try{n=JSON.parse(s.queryOverrides)}catch(t){o.logger.ULS.lt(592217694,e.O,i.Error,`Failed to parse queryOverrides: ${n}`)}o.raiseEvent(we.Reboot,{...s,previousSessionId:o.sessionId,queryOverrides:n}),t({completion:"success"})}));function Hi(e){const t={};y(t,"jsapi","1"),y(t,"jsapiver","v2"),y(t,"corrid",e.sessionId),y(t,"usid",e.sessionId),y(t,"newsession","1"),y(t,"sftc","1"),e.hostSessionId&&y(t,"hid",encodeURIComponent(e.hostSessionId));const i=e.host;i.uiHostName&&y(t,"uih",i.uiHostName),i.uiHostIntegrationType&&y(t,"uihit",encodeURIComponent(i.uiHostIntegrationType)),i.metaUiHostVersion&&y(t,"muv",encodeURIComponent(i.metaUiHostVersion)),i.topOrigin&&y(t,"to",encodeURIComponent(i.topOrigin)),i.isDeeplyNestedAuthSupportedInTeams&&y(t,"dnaa","1");const s=i.capabilities;s&&(s.accessibilityLoop&&y(t,"accloop","1"),s.rebootDoc&&y(t,"sdr",s.rebootDoc.toString()),s.createNewDoc&&y(t,"scnd","1"),s.authToken&&y(t,"sat","1"),window.docAspxMsalEnabled&&"onedrivecom"!==i.uiHostName&&(s.authTokenStrategy="PairwiseBroker"),s.authTokenStrategy&&y(t,"ats",s.authTokenStrategy),s.customAuthConfig&&y(t,"cac","1"),s.refreshAccessToken&&y(t,"rat","1"),s.atMentions&&y(t,"sams","1"),s.moveToFolder&&y(t,"mtf","1"),s.noBrowserModalDialogs&&y(t,"nbmd","1"),s.commonFilePicker&&y(t,"sfp","1"),s.directDownload&&y(t,"sdd","1"),s.directPrint&&y(t,"sdp","1"),s.disableOfficeAddins&&y(t,"doa","1"));const o=e.ui;o.language&&y(t,"ui",encodeURIComponent(o.language)),o.uiEmbed&&y(t,"uiembed","1"),(o.hideHeader||"DocGen"===o.contentAssemblyMode||"Templatization"===o.contentAssemblyMode||"ContentAssemblyEdit"===o.contentAssemblyMode||"ContentAssemblyView"===o.contentAssemblyMode)&&y(t,"hhdr","1"),o.highContrast&&y(t,"hcm",encodeURIComponent(o.highContrast)),o.hideFileLocationPicker&&y(t,"hodflp","1"),o.hideAppLauncherInHeader&&y(t,"halh","1"),o.hideChatInHeader&&y(t,"hch","1"),o.hideMeInHeader&&y(t,"hmh","1"),o.hideSearchInHeader&&y(t,"hsh","1"),o.hideWorkflowInHeader&&y(t,"hwfh","1"),o.hideSettingsInHeader&&y(t,"hsth","1"),o.showAppIconInHeader&&y(t,"sih","1"),o.useNeutralColorInHeader&&y(t,"unh","1"),o.openLinksInNewWindow&&y(t,"onw","1"),o.useDarkTheme&&y(t,"udt","1"),"DocGen"!==o.contentAssemblyMode&&"ContentAssemblyView"!==o.contentAssemblyMode||y(t,"readOnly","1");const n=e.wopi;n&&n.source&&y(t,"wopisrc",encodeURIComponent(n.source));const r=e.bootParams;r&&(r.dataLanguage&&y(t,"rs",encodeURIComponent(r.dataLanguage)),r.readOnly&&(y(t,"readonly","1"),y(t,"mode","Read")),r.disableChat&&y(t,"dchat","1"),r.cookieCompliant&&y(t,"mscc","1"),r.useBizChatTheme&&y(t,"ubct","1"),r.isNewFile&&(y(t,"new","1"),r.isFromHostTemplate&&y(t,"wdtpl","fromhost"))),e.user.isLicensed&&y(t,"islicenseduser","1"),e.user.isSynthetic&&y(t,"syn","1"),e.actNavId&&y(t,"actnavid",e.actNavId),e.sessionContext&&y(t,"sc",encodeURIComponent(e.sessionContext));const a=e.wdParams;if(a)for(const e in a)y(t,e,a[e]);const c=e.preseededSession;c&&(c.key&&y(t,"preseededsessionkey",encodeURIComponent(c.key)),c.id&&y(t,"preseededwacsessionid",encodeURIComponent(c.id)));const h=e.throttling;h&&(h.protection&&y(t,"ctp",h.protection),h.request&&y(t,"rct",h.request));const l=e.hostInitDiagnostics;l&&(l.entryPoint&&y(t,"wdorigin",encodeURI(l.entryPoint)),l.userClickTime&&y(t,"wdhostclicktime",l.userClickTime.toString()));const d=e.rebootOverride;return d&&d.previousSessionId&&y(t,"wdprevioussession",d.previousSessionId),T(t,"region"),e.bootParams?.afdFlighting&&y(t,"afdflight",Math.floor(100*Math.random()+1).toString()),t}const $i="sideLoadingIsEnabled";const Ni=(t,s,o,n,r)=>t!==pe.boot?Promise.reject("Wrong flow"):new Promise((t=>{const a=X();var c;o.state=D.Booting,o.pendingReboot=!1,function(e,t,i=!1){if(!e)throw new TypeError("SessionBootParams");const s=e.appUrl,o=e.appBaseUrl;if(!s&&!o)throw new TypeError("Either appUrl or appBaseUrl should exist");if(s&&"string"!=typeof s)throw new TypeError("AppUrl");if(o&&"string"!=typeof o)throw new TypeError("AppBaseUrl");const n=e.file;if(!n||!i&&!n.name)throw new TypeError("FileInfo");const r=e.container;if(!r||!(r instanceof Ve)&&!r.appendChild)throw new TypeError("Container");if(!(t||(a=e.wopi)&&a.source&&a.accessToken&&(a.expiry||0===a.expiry)))throw new TypeError("WopiInfo");var a}(s,o.skipWopiValidation,o.skipFileNameCheck),o.intent=s.intent,o.file=s.file,o.customFontCatalogUrl=s.customFontCatalogUrl,o.wopi=s.wopi,o.contentBundle=s.contentBundle,o.newFileTemplate=s.newFileTemplate,o.ownerId=s.ownerId,o.sessionContext=s.sessionContext,o.actNavId=s.actNavId,o.preseededSession=s.preseededSession,o.throttling=s.throttling,o.meeting=s.meeting,o.tenantId=s.tenantId,o.wdParams=(c=s.wdParams,function(e,t){const i={};return t&&Object.keys(t).forEach((e=>{i[e.toLowerCase()]=t[e]})),e.split("&").forEach((e=>{if(/^wd\w+=.+/i.test(e)){const t=e.split("=");i[t[0].toLowerCase()]=t[1]}})),i}(window.location.search?.substring(1)||"",c)),o.pinnedTarget=s.pinnedTarget,o.rebootOverride=s.rebootOverride,o.bootParams=s.bootParams||{},o.hostInitDiagnostics={...s.diagnostics,hostInitializeCallTime:a};let h=!1;const l=o.preseededSession;o.appInfo.usePreseededSessionId&&l&&l.id&&(o.sessionId=l.id,h=!0);let d=!1;const p=s.hostGeneratedSessionId;if(!h&&p&&(o.sessionId=p,d=!0),o.Et.getValue(ee.Lt,!1)&&Ce(o.hostInitDiagnostics),s.appUrl){const e=s.appUrl;o.appUrl=e;const t=o.bootParams;if(O(e,"new")&&(t.isNewFile=!0),!t.dataLanguage){const i=W(e,"rs");i&&(t.dataLanguage=i)}const i=o.ui;if(O(e,"uiembed")&&(i.uiEmbed=!0),!i.language){const t=W(e,"ui");t&&(i.language=t)}if(!o.hostInitDiagnostics.entryPoint){const t=W(e,"wdorigin");t&&(o.hostInitDiagnostics.entryPoint=t)}if(!o.host.uiHostName){const t=W(e,"uih");t&&(o.host.uiHostName=t)}}else o.appUrl="";let m;if(o.appBaseUrl=s.appBaseUrl?s.appBaseUrl.toLowerCase():b(s.appUrl).toLowerCase(),o.appBaseUrl=_(o.appBaseUrl,E(o.appUrl,"region")),o.Et.updateEnvironment(o.appBaseUrl),n.initializeAppContext(o,t,s),o.appBasePath=n.buildAppBasePath(o),s.rebootOverride&&(h||d||([o.sessionId,m]=ve()),o.pageStateObserver=new ye(o.logger,!0),o.authTokenTrustValidator=new Pe(o.logger)),o.logger.ULS.lt(38580693,e.O,i.Info,`User session id: ${o.sessionId}, is preseeded: ${h}, is host generated: ${d}`),o.remoteTelemetryUrl=n.buildRemoteTelemetryUrl(o),z(o.remoteTelemetryUrl,o.appInfo.name,"init"),!o.isLoggerFromOwl){let e=o.Et.getValue(ee.Rt,"").toString();e||(e=o.appBasePath+w),o.logger.configure({remoteUlsEndpoint:e,sessionId:o.sessionId})}if(o.Et.initializePeriodicFetch(o.appBasePath,o.sessionId),m&&o.logger.ULS.lt(590966790,e.O,i.Info,JSON.stringify(m)),function(t){try{const s=t.hostInitDiagnostics;t.logger.ULS.lt(558155803,e.O,i.Info,"HostInitDiagnostics: "+(s?JSON.stringify(s):"N/A")),t.logger.ULS.lt(596444237,e.O,i.Important,JSON.stringify({session:Se(t),client:t.clientDiagnostics}))}catch(s){t.logger.ULS.lt(558155804,e.O,i.Error,`Failed to log init info: ${ne(s)}`)}}(o),n.onContextReady&&n.onContextReady(o),o.appInitDiagnostics={officeSessionId:o.sessionId,officeBootstrapperVersion:B(),hostName:o.hostName,documentLoadedWithTabSwitch:"hidden"===document.visibilityState},document.addEventListener("visibilitychange",(()=>{o.logger.ULS.lt(504411206,e.O,i.Important,"documentLoadedWithTabSwitch changed on document visibility event"),o.appInitDiagnostics.documentLoadedWithTabSwitch=!0}),{once:!0}),window.addEventListener("visibilitychange",(()=>{o.logger.ULS.lt(504411205,e.O,i.Important,"documentLoadedWithTabSwitch changed on window visibility event"),o.appInitDiagnostics.documentLoadedWithTabSwitch=!0}),{once:!0}),!o.container){const e=s.container;o.container=e instanceof Ve?e:o.application.createContainer(e)}o.container.setMessageHandler(o.onMessage);const f=!!n.ignoreCompletionMessage&&n.ignoreCompletionMessage(o),g=(t,s)=>{var r,a;o.successTime=X(),f||(o.container.postMessage(fe.gn,void 0),r=o.appInitDiagnostics,(a=s.Diagnostics)&&Object.keys(a).forEach((e=>{r[e]=a[e]}))),o.Et.addSettingsChangeListener(o.logger.settingsChangeHandler),n.onSuccess&&n.onSuccess(o,s),o.logger.ULS.lt(596448985,e.O,i.Important,JSON.stringify(o.diagnostics)),z(o.remoteTelemetryUrl,o.application.name,"bootSuccess"),o.logger.ULS.flush(),o.container.postMessage(fe.yn,{HostInitializeDiagnostics:o.hostInitDiagnostics,ClientDiagnostics:o.clientDiagnostics}),o.state=D.Booted,S({completion:"success"}),Ie(o.appInfo.name,o.logger)},I=(t,s)=>{o.failureTime=X(),n.onFailure&&n.onFailure(o,s.Error),o.logger.ULS.lt(596448986,e.O,i.Error,JSON.stringify({error:s.Error,diagnostics:o.diagnostics})),z(o.remoteTelemetryUrl,o.application.name,"bootFailure"),o.logger.ULS.flush(),o.state=D.Failed,S({completion:"failure",error:s.Error,errorSource:"app",documentLoadedWithTabSwitch:o.appInitDiagnostics?.documentLoadedWithTabSwitch}),Ie(o.appInfo.name,o.logger)},S=e=>{f||(o.bootHeartBeat&&o.bootHeartBeat.stop(),o.removeActionHandler(me.us,g),o.removeActionHandler(me.ls,I)),t(e)};r&&r.subscribe((()=>{S({completion:r.reason||"cancelled",documentLoadedWithTabSwitch:o.appInitDiagnostics?.documentLoadedWithTabSwitch})})),f||(o.addActionHandler(me.us,g),o.addActionHandler(me.ls,I)),function(e){(function(e){return"wdjs"in e||"wd1js"in e})(e)&&("true"!==window.sessionStorage.getItem($i)?xe($i,"false",0):function(e,t){const i=Me(e);return"true"===i||"false"!==i&&!1}($i)||xe($i,"true",1))}(o.wdParams);const C=n.buildBootRequestParams(o),T=function(e,t,i){let s={...P(e.appUrl),...Hi(e),...i};const o=e.rebootOverride;return o&&o.queryOverrides&&(s={...s,...o.queryOverrides}),function(e,t,i){const s=[];for(const e in i)i[e]&&s.push(e+"="+i[e]);return e+t+(s.length>0?"?"+s.join("&"):"")}(e.appBasePath,t,s)}(o,C.appPageName,C.queryParamsOverrides),A=function(t,s){const o=function(t){const s={};y(s,"highdpi",String(window.devicePixelRatio>1.24)),y(s,"softblockedbrowser",String(u())),y(s,"hostname",t.hostName),y(s,"feature_status",ae(t.featureManager,t.wdParams)),y(s,"jsapibuild",B());const o=t.wopi;o&&(y(s,"access_token",o.accessToken),y(s,"access_token_ttl",o.expiry.toString()),o.wacToken&&y(s,"wac_token",o.wacToken));const n=t.customFontCatalogUrl;n&&y(s,"customfontcatalogurl",n);const r=t.contentBundle;if(r){if(r.url){y(s,"bundlesrc",r.url);const o=r.staleness,n=null!=o;n&&y(s,He.ea,o.toString()),t.logger.ULS.lt(577783775,e.O,i.Info,"Content bundle staleness: "+(n?o:"N/A"))}r.bundleUrlNoAuth&&y(s,"bundleurlnoauth",r.bundleUrlNoAuth),r.bundleCode&&y(s,"bundlecode",r.bundleCode)}const a=t.file,c=a.name;if(c){y(s,"filename",c);const e=oe(c);e&&y(s,"fileextension",e)}a.getUrl&&y(s,"filegeturl",a.getUrl),a.downloadCode&&y(s,"filedownloadcode",a.downloadCode),a.urlNoAuth&&y(s,"fileurlnoauth",a.urlNoAuth),a.size&&y(s,"filesize",a.size.toString()),a.eTag&&y(s,"etag",a.eTag),a.cTag&&y(s,"revid",a.cTag),a.uniqueId&&y(s,"docid",a.uniqueId),void 0!==a.immutableReason&&y(s,"immutableReason",a.immutableReason.toString()),void 0!==a.supportsZipIt&&y(s,"supports_zipit",a.supportsZipIt.toString());const h=t.newFileTemplate;h&&(h.getUrl&&y(s,"templateurl",h.getUrl),h.size&&y(s,"filesize",h.size.toString()),h.eTag&&y(s,"etag",h.eTag),h.uniqueId&&y(s,"docid",h.uniqueId)),t.user.id&&y(s,"user_id",t.user.id),t.ownerId&&y(s,"owner_id",t.ownerId),t.sessionContext&&y(s,"sc",t.sessionContext);const l=t.ui;l.controls&&y(s,"huictrls",JSON.stringify(l.controls)),"Templatization"!==l.contentAssemblyMode&&"DocGen"!==l.contentAssemblyMode&&"ContentAssemblyEdit"!==l.contentAssemblyMode&&"ContentAssemblyView"!==l.contentAssemblyMode||y(s,"caae","1"),l.contentAssemblyMode&&y(s,"caaemode",l.contentAssemblyMode);const d=t.meeting;d&&(d.id&&y(s,"meetingId",d.id),d.title&&y(s,"meetingTitle",d.title),d.type&&y(s,"meetingType",d.type),d.scheduledStartTime&&y(s,"scheduledStartTime",d.scheduledStartTime),d.scheduledEndTime&&y(s,"scheduledEndTime",d.scheduledEndTime),d.isPresenter&&y(s,"isPresenter",d.isPresenter.toString()),d.organizerId&&y(s,"meetingOrganizerId",d.organizerId),d.joinUrl&&y(s,"meetingJoinUrl",encodeURIComponent(d.joinUrl)),d.isMeetingTeamsRoom&&y(s,"isMeetingTeamsRoom",d.isMeetingTeamsRoom.toString()));const p=t.host;p.owlVersion&&y(s,"owlver",p.owlVersion),p.owlRollout&&y(s,"owlro",p.owlRollout);const m=p.capabilities;return m&&(m.supportsInPlaceCreateNew&&y(s,"sipcn",m.supportsInPlaceCreateNew.toString()),m.disableEmbedViewCodeSnippet&&y(s,"devcs","1"),m.disableCoEditInTeams&&y(s,"dceit","1")),s}(t);return Object.keys(s).forEach((e=>{s[e]?o[e]=s[e]:delete o[e]})),o}(o,C.postDataOverrides);if(o.bootstrapperUrl&&o.preconnector&&o.preconnector.shouldPreconnect(o.hostName)&&o.preconnector.preconnect(o.bootstrapperUrl),o.bootstrapperUrl&&o.preloader&&o.preloader.shouldPreload(T,o.host.origin,o))try{n.beforePreload&&n.beforePreload(o);let t=o.bootstrapperUrl;o.featureManager.isFeatureEnabled(ie.Pi)&&(o.logger.ULS.lt(590966791,e.O,i.Info,"HTTP2 preload enabled"),t=U(t)),o.preloader.preload(t,o.ui.language,o.logger,o.featureManager)}catch(t){o.logger.ULS.lt(590966792,e.O,i.Error,"Error preloading")}n.beforeContainerBoot&&n.beforeContainerBoot(o,T),o.container.boot(T,A,o.logger,n.buildContainerBootParams(o),(()=>{o.appInitDiagnostics.officeFrameCreateTime=X(),o.appBootState="FrameCreated"}),(()=>{o.appInitDiagnostics.officeFrameLoadTime=X(),o.logger.ULS.lt(506012820,e.O,i.Important,"Frame loaded"),"FrameCreated"===o.appBootState&&(o.appBootState="FrameLoaded",o.bootHeartBeat&&o.bootHeartBeat.setTimeoutStage(o.appBootState))}),(()=>{o.appInitDiagnostics.officeFrameErrorTime=X(),o.logger.ULS.lt(506012819,e.O,i.Error,"Frame error"),o.bootHeartBeat&&o.bootHeartBeat.setFrameError()})),f?g(me.us,{Diagnostics:{bootSuccessWithoutCompletionMessage:!0}}):(o.bootHeartBeat=new oi(v(o.appBaseUrl),o.Et,o.logger,(()=>{o.timeoutTime=X(),n.onTimeout&&n.onTimeout(o),z(o.remoteTelemetryUrl,o.application.name,"bootTimeout"),S({completion:"timeout",error:{documentLoadedWithTabSwitch:o.appInitDiagnostics.documentLoadedWithTabSwitch},timeoutStage:o.appBootState}),r&&r.cancel()}),r&&n.overrideBootTimeout?Math.min(r.timeoutInMs,n.overrideBootTimeout(o)):r?r.timeoutInMs:n.overrideBootTimeout?n.overrideBootTimeout(o):void 0),n.beforeBootCompletionMessage&&n.beforeBootCompletionMessage(o))})).catch((e=>{throw o.failureTime=X(),n.onException&&n.onException(o,e),o.remoteTelemetryUrl&&z(o.remoteTelemetryUrl,o.application.name,"bootException"),o.bootHeartBeat&&o.bootHeartBeat.stop(),{error:e.toString(),errorStack:e.stack}})),Di=(t,s,o,n,r)=>t!==me.ws?Promise.reject("Wrong flow"):new Promise((t=>{try{window.top&&window.top.close()}catch{o.logger.ULS.lt(579213189,e.O,i.Warning,"Failed to close the browser tab")}t({completion:"success"})})),Li=(t,s,o)=>new Promise((s=>{o.logger.ULS.lt(590111070,e.O,i.Error,`Unsupported flow: ${t}`),s({completion:"failure"})}));class Vi{get isCancelled(){return this.Xh}get timeoutInMs(){return this.Zh}get reason(){return this.Qh}cancel(){this.Yh(!1)}subscribe(e){this.Xh?e():this.tl.push(e)}constructor(e){this.Xh=!1,this.Qh="",this.tl=[],this.Yh=e=>{this.Xh||(this.Xh=!0,this.Qh=e?"timeout":"cancelled",this.tl.map((e=>e())),this.tl=[])},this.Zh=e,window.setTimeout((()=>this.Yh(!0)),e)}}function Bi(e){return new Vi(e)}const Ji=(t,s,o,n,r)=>t!==pe.dispose?Promise.reject("Wrong flow"):new Promise((t=>{o.logger.ULS.lt(595714433,e.O,i.Important,"start disposing the application");const a=o.host.requireExplicitUnload,c={disposeStartTime:X(),forceAppUnload:a};o.state=D.Disposing;const h=()=>{o.state=D.Disposed,t({completion:"success"})},l=t=>{n&&n.disposeAppSpecificResources&&n.disposeAppSpecificResources(o,s),o.dispose(),c.disposeEndTime=X(),function(t,s,o){if(o){const e=Number(o.hostMessageReceived);s.appUnloadStartTime&&!isNaN(e)&&(s.hostToAppPostMessageLatency=e-s.appUnloadStartTime);const t=Number(o.appMessageSent);!isNaN(t)&&s.appUnloadEndTime&&(s.appToHostPostMessageLatency=s.appUnloadEndTime-t);const i=Number(o.appUnloadStart),n=Number(o.appUnloadEnd);if(isNaN(i)||isNaN(n)||(s.appUnloadLatency=n-i),o.serverTimings){const e=o.serverTimings;for(const t in e)s["st-"+t.toString()]=e[t]}}t.logger.ULS.lt(592524822,e.O,i.Info,"App disposed: "+JSON.stringify(s)),t.logger.ULS.flushOnClose()}(o,c,t),o.container?o.container.dispose(o.pendingReboot,a).then(h):h()};if(a){c.appUnloadStartTime=X();const e=(e,t)=>{c.appUnloadEndTime=X(),l(t)};o.addActionHandler(me.co,e),(r||new Vi(5e3)).subscribe((()=>{o.state===D.Disposing&&(c.appUnloadTimedOut=!0,l())})),o.container&&o.container.postMessage(fe.Qn,void 0)}else l()})),Gi=(t,s,o,n,r)=>t!==me.Us?Promise.reject("Wrong flow"):new Promise((t=>{if(o.host.capabilities&&o.host.capabilities.frameTrustCheck)o.raiseEvent(we.FrameTrust,s);else{const t=!!o.container&&o.container.isTopFrameTrusted;o.logger.ULS.lt(592445957,e.O,i.Info,`Top frame is trusted: ${t}`),o.container&&o.container.postMessage(fe.Us,{isTopFrameTrusted:t})}t({completion:"success"})})),qi=(e,t,i,s,o)=>e!==me.Ws?Promise.reject("Wrong flow"):new Promise((e=>{i.authTokenTrustValidator.isResourceTrustedForMessage(t).then((s=>{s?i.raiseEvent(we.GetAuthToken,t):(i.container.postMessage(fe.$n,{AuthToken:"",Error:"accessDenied",RequestId:t.RequestId,IdentityType:t.IdentityType}),e({completion:"success"}))}),(s=>{i.container.postMessage(fe.$n,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:t.RequestId,IdentityType:t.IdentityType}),e({completion:"failure",error:s})}))})),zi=(t,s,o,n,r)=>t!==me.ds?Promise.reject("Wrong flow"):new Promise((t=>{const r=s&&s.state?s.state:"Unknown";o.logger.ULS.lt(592839750,e.O,i.Info,`Boot state: [${r}]`),r!==o.appBootState&&(o.appBootState=r,o.bootHeartBeat&&o.bootHeartBeat.setTimeoutStage(r)),n&&n.beforeComplete&&n.beforeComplete(r),t({completion:"success"})})),ji=(t,s,o,n,r)=>{if(t!==pe.postWacToken)return Promise.reject("Wrong flow");const a=K();return o.logger.ULS.lt(507774685,e.O,i.Important,"postWacToken flow initiated"),new Promise((t=>{const n=(t,s)=>{o.logger.ULS.lt(507597017,e.O,i.Info,`postWacToken flow completed in ${K()-a} ms`),window.clearInterval(h),window.clearTimeout(l);const n={completion:"success"};s&&void 0!==s.TokenAlreadySet&&(n.data={TokenAlreadySet:s.TokenAlreadySet}),r(n)},r=e=>{o.removeActionHandler(me.sn,n),t(e)},c=()=>o.container?.postMessage(fe.lr,s);o.addActionHandler(me.sn,n),c();const h=window.setInterval(c,100),l=window.setTimeout((()=>{window.clearInterval(h),o.logger.ULS.lt(507844190,e.O,i.Warning,"postWacToken flow timed out after 60000 milliseconds"),r({completion:"timeout"})}),6e4)}))},Ki=(e,t,i,s,o)=>e!==pe.rename?Promise.reject("Wrong flow"):new Promise((e=>{const s=(e,i)=>{const s={completion:i.NewName===t.NewName?"success":"failure"};r(s)},n=(e,t)=>{r({completion:"failure"})},r=t=>{i.removeActionHandler(me.As,s),i.removeActionHandler(me.Ps,n),e(t)};i.addActionHandler(me.As,s),i.addActionHandler(me.Ps,n),(o||new Vi(5e3)).subscribe((()=>{r({completion:"cancelled"})})),i.container&&i.container.postMessage(fe.kn,t)})),Xi=(e,t,i,s,o)=>e!==pe.switchMode?Promise.reject("Wrong flow"):new Promise((e=>{const s=(e,t)=>{n({completion:"success"})},n=t=>{i.removeActionHandler(me.Ns,s),e(t)};i.addActionHandler(me.Ns,s),(o||new Vi(5e3)).subscribe((()=>{n({completion:"cancelled"})})),i.container&&i.container.postMessage(fe.Zn,t)}));function Zi(e){}function Qi(e){vi(e.logger)}function Yi(e){return e.appBaseUrl+ct}function es(e){return function(e,t){return e+g+(t?"?usid="+t:"")}(e.appBasePath+"_layouts/",e.sessionId)}function ts(t){const s=t.appUrl,o=gt(s),n=vt(s),r=It(s);return o||n||r||t.logger.ULS.lt(553673218,e.O,i.Warning,`Unknown endpoint: ${R(s)}`),!(o||n)}function is(e){const t=e.appUrl,i=gt(t),s=vt(t),o=It(t),n=i?pt:s?mt:o?ft:function(e){const t=e.toLowerCase().indexOf(ct);if(t<0)return"";const i=e.indexOf("?");return i<0?e.substring(t+3):i<t?"":e.substring(t+3,i)}(t),r={},a={};y(r,"wdredirectionreason","Force_SingleStepBoot");const c=e.host.capabilities;c&&c.excelExternalLinks&&y(r,"xlel","1");const h=e.viewMode;h&&(h.hideToolbar&&y(r,"hvt","1"),h.hideEditUpsellDialog&&y(r,"hdeditdlg","1"));const l=e.bootParams;l&&l.isNewFile?(T(r,"unified"),y(r,"edit","1"),y(r,"new","1")):y(r,"instantedit","1");const d=e.ui;d&&(d.hideRibbon&&y(r,"hrbn","1"),d.hideInAppBizChat&&y(r,"hiabc","1")),y(a,He.pa,JSON.stringify({HostInitializeDiagnostics:e.hostInitDiagnostics,ClientDiagnostics:e.clientDiagnostics}));const u={[He.ma]:e.hostName,[He.Sa]:e.user.id,[He.ta]:e.file?.uniqueId||"noDocId"};qt(e.logger,u,""),y(a,He._a,u[He._a]),u[He.ba]&&y(a,He.ba,u[He.ba]),y(a,He.Ca,(new Intl.DateTimeFormat).resolvedOptions().timeZone);const p=e.rebootOverride;if(p){let e=p.mode;e&&(e=e.toLowerCase(),"view"===e?y(r,"wdforcedmode","View"):"edit"===e&&y(r,"wdforcedmode","Edit"))}const m=e.file.size;return m&&m>=52428800&&m<=104857600&&y(r,"ilf","1"),{appPageName:n,queryParamsOverrides:r,postDataOverrides:a}}function ss(e,t){$t(t)&&xt(e.logger,e.container.formId,e.featureManager,e.sessionId),Gt(e.logger,void 0,e),bi(e.logger,void 0,e),Ei(e.logger,void 0,e)}function os(e){return{permissionsPolicy:(t=e.appBaseUrl,`microphone ${t}; autoplay ${t}; camera ${t}; clipboard-read ${t}; clipboard-write ${t}; keyboard-map ${t}; display-capture ${t}; local-network-access ${t}`),useFrameFixForTeams:"teams"===e.host.uiHostName?.toLowerCase()};var t}const ns=()=>[{[ue.appReboot]:ki,[ue.boot]:Ni,[ue.closeTab]:Di,[ue.createNew]:Li,[ue.dispose]:Ji,[ue.frameTrust]:Gi,[ue.getAuthToken]:qi,[ue.getHostKeyValue]:li,[ue.handleBootState]:zi,[ue.postWacToken]:ji,[ue.rename]:Ki,[ue.setWacFlightValue]:ri,[ue.setOverlayContent]:ci,[ue.storeHostKeyValue]:ui,[ue.switchMode]:Xi,[ue.updateBootComplete]:Li},{[ue.boot]:{initializeAppContext:Zi,beforePreload:Qi,buildAppBasePath:Yi,buildRemoteTelemetryUrl:es,ignoreCompletionMessage:ts,buildBootRequestParams:is,beforeContainerBoot:ss,buildContainerBootParams:os,onSuccess:Ht},[ue.handleBootState]:{beforeComplete:kt}}];var rs;!function(e){e[e.NotSupported=0]="NotSupported",e[e.SameDocOnly=1]="SameDocOnly",e[e.AnyDoc=2]="AnyDoc",e[e.OtherMode=4]="OtherMode"}(rs||(rs={}));const as=new class{GetVersion(){return B()}GetMinContentVersion(){throw new Error("Not implemented")}Prefetch(e){if(null!=e&&void 0!==e){const t=document.createElement("link");t.rel="prefetch";let i=e.BootstrapperUrl;".js"!==i.toString().slice(-3)&&(i+=".js"),t.href=i;const s=document.getElementsByTagName("head")[0];null!=s&&void 0!==s&&s.appendChild(t)}}InitializeWopiPending(t,s,o,n,r,a){let c,h,l,d,u=!1;try{o?h=o:[h,l]=ve(),z(tt(t.ApplicationUrl,h),Ye,"init");const p=X();let m;!function(e){if(void 0===e)throw new TypeError("initParams");const t=e.Container;if(void 0===t||void 0===t.appendChild)throw new TypeError("Container");const i=e.SessionInformation;if(void 0===i||void 0===i.HostName||void 0===i.HostSessionId||void 0===i.UserId)throw new TypeError("SessionInformation");const s=e.ApplicationUrl;if(void 0===s||"string"!=typeof s)throw new TypeError("ApplicationUrl");const o=e.WopiPrecheckInfo;if(void 0===o||void 0===o.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===e.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===e.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(t),t.ApplicationUrl=_(t.ApplicationUrl,E(t.ApplicationUrl,"region")),t.ApplicationUrl=F(t.ApplicationUrl,"region"),function(e){const t=e.RebootOverrideData;if(t){t.queryOverrides||(t.queryOverrides={});let e=t.mode;if(e)e=e.toLowerCase(),"view"===e?t.queryOverrides.wdforcedmode="View":"edit"===e&&(t.queryOverrides.wdforcedmode="Edit");else{let e=t.reason;e&&(e=e.toLowerCase(),"saveas"===e&&(t.queryOverrides.wdforcedmode="Edit"))}}}(t),c=s||se({remoteUlsEndpoint:st(t.ApplicationUrl)+w,sessionId:h}),d=it(t,h,c,r,a,this.il.forceSingleStepBoot),a||(d.Et.addSettingsChangeListener(c.settingsChangeHandler),d.Et.initializePeriodicFetch(d.applicationBasePath,h)),d.diagnostics.HostInitDiagnostics&&(d.diagnostics.HostInitDiagnostics.hostInitializeCallTime=p),at(c,d,l),u=!0;const f=t.BootstrapperUrl;f&&(m=this.ol(f,c));const g=()=>{d.Et.dispose(),d.pageStateObserver.dispose(),window.clearInterval(m)},v=b(t.ApplicationUrl),I=n||new ti(v,c),S=new fi,C=function(t,s){let o={isSingleStepBoot:t.forceSingleStepBoot,bootFlowType:t.forceSingleStepBoot?Kt.forceSingleStepBoot:Kt.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1};if(t.forceSingleStepBoot||(o=function(t,s){const o=t.applicationUrl,n=gt(o),r=vt(o),a=It(o),c={isSingleStepBoot:!0,bootFlowType:Kt.forceSingleStepBoot,ignoreWacFramePostMessages:!(n||r)};return n||r||a||s.ULS.lt(553673219,e.O,i.Warning,`Unknown endpoint: ${R(o)}`),c}(t,s)),o.isSingleStepBoot){const n={singleStepBootIsRequired:!0,singleStepBootReason:o.bootFlowType,irmEnabled:t.wopiPrecheckInfo.IrmEnabled,readOnly:t.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:o.ignoreWacFramePostMessages};s.ULS.lt(596444182,e.O,n.irmEnabled?i.Warning:i.Info,JSON.stringify(n))}else s.ULS.lt(596444183,e.O,i.Info,"Received input valid for two step flow");return o}(d,c),y=function(t,s,o,n,r,a,c){return h=>{const l=t.diagnostics;rt(l,n),nt(l.SessionTraces,o,i.Info);const d=Ri(l);o.ULS.lt(596448985,e.O,i.Important,JSON.stringify(d)),z(t.remoteTelemetryUrl,Ye,"bootSuccess");const u=c(t.sessionId,o,s,r,h);try{a(u,d)}catch(t){o.ULS.lt(595719171,e.O,i.Error,`Exception thrown from host's success callback: ${ne(t)}`)}Ie(Pi,o),Fi(o)}}(d,I,c,S,g,t.FnOnInitializeSuccess,this.rl),T=function(t,s,o,n){return r=>{const a=t.diagnostics;rt(a,o),nt(a.SessionTraces,s,i.Warning);const c=Ri(a);void 0!==r&&"Js Boot Failed"!==r.errorObject.errorType&&s.ULS.lt(575931487,e.O,i.Error,"Core JS failure recieved "+JSON.stringify(r)),s.ULS.lt(596448986,e.O,i.Error,JSON.stringify({error:r,appInitDiagnostics:c})),z(t.remoteTelemetryUrl,Ye,"bootFailure");try{n(r,c)}catch(t){s.ULS.lt(595719172,e.O,i.Error,`Exception thrown from host's failure callback: ${ne(t)}`)}Ie(Pi,s),Fi(s)}}(d,c,S,t.FnOnInitializeFailure);t.FnOnAppModeSwitched&&I.registerMessagePayloadHandler(me.Ns,t.FnOnAppModeSwitched),Gt(c,I),bi(c,I),Ei(c,I),vi(c),t.WopiPrecheckInfo.ReadOnly&&t.FnOnAppModeSwitched;const A=E(d.applicationUrl,"uih");if(f&&this.il.preconnector&&this.il.preconnector.shouldPreconnect(A)&&this.il.preconnector.preconnect(f),f&&this.il.preloader&&this.il.preloader.shouldPreload(d.applicationUrl))try{let t=f;d.featureManager.isFeatureEnabled(ie.Pi)&&(c.ULS.lt(595645891,e.O,i.Info,"HTTP2 preload enabled"),t=U(f));let s=d.sessionInformation.UiLocale;s||(s=decodeURIComponent(E(d.applicationUrl,"ui"))),this.il.preloader.preload(t,s,c,d.featureManager)}catch(t){c.ULS.lt(595943884,e.O,i.Error,"Error preloading")}const P=new mi(d,C,c,I,g,y,T);return P.Boot(),P}catch(s){return c&&(c.ULS.lt(596459925,e.O,i.Error,`${Ke.AppInitError}: ${ne(s)}`),u||at(c,d||it(t,h,c,r,a,this.il.forceSingleStepBoot),l),c.ULS.flushOnClose()),void(t&&(t.ApplicationUrl&&z(tt(t.ApplicationUrl,h),Ye,"bootException"),t.FnOnInitializeFailure&&t.FnOnInitializeFailure({errorType:Ke.AppInitError,errorObject:s})))}}constructor(t,s){this.ol=(t,s)=>window.setInterval((()=>{this.Prefetch({BootstrapperUrl:t}),s.ULS.lt(595895774,e.O,i.Info,"Prefetching "+R(t))}),36e5),this.rl=t,this.il=s}}((function(e,t,i,s,o){return new Oi(e,t,i,s,o)}),{forceSingleStepBoot:!1,preloader:x(Wi,xi),preconnector:$(!0)}),cs=e=>{const t={name:"Excel",preloader:x(Wi,xi),preconnector:$(!0)};return new Be(e,t,ns)};((Microsoft=void 0===Microsoft?{}:Microsoft).Office=Microsoft.Office||{}).Excel=r}();
//# sourceMappingURL=excel-boot.f8a2f3c4c5575d888769.js.map