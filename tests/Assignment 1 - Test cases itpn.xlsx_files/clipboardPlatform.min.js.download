var clipboardPlatform;!function(){"use strict";var e={1974:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.promises=function(){return void 0===r[a]&&(r[a]="undefined"!=typeof Promise&&"function"==typeof Promise.resolve&&"function"==typeof Promise.resolve(0).then),r[a]};const r={},a="promises"},7824:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getNewGuid=function(){const e=new Uint8Array(31),t=function(e){const t={crypto:!1,perfNow:!1,exceptions:[]},r="undefined"!=typeof crypto?crypto:"undefined"!=typeof msCrypto?msCrypto:void 0;if(r){t.crypto=!0;try{return r.getRandomValues(e),t}catch(e){t.exceptions.push(`crypto: ${JSON.stringify(e)}`)}}let a=!1;const i="undefined"!=typeof performance?performance:void 0;try{i&&i.now&&i.now()!==1/0&&(a=!0)}catch(e){t.exceptions.push(`perfNow: ${JSON.stringify(e)}`)}for(let r=0;r<e.length;r+=1){try{if(a){t.perfNow=!0;let e=Math.floor(100*i.now())%10;(e<0||e>9)&&(e=0);for(let t=0;t<e;t+=1)Math.random()}}catch(e){t.exceptions.push(`Math.random: ${JSON.stringify(e)}`)}e[r]=Math.floor(16*Math.random())}return t}(e);let r=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const a=15&e[r];return r+=1,("x"===t?a:3&a|8).toString(16)})),t]}},1916:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isReplaceChildrenSupported=t.replaceChildren=void 0,t.replaceChildren=e=>{if(e)if((0,t.isReplaceChildrenSupported)(e))e.replaceChildren();else for(;e.lastChild;)e.removeChild(e.lastChild)},t.isReplaceChildrenSupported=e=>!!e.replaceChildren},7873:function(e,t,r){t.TZ=t.nh=t.kp=t.Hv=t.Wp=t.kA=void 0;const a=r(4780);t.Wp=a;const i=r(2513);Object.defineProperty(t,"Hv",{enumerable:!0,get:function(){return i.ULS}}),Object.defineProperty(t,"kp",{enumerable:!0,get:function(){return i.TraceLevel}}),Object.defineProperty(t,"nh",{enumerable:!0,get:function(){return i.LogCategory}}),r(1974);const o=r(9439);t.TZ=o;r(8674),r(7395);var n=r(7824);Object.defineProperty(t,"kA",{enumerable:!0,get:function(){return n.getNewGuid}});r(2083),r(1916)},2513:function(e,t){var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.NulLogger=t.ConsoleLogger=t.ULS=t.LogCategory=t.TraceLevel=void 0,function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(r||(t.TraceLevel=r={})),function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS"}(a||(t.LogCategory=a={})),t.ULS={getFromExternalLogger:function(e){const t=e;return{ULS:{trace:(e,r,a)=>t.traceTag(0,e,r,a),traceTag:(e,r,a,i)=>t.traceTag(e,r,a,i),debugTrace:(e,r,a)=>t.debugTraceTag(0,e,r,a),debugTraceTag:(e,r,a,i)=>t.debugTraceTag(e,r,a,i),assert:(e,r,a)=>t.assertTag(0,e,r,a),assertTag:(e,r,a,i)=>t.assertTag(e,r,a,i),shipAssert:(e,r,a)=>t.shipAssertTag(0,e,r,a),shipAssertTag:(e,r,a,i)=>t.shipAssertTag(e,r,a,i),dnmTrace:(e,r,a)=>t.dnmTraceTag(0,e,r,a),dnmTraceTag:(e,r,a,i)=>t.dnmTraceTag(e,r,a,i)}}}},t.ConsoleLogger=class{shipAssertTag(e,t,r,a){console.assert(r,"shipAssertTag:",e,t,a)}assertTag(e,t,r,a){console.assert(r,"assertTag",e,t,a)}traceTag(e,t,r,a){console.log("traceTag",e,a,t,r)}dnmTraceTag(e,t,r,a){console.log("dnmTraceTag",e,a,t,r)}debugTraceTag(e,t,r,a){console.log("debugTraceTag",e,a,t,r)}},t.NulLogger=class{shipAssertTag(){}assertTag(){}traceTag(){}debugTraceTag(){}dnmTraceTag(){}}},9439:function(e,t){function r(){const e="undefined"!=typeof self?self:window;return e.performance&&e.performance.now?e.performance.now():Date.now()}function a(e,t,a){e[t]=r()-a}Object.defineProperty(t,"__esModule",{value:!0}),t.start=function(e){const t=r(),i=e,o=t,n={},s=(e,t,r)=>function(e,t,r,i,o,n){a(e,"end",r);const s={sessionName:t,result:i?"success":"failure",message:n,marks:e};o(JSON.stringify(s))}(n,i,o,e,t,r);return n.start=0,{mark:e=>(e=>a(n,e,o))(e),end:e=>s(!0,e),success:(e,t)=>s(!0,e,t),failure:(e,t)=>s(!1,e,t)}},t.mark=function(e,t){void 0!==e&&e.mark(t)},t.end=function(e,t){void 0!==e&&e.end(t)},t.success=function(e,t,r){void 0!==e&&e.success(t,r)},t.failure=function(e,t,r){void 0!==e&&e.failure(t,r)},t.timeStamp=r},2083:function(e,t){var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.TextAreaInputMode=t.TextAreaVirtualKeyboardPolicy=void 0,function(e){e.Auto="auto",e.Manual="manual"}(r||(t.TextAreaVirtualKeyboardPolicy=r={})),function(e){e.None="none",e.Text="text",e.Tel="tel",e.Url="url",e.Email="email",e.Numeric="numeric",e.Decimal="decimal",e.Search="search"}(a||(t.TextAreaInputMode=a={}))},8674:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.initStopwatchFactory=function(e,t=1){return"undefined"!=typeof self&&self.performance&&self.performance.now&&(r=()=>self.performance.now()),function(a){let i=r(),o=a;return{reset(e){null!=e&&(o=e),i=r()},stop(a){const n=r()-i,s=JSON.stringify({Target:o,Duration:n.toFixed(t),StopInfo:a});e(s)}}}};let r=()=>Date.now()},7395:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryCollector=void 0,t.TelemetryCollector=class{getJsonForLogging(){return'{"Events":'+this.getEventsLoggableString()+',"Counters":'+this.getCountersLoggableString()+',"Timers":'+this.getTimersLoggableString()+"}"}addEvent(e,t){null!=e&&null!=t&&(this.events[e]=t)}clearEvents(){this.events={}}getEventsLoggableString(){return JSON.stringify(this.events)}incrementCounter(e){null!=e&&(this.counters.hasOwnProperty(e)?this.counters[e]+=1:this.counters[e]=1)}getCountersLoggableString(){return JSON.stringify(this.counters)}clearCounters(){this.counters={}}startTimer(e){null!=e&&(this.timers[e]={name:e,startTime:Date.now(),endTime:void 0,isRunning:!0,duration:void 0})}endTimer(e){null!=e&&this.timers.hasOwnProperty(e)&&(this.timers[e].endTime=Date.now(),this.timers[e].isRunning=!1,this.timers[e].duration=this.timers[e].endTime-this.timers[e].startTime)}getTimerDuration(e){return null==e?"-1":this.timers.hasOwnProperty(e)&&void 0!==this.timers[e].duration?this.timers[e].duration:"-1"}getTimersLoggableString(){return JSON.stringify(this.timers)}constructor(){this.counters={},this.timers={},this.events={}}}},4780:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultToJSONResultWhenStringifyFails=void 0,t.forEachPromise=function(e,t,r){return e.reduce(((e,a)=>e.then((()=>r&&r.stop?Promise.resolve(void 0):t(a,r)))),Promise.resolve(void 0))},t.getStringifiedError=function(e){if(0===e)return"0";if(!e)return"";try{return JSON.stringify(a(e))}catch{return t.defaultToJSONResultWhenStringifyFails}},t.getPerfWatchMarkName=function(e){if(!e)return"";let t=e.trim().substring(0,200).trim().replace(o,i).substring(0,80);return t&&t.length>0&&t.substr(t.length-1,1)===i&&(t=t.substr(0,t.length-1)),t&&t.length>0&&t.substr(0,1)===i&&(t=t.substr(1)),t},t.retry=function(e,t){if(!e)return Promise.reject(new Error("utils.retry: action can't be null or undefined"));if(t<1)return Promise.reject(new Error(`utils.retry: attempts expected to be greater than 0 but got ${t}`));let r=Promise.reject();for(let a=1;a<=t;a+=1)r=r.catch((t=>e(a,t)));return r},t.chainFallbackPromises=function(e,t){if(!e||0===e.length)return Promise.reject();let r=t(e[0]);for(let a=1;a<e.length;a+=1){const i=e[a];r=r.catch((()=>t(i)))}return r},t.getQueryParameterByName=function(e,t){const r=new RegExp(`[?&]${t}(=([^&#]*)|&|#|$)`).exec(e);if(r)return r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):""},t.decodeHtml=function(e){return"string"==typeof e?(new DOMParser).parseFromString(e,"text/html").documentElement.textContent:e},t.calcHashCode=function(e){if(!e)return 0;let t=5381,r=t;const a=e.length;for(let i=0;i<a&&(t=4294967295&((t<<5)+t^e.charCodeAt(i)),i!==a-1);i+=2)r=4294967295&((r<<5)+r^e.charCodeAt(i+1));let i=t+35685*r+(23896*r<<16)&4294967295;return i<0&&(i+=4294967296),i},t.defaultToJSONResultWhenStringifyFails="...";const r=5;function a(e,t=0){if(t<0||t>r)return e;if(null==e||"object"!=typeof e)return e;const i={};Object.getOwnPropertyNames(e).forEach((t=>{"stack"!==t&&t.toUpperCase()!==t&&(i[t]=e[t])}));const o=Object.getPrototypeOf(e);o&&"object"==typeof o&&Object.keys(o).forEach((t=>{"stack"!==t&&t.toUpperCase()!==t&&(i[t]=e[t])}));const n={};return Object.keys(i).forEach((e=>{n[e]=a(i[e],t+1)})),n}const i="_",o=new RegExp("\\W+","g")},1134:function(e,t){function r(){return void 0===globalThis.__get_change_gate_dictionary_variable?{}:globalThis.__get_change_gate_dictionary_variable()}Object.defineProperty(t,"__esModule",{value:!0}),t.getChangeGateDictionary=r,t.isChangeGateEnabled=function(e){return r()[e]??!0},t.setChangeGateDictionaryGetter=function(e){const t=globalThis.__get_change_gate_dictionary_variable;return globalThis.__get_change_gate_dictionary_variable=e,t}},6485:function(e,t){function r(e){return e.split("")}Object.defineProperty(t,"__esModule",{value:!0}),t.editDistance=function(e,t){const a=r(e),i=r(t);let o=[];for(let e=0;e<=i.length;++e)o[e]=e;for(let e=1;e<=a.length;++e){const t=[e];for(let r=1;r<=i.length;++r)t[r]=a[e-1]===i[r-1]?o[r-1]:1+Math.min(o[r],o[r-1],t[r-1]);o=t}return o[i.length]}},6494:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.disableVerboseMode=function(){globalThis.__office_online_feature_gates_verbose_log_callback=void 0},t.enableVerboseMode=function(e){globalThis.__office_online_feature_gates_verbose_log_callback=e},t.getFeatureGateDictionary=o,t.getStringFeatureGate=n,t.getBooleanFeatureGate=function(e,t){const r=n(e)?.trim().toLowerCase();return"true"===r||"false"!==r&&t},t.getNumberFeatureGate=function(e,t){const r=n(e)?.trim().toLowerCase();if(void 0===r)return t;if("infinity"===r||"+infinity"===r)return 1/0;if("-infinity"===r)return-1/0;const a=parseFloat(r);return isNaN(a)?t:a},t.getIntFeatureGate=function(e,t){const r=n(e)?.trim();if(void 0===r)return t;const a=parseInt(r,10);return isNaN(a)?t:a},t.setFeatureGateDictionaryGetter=function(e){const t=globalThis.__get_feature_gate_dictionary_variable;return globalThis.__get_feature_gate_dictionary_variable=e,t};const a=r(6485),i={};function o(){return void 0===globalThis.__get_feature_gate_dictionary_variable?i:globalThis.__get_feature_gate_dictionary_variable()}function n(e,t){if(void 0===globalThis.__office_online_feature_gates_verbose_log_callback)return o()[e]??t;const r=o();if(Object.hasOwn(r,e))return r[e]??t;const i=globalThis.__office_online_feature_gates_verbose_log_callback;i(`Failed lookup for FeatureGate ${e}...`);const n=[],s=e.toLowerCase();for(const e of Object.keys(r))(0,a.editDistance)(e.toLowerCase(),s)<=4&&n.push(e);return n.length>0&&i(`Potential candidates found (edit distance <= 4, case-insensitive): [${n.join(", ")}]`),i(`FeatureGate override not found, returning default: ${t}`),t}},7454:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const a=r(6533);a.__exportStar(r(6494),t),a.__exportStar(r(6481),t),a.__exportStar(r(1134),t),a.__exportStar(r(6866),t),a.__exportStar(r(7174),t),a.__exportStar(r(5974),t)},6481:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.makeGetTypedFeatureGate=function(e){return function(t){const r=e[t];switch(typeof r){case"boolean":return(0,a.getBooleanFeatureGate)(t,r);case"number":return(0,a.getNumberFeatureGate)(t,r);case"string":return(0,a.getStringFeatureGate)(t,r);default:throw new Error("Wrong defaultValue type")}}};const a=r(6494)},6866:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.makeTypedIsChangeGateEnabled=function(e){return e=>(0,a.isChangeGateEnabled)(e)};const a=r(1134)},7174:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.overrideChangeGates=i,t.overrideTypedChangeGates=function(e,t){return i(t)};const a=r(1134);function i(e){const t=(0,a.setChangeGateDictionaryGetter)(void 0);return(0,a.setChangeGateDictionaryGetter)((()=>({...void 0!==t?t():{},...e}))),t}},5974:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.overrideFeatureGates=i,t.overrideTypedFeatureGates=function(e,t){return i(t)};const a=r(6494);function i(e){const t={};for(const r of Object.keys(e))t[r]=e[r]?.toString();const r=(0,a.setFeatureGateDictionaryGetter)(void 0)??(()=>({}));return(0,a.setFeatureGateDictionaryGetter)((()=>({...r(),...t}))),r}},6533:function(e,t,r){r.r(t),r.d(t,{__addDisposableResource:function(){return W},__assign:function(){return o},__asyncDelegator:function(){return I},__asyncGenerator:function(){return T},__asyncValues:function(){return v},__await:function(){return _},__awaiter:function(){return g},__classPrivateFieldGet:function(){return x},__classPrivateFieldIn:function(){return k},__classPrivateFieldSet:function(){return M},__createBinding:function(){return f},__decorate:function(){return s},__disposeResources:function(){return R},__esDecorate:function(){return c},__exportStar:function(){return S},__extends:function(){return i},__generator:function(){return h},__importDefault:function(){return D},__importStar:function(){return L},__makeTemplateObject:function(){return A},__metadata:function(){return u},__param:function(){return l},__propKey:function(){return p},__read:function(){return y},__rest:function(){return n},__runInitializers:function(){return d},__setFunctionName:function(){return m},__spread:function(){return C},__spreadArray:function(){return w},__spreadArrays:function(){return E},__values:function(){return b},default:function(){return O}});var a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},a(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return o=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)};function n(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(r[a[i]]=e[a[i]])}return r}function s(e,t,r,a){var i,o=arguments.length,n=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,a);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(n=(o<3?i(n):o>3?i(t,r,n):i(t,r))||n);return o>3&&n&&Object.defineProperty(t,r,n),n}function l(e,t){return function(r,a){t(r,a,e)}}function c(e,t,r,a,i,o){function n(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var s,l=a.kind,c="getter"===l?"get":"setter"===l?"set":"value",d=!t&&e?a.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,a.name):{}),m=!1,u=r.length-1;u>=0;u--){var g={};for(var h in a)g[h]="access"===h?{}:a[h];for(var h in a.access)g.access[h]=a.access[h];g.addInitializer=function(e){if(m)throw new TypeError("Cannot add initializers after decoration has completed");o.push(n(e||null))};var f=(0,r[u])("accessor"===l?{get:p.get,set:p.set}:p[c],g);if("accessor"===l){if(void 0===f)continue;if(null===f||"object"!=typeof f)throw new TypeError("Object expected");(s=n(f.get))&&(p.get=s),(s=n(f.set))&&(p.set=s),(s=n(f.init))&&i.unshift(s)}else(s=n(f))&&("field"===l?i.unshift(s):p[c]=s)}d&&Object.defineProperty(d,a.name,p),m=!0}function d(e,t,r){for(var a=arguments.length>2,i=0;i<t.length;i++)r=a?t[i].call(e,r):t[i].call(e);return a?r:void 0}function p(e){return"symbol"==typeof e?e:"".concat(e)}function m(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function g(e,t,r,a){return new(r||(r=Promise))((function(i,o){function n(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}l((a=a.apply(e,t||[])).next())}))}function h(e,t){var r,a,i,o,n={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(n=0)),n;)try{if(r=1,a&&(i=2&s[0]?a.return:s[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,s[1])).done)return i;switch(a=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,a=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(!((i=(i=n.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){n=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(6===s[0]&&n.label<i[1]){n.label=i[1],i=s;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(s);break}i[2]&&n.ops.pop(),n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e],a=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}var f=Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]};function S(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||f(t,e,r)}function b(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,i,o=r.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(a=o.next()).done;)n.push(a.value)}catch(e){i={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return n}function C(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}function E(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var a=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],n=0,s=o.length;n<s;n++,i++)a[i]=o[n];return a}function w(e,t,r){if(r||2===arguments.length)for(var a,i=0,o=t.length;i<o;i++)!a&&i in t||(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return e.concat(a||Array.prototype.slice.call(t))}function _(e){return this instanceof _?(this.v=e,this):new _(e)}function T(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,i=r.apply(e,t||[]),o=[];return a={},n("next"),n("throw"),n("return"),a[Symbol.asyncIterator]=function(){return this},a;function n(e){i[e]&&(a[e]=function(t){return new Promise((function(r,a){o.push([e,t,r,a])>1||s(e,t)}))})}function s(e,t){try{(r=i[e](t)).value instanceof _?Promise.resolve(r.value.v).then(l,c):d(o[0][2],r)}catch(e){d(o[0][3],e)}var r}function l(e){s("next",e)}function c(e){s("throw",e)}function d(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function I(e){var t,r;return t={},a("next"),a("throw",(function(e){throw e})),a("return"),t[Symbol.iterator]=function(){return this},t;function a(a,i){t[a]=e[a]?function(t){return(r=!r)?{value:_(e[a](t)),done:!1}:i?i(t):t}:i}}function v(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=b(e),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(r){t[r]=e[r]&&function(t){return new Promise((function(a,i){!function(e,t,r,a){Promise.resolve(a).then((function(t){e({value:t,done:r})}),t)}(a,i,(t=e[r](t)).done,t.value)}))}}}function A(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var P=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function L(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&f(t,e,r);return P(t,e),t}function D(e){return e&&e.__esModule?e:{default:e}}function x(e,t,r,a){if("a"===r&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)}function M(e,t,r,a,i){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r}function k(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function W(e,t,r){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var a;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");a=t[Symbol.asyncDispose]}if(void 0===a){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");a=t[Symbol.dispose]}if("function"!=typeof a)throw new TypeError("Object not disposable.");e.stack.push({value:t,dispose:a,async:r})}else r&&e.stack.push({async:!0});return t}var $="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var a=new Error(r);return a.name="SuppressedError",a.error=e,a.suppressed=t,a};function R(e){function t(t){e.error=e.hasError?new $(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}return function r(){for(;e.stack.length;){var a=e.stack.pop();try{var i=a.dispose&&a.dispose.call(a.value);if(a.async)return Promise.resolve(i).then(r,(function(e){return t(e),r()}))}catch(e){t(e)}}if(e.hasError)throw e.error}()}const O={__extends:i,__assign:o,__rest:n,__decorate:s,__param:l,__metadata:u,__awaiter:g,__generator:h,__createBinding:f,__exportStar:S,__values:b,__read:y,__spread:C,__spreadArrays:E,__spreadArray:w,__await:_,__asyncGenerator:T,__asyncDelegator:I,__asyncValues:v,__makeTemplateObject:A,__importStar:L,__importDefault:D,__classPrivateFieldGet:x,__classPrivateFieldSet:M,__classPrivateFieldIn:k,__addDisposableResource:W,__disposeResources:R}}},t={};function r(a){var i=t[a];if(void 0!==i)return i.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}r.d=function(e,t){for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};r.r(a),r.d(a,{createClipboardItems:function(){return se},createDeferredPromise:function(){return tt},getClipboardPlatformEnvironment:function(){return Xi},setClipboardPlatformFeatureGateManager:function(){return Qi}});var i={};r.r(i),r.d(i,{default:function(){return Ar}});var o=r(7873);let n;function s(){return n}const l="",c=".";var d,p,m,u,g,h;function f(e,t){return S(e,[t])}function S(e,t){if(!function(e){if(!e||"object"!=typeof e||!("reason"in e))return!1;return!!function(e){if(!e&&0!==e)return!1;const t=Number(e);return!isNaN(t)&&t.toString()===e.toString()}(e.reason)}(e))return!1;if(!t||!Array.isArray(t)||t.length<1)return!1;const r=e.reason;return t.indexOf(r)>=0}function b(e){if(e&&"object"==typeof e){if(y(e.reason))return!0;if(e.innerError&&"string"==typeof e.innerError)try{if(y(JSON.parse(e.innerError).reason))return!0}catch{}}if("string"==typeof e)try{if(y(JSON.parse(e).reason))return!0}catch{}return!1}function y(e){return e===m.LocalStorageInitilizationInaccessible}(p=d||(d={}))[p.SystemClipboard=0]="SystemClipboard",p[p.FullAccessClipboardAndInMemory=3]="FullAccessClipboardAndInMemory",p[p.InMemory=4]="InMemory",p[p.LocalStorage=5]="LocalStorage",p[p.SystemClipboardAndLocalStorage=6]="SystemClipboardAndLocalStorage",p[p.SystemClipboardAndInMemory=7]="SystemClipboardAndInMemory",p[p.AsyncSystemClipboard=8]="AsyncSystemClipboard",p[p.AsyncSystemClipboardAndLocalStorage=9]="AsyncSystemClipboardAndLocalStorage",p[p.AsyncSystemClipboardAndInMemory=10]="AsyncSystemClipboardAndInMemory",function(e){e[e.UnsupportedClipboardStrategyType=0]="UnsupportedClipboardStrategyType",e[e.UnsupportedClipboardStorageType=1]="UnsupportedClipboardStorageType",e[e.ClipboardIsInaccessible=2]="ClipboardIsInaccessible",e[e.SetClipboardItems=3]="SetClipboardItems",e[e.GetClipboardItems=5]="GetClipboardItems",e[e.NoGetOperationResultMessage=7]="NoGetOperationResultMessage",e[e.NoSetOperationResultMessage=8]="NoSetOperationResultMessage",e[e.ClearClipboardItems=9]="ClearClipboardItems",e[e.MissingBrowserExtensionCapability=10]="MissingBrowserExtensionCapability",e[e.NoBrowserExtensionsInConfiguration=11]="NoBrowserExtensionsInConfiguration",e[e.NoAvailableBrowserExtensions=12]="NoAvailableBrowserExtensions",e[e.UnavailableBrowserExtension=13]="UnavailableBrowserExtension",e[e.NoBrowserExtensionWithGetClipboardDataCommand=14]="NoBrowserExtensionWithGetClipboardDataCommand",e[e.SelectClipboardStrategy=15]="SelectClipboardStrategy",e[e.IframeInitialization=16]="IframeInitialization",e[e.UnsupportedOperationCode=26]="UnsupportedOperationCode",e[e.RejectingPendingPastePromiseDueToNewPasteOperation=27]="RejectingPendingPastePromiseDueToNewPasteOperation",e[e.RejectingPendingCutCopyPromiseDueToNewCutCopyOperation=28]="RejectingPendingCutCopyPromiseDueToNewCutCopyOperation",e[e.RejectingBlockedSyncCutCopyPromise=29]="RejectingBlockedSyncCutCopyPromise",e[e.IframeInitializationTimeout=30]="IframeInitializationTimeout",e[e.ClipboardStrategyNotInitialized=33]="ClipboardStrategyNotInitialized",e[e.UnexpectedClipboardTextHtmlContentLength=34]="UnexpectedClipboardTextHtmlContentLength",e[e.InvalidClipboardStrategyType=35]="InvalidClipboardStrategyType",e[e.CreateWindowRPCServer=36]="CreateWindowRPCServer",e[e.RefreshMetadata=37]="RefreshMetadata",e[e.DeserializedMetadata=38]="DeserializedMetadata",e[e.SerializedMetadata=39]="SerializedMetadata",e[e.LocalStorageInitilizationInaccessible=40]="LocalStorageInitilizationInaccessible",e[e.LocalStorageInitilizationNoKey=41]="LocalStorageInitilizationNoKey",e[e.IframeProxyGeneralError=42]="IframeProxyGeneralError",e[e.IframeProxyEmptyResultMessage=43]="IframeProxyEmptyResultMessage",e[e.AsyncClipboardReadFailure=44]="AsyncClipboardReadFailure",e[e.AsyncClipboardWriteFailure=45]="AsyncClipboardWriteFailure"}(m||(m={})),function(e){e[e.MissingArgumentError=0]="MissingArgumentError",e[e.CopyFlowHandlerNotFound=1]="CopyFlowHandlerNotFound",e[e.FetchCopyFlowHandlerFailed=2]="FetchCopyFlowHandlerFailed",e[e.FetchSourceItemFailed=3]="FetchSourceItemFailed",e[e.BeforeSerializeFailed=4]="BeforeSerializeFailed",e[e.SerializeFailed=5]="SerializeFailed",e[e.SerializeResultNotValid=6]="SerializeResultNotValid",e[e.AsyncSerializeFailed=7]="AsyncSerializeFailed",e[e.SaveToTheClipboardFailed=8]="SaveToTheClipboardFailed",e[e.InspectClipboardFailed=9]="InspectClipboardFailed",e[e.ClipboardIsInaccessible=10]="ClipboardIsInaccessible",e[e.SuccessiveCutCopyOverridingPendingCutCopy=11]="SuccessiveCutCopyOverridingPendingCutCopy",e[e.BlockedSynchronousCutCopy=12]="BlockedSynchronousCutCopy",e[e.CopyOperationCancelled=13]="CopyOperationCancelled",e[e.UnknownCopyErrorType=14]="UnknownCopyErrorType"}(u||(u={})),function(e){e[e.MissingArgumentError=0]="MissingArgumentError",e[e.PasteFlowHandlerNotFound=1]="PasteFlowHandlerNotFound",e[e.FetchPasteFlowHandlerFailed=2]="FetchPasteFlowHandlerFailed",e[e.FailedToReadFromClipboard=3]="FailedToReadFromClipboard",e[e.InspectClipboardFailed=4]="InspectClipboardFailed",e[e.ReadFromClipboardReturnNullOrUndefined=5]="ReadFromClipboardReturnNullOrUndefined",e[e.ClipboardIsEmpty=6]="ClipboardIsEmpty",e[e.DeserializeOperationFailed=7]="DeserializeOperationFailed",e[e.ClipboardIsInaccessible=8]="ClipboardIsInaccessible",e[e.SuccessivePasteOverridingPendingPaste=9]="SuccessivePasteOverridingPendingPaste",e[e.FileReaderResultIsEmpty=10]="FileReaderResultIsEmpty",e[e.FileReaderFailed=11]="FileReaderFailed",e[e.UnknownPasteError=12]="UnknownPasteError",e[e.DeferredPasteRejectedBecauseOtherCopyCompleted=13]="DeferredPasteRejectedBecauseOtherCopyCompleted",e[e.DeferredPasteRejectedBecauseOtherCopyStarted=14]="DeferredPasteRejectedBecauseOtherCopyStarted",e[e.DeferredPasteRejectedBecauseMetadataUpdateWithoutCopyContext=15]="DeferredPasteRejectedBecauseMetadataUpdateWithoutCopyContext",e[e.FailedToReadFromAsyncClipboard=16]="FailedToReadFromAsyncClipboard"}(g||(g={})),function(e){e[e.FailedToClearClipboard=0]="FailedToClearClipboard"}(h||(h={}));class C extends Error{static augmentParameterValue(e){return e&&"string"==typeof e?e.trim():l}constructor(e,t,r){const a=C.augmentParameterValue(e);if(super(a),this.name=C.augmentParameterValue(t),this.errorName=this.name,this.name?s().ULS.traceTag(596456211,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Error '${this.name}': ${a}`):s().ULS.traceTag(596456212,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Error message: ${a}`),r){this.innerError=r;let e=this.innerError.message;e||(e=this.innerError.name);const t=C.augmentParameterValue(e);t.length>0&&s().ULS.traceTag(596456213,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Inner error message: ${t}`)}this.stack||(this.stack=(new Error).stack)}}class E extends C{constructor(e,t){super(e,"NoValidKeyError",t)}}class w extends C{static getDefaultMessage(e){let t="Missing argument";return e.length>0&&(t=`Missing argument: '${e}'`),t}constructor(e,t,r){const a=C.augmentParameterValue(t),i=w.getDefaultMessage(a);let o=C.augmentParameterValue(e);0===o.length&&(o=i),super(o,"MissingArgumentError",r),this.name=a}}class _ extends C{static getDefaultMessage(e,t){return e.length>0?`Invalid '${e}' argument: '${t}'`:"Invalid argument"}constructor(e,t,r,a){const i=C.augmentParameterValue(t);let o=r;o||(o=l);const n=_.getDefaultMessage(i,o);let s=C.augmentParameterValue(e);0===e.length&&(s=n),super(s,"InvalidArgumentError",a),this.name=i,this.value=o}}class T extends C{constructor(e,t){super(e,"InvalidOperationError",t)}}class I extends C{constructor(e,t,r,a,i){super(`${e}. Data version: ${t}, Infra version: ${r}, blockMismatchDataVersion: ${a}`,"MismatchVersionError",i)}}class v extends C{constructor(e,t,r,a){super(`${e}. Duration in clipboard (ms) : ${t}, TTL (ms): ${r}`,"TTLClipboardDataError",a)}}class A extends C{constructor(e,t,r,a){super(`${e}. Data User Hash : ${t}, infra User Hash: ${r}`,"UserHashMismatchError",a)}}class P extends C{constructor(e,t){super(e,"UnexpectedError",t)}}function L(e,t){return function(e,t){return void 0!==e&&"number"==typeof e&&e>=0&&e<Object.keys(t).length/2}(e,t)?t[e]:l}class D extends C{constructor(e,t,r,a,i){super(t||`reason=${e}`,r,a),this.reason=e,i&&(this.errorName=i)}}class x extends D{constructor(e,t,r){super(e,t,"PasteError",r,L(e,g))}}class M extends D{constructor(e,t,r){super(e,t,"ClipboardPlatformError",r,L(e,m))}}function k(e){if(!e||!Array.isArray(e)||0===e.length)return void s().ULS.traceTag(596456214,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,"rethrowAfterAllActions: no actions to execute");let t,r=0;if(e.forEach((e=>{if(r+=1,e)try{e()}catch(e){s().ULS.traceTag(596456216,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`rethrowAfterAllActions: callback action #${r} threw an exception: ${e.message}`),t||(t=new T(e.message,e))}else s().ULS.traceTag(596456215,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`rethrowAfterAllActions: callback action #${r} is empty`)})),t)throw t}function W(){return $}const $={userAgent:()=>window&&window.navigator?window.navigator.userAgent:l,appVersion:()=>window&&window.navigator?window.navigator.appVersion:l};let R={};const O=new RegExp("(\\bTrident/| MSIE )"),U=16.16299,F=17.17123,N=new RegExp("\\bEdge/(\\d+\\.\\d+)\\b");function J(){if(void 0===R.isIEProperty){R.isIEProperty=!1;const e=W();if(e&&e.userAgent&&"function"==typeof e.userAgent){const t=e.userAgent();if(t){const e=t.match(O);e&&2===e.length&&(R.isIEProperty=!0)}}}return R.isIEProperty}function z(){if(void 0===R.isEdgeProperty){R.isEdgeProperty=!1,R.isEdgeWithTextHtmlClipboardSupportProperty=!1,R.isEdgeVersionWithTextHtmlWrapperSupportProperty=!1;const e=W();if(e&&e.appVersion&&"function"==typeof e.appVersion){const t=e.appVersion();if(t){const e=t.match(N);if(e&&2===e.length){R.isEdgeProperty=!0;const t=Number(e[1]);isNaN(t)||(t>=U&&(R.isEdgeWithTextHtmlClipboardSupportProperty=!0),t>=F&&(R.isEdgeVersionWithTextHtmlWrapperSupportProperty=!0))}}}}return R.isEdgeProperty}const j=(e,t,r,a)=>{e.postMessage(t,r,a)},H="copy",V="cut",B="paste",G="copy",K="paste",q=(e,t,r,a)=>{const i=a||!1;return e.addEventListener(t,r,i),()=>{e.removeEventListener(t,r,i)}},Z="text/plain",Y="Text",X="text/html",Q="image/png",ee="metadata/is-last-copy-was-external",te="metadata/ccp-infra-version",re="copyId",ae=function(){const e={items:{}};return{getData:()=>e,getItem:e=>{},setItem:(e,t)=>{throw new T(`Cannot set an item with clipboard data format '${e}' in an immutable empty clipboard (content is ${t&&t.length>0?"not ":l}empty)`)},setDeferredItem:(e,t)=>{throw new T(`Cannot set a deferred item with clipboard data format '${e}' in an immutable empty clipboard`)},hasDeferredItem:e=>!1,getDeferredItem:e=>{},get:()=>ue(void 0)}}();function ie(){return ae}function oe(e){return e&&e.items?Object.keys(e.items).length:0}function ne(e){return oe(e&&e.getData())}function se(e=void 0){let t=e;t||(t={items:{}});const r={getItem:e=>le(t,e),setItem:(e,r)=>{ce(t,e,r)},setDeferredItem:(e,r)=>{ce(t,e,r)},hasDeferredItem:e=>{if(!t||!t.items)return!1;const r=t.items[e];return!!r&&r instanceof Promise},getDeferredItem:e=>function(e,t){if(!e)throw new w(l,"clipboardItemsData");if(!e.items)throw new _(l,"clipboardItemsData.items");const r=e.items[t];return!r||r instanceof Promise?r:Promise.resolve(new Blob([r],{type:Z}))}(t,e),getData:()=>t,get:()=>ue(t)};return r}function le(e,t){if(!e)throw new w(l,"clipboardItemsData");if(!e.items)throw new _(l,"clipboardItemsData.items");const r=e.items[t];if(!(r&&r instanceof Promise))return r}function ce(e,t,r){if(!e)throw new w(l,"clipboardItemsData");if(!e.items)throw new _(l,"clipboardItemsData.items");e.items[t]=r}function de(e,t){if(!e||0===e.length||!t||!t.trim())return l;let r;return e.forEach((e=>{e.clipboardDataFormat!==t||e.deferred||(r=e.data)})),r||l}function pe(e){return de(e,Z)}function me(e){let t=[];return e&&(t=e.get()),0===t.length&&t.push({clipboardDataFormat:Z,data:l}),t}function ue(e){const t=[];if(0===oe(e))return t;for(const r in e.items){let a=e.items[r];a||(a=l);const i={clipboardDataFormat:r,data:a,deferred:a instanceof Promise};t.push(i)}return t}var ge,he,fe,Se;(he=ge||(ge={}))[he.SystemClipboard=0]="SystemClipboard",he[he.InMemory=2]="InMemory",he[he.LocalStorage=3]="LocalStorage",he[he.AsyncSystemClipboard=4]="AsyncSystemClipboard",function(e){e[e.None=0]="None",e[e.Cut=1]="Cut",e[e.Copy=2]="Copy",e[e.Paste=4]="Paste",e[e.Values=16]="Values",e[e.Formatting=32]="Formatting",e[e.Formulas=64]="Formulas",e[e.DragDropCells=128]="DragDropCells",e[e.DragDropNoErrMsg=256]="DragDropNoErrMsg",e[e.Transpose=512]="Transpose",e[e.Link=1024]="Link",e[e.PictureInCell=2048]="PictureInCell",e[e.ColumnWidths=4096]="ColumnWidths",e[e.Copilot=8192]="Copilot",e[e.PasteValues=20]="PasteValues",e[e.PasteFormatting=36]="PasteFormatting",e[e.PasteFormulas=68]="PasteFormulas",e[e.PasteTranspose=516]="PasteTranspose",e[e.PasteLink=1028]="PasteLink",e[e.PastePictureInCell=2052]="PastePictureInCell",e[e.PasteWithColumnWidths=4100]="PasteWithColumnWidths",e[e.PasteWithCopilot=8196]="PasteWithCopilot"}(fe||(fe={})),function(e){e[e.NoError=0]="NoError",e[e.LocalStorageInaccessible=1]="LocalStorageInaccessible"}(Se||(Se={}));const be="BulsEndpointUrl",ye="usid",Ce="-",Ee=1,we=3600,_e=2;let Te=Ae(),Ie=!1;function ve(){if(!Ie)throw new T("First initialize the settings via initializeSharedClipboardSettingsFromWindow() or initializeSharedClipboardSettings()");return Te}function Ae(){return{whitelistOriginComponents:!1,sharedClipboardHostingApp:l,sharedClipboardHostingApps:[],sharedClipboardHostingEnvironments:[],sharedClipboardSchemaVersion:Ee,sharedClipboardExpirationInMinutes:we,clipboardPromiseTimeoutInMinutes:_e,remoteLoggerPath:l}}function Pe(){let e=l;return window&&window.location&&window.location.origin?(e=window.location.origin,e||(e=l)):(s().ULS.traceTag(595932950,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`windowLocation.getWindowLocation: is window exist: ${!!window}. is window.location exist: ${window&&!!window.location}. is window.location.origin exist ${window&&window.location&&!!window.location.origin}. is window.location.protocol exist ${window&&window.location&&!!window.location.protocol}. is window.location.hostname exist ${window&&window.location&&!!window.location.hostname}. is window.location.port exist ${window&&window.location&&!!window.location.port}`),window&&window.location&&window.location.protocol&&window.location.hostname&&(e=window.location.protocol+"//"+window.location.hostname,window.location.origin=e)),{origin:e}}const Le="://",De="http",xe="https",Me=".",ke="/",We=":",$e=new RegExp("^\\d+$");let Re,Oe,Ue=!1;function Fe(e){if(!e)throw new w(l,"origin");const t=e.trim().toLowerCase();let r=l,a=t.split(Le,3);if(!a||0===a.length||!a[0]||a[0]!==De&&a[0]!==xe)throw new _("Missing protocol","origin",e);if(1===a.length)throw new _("Missing domain","origin",e);if(a.length>2)throw new _(`'${Le}' should appear once`,"origin",e);let i=a[1];if(!i)throw new _("Missing domain","origin",e);if(r=a[0]+Le,i=i.trim(),a=i.trim().split(ke,3),!a||0===a.length||!a[0]||!a[0].trim())throw new _("Missing domain","origin",e);if(a.length>2)throw new _("The last part of the origin should be the domain","origin",e);if(2===a.length&&a[1])throw new _("The last part of the origin should be the domain","origin",e);if(a=i.split(We,3),!a||0===a.length||!a[0]||!a[0].trim())throw new _("Missing domain","origin",e);if(a.length>2||2===a.length&&(!a[1]||!a[1].trim()))throw new _("The last part of the origin should be the domain and an optional port number","origin",e);if(i=a[0].trim(),r+=i,2===a.length){const t=a[1].trim(),i=$e.exec(t);if(!i||1!==i.length)throw new _("Invalid port number","origin",e);const o=Number(t);if(isNaN(o))throw new _("Invalid port number","origin",e);r+=We+t}return s().ULS.traceTag(596452423,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`getValidatedOrigin: origin = '${e}'; validated origin = '${r}'`),r}function Ne(e){je();const t=e.split(Le,2),r=t[0],a=Je(t[1]),i={protocol:r};if(i.environment=ze(e,a,Oe),a.length<=i.environment.length+1)throw new _("Missing app component","origin",e);if(a.charAt(i.environment.length)!==Me)throw new _("Missing a domain separator after the environment component","origin",e);const o=a.substr(i.environment.length+Me.length);if(i.app=ze(e,o,Re),i.app.length<o.length&&o.charAt(i.app.length)!==Ce)throw new _(`When the Office Online app name is not the domain prefix, '${Ce}' should precede it`,"origin",e);return i}function Je(e){if(!e)throw new w(l,"stringToReverse");const t=e.length;let r=l;for(let a=t-1;a>=0;a-=1)r+=e.charAt(a);return r}function ze(e,t,r){if(!t)throw new w(l,"reversedValidatedHostname");if(!r)throw new w(l,"reversedStringsToLengthMap");const a=t.length,i=Object.keys(r).filter((e=>{const i=r[e];return i<=a&&t.substr(0,i)===e}));if(i&&i.length>0)return Je(i[0]);throw new _("Invalid origin","validatedOrigin",e)}function je(){if(Ue)return;const e=ve();e.whitelistOriginComponents&&(Re=He(e.sharedClipboardHostingApps),Oe=He(e.sharedClipboardHostingEnvironments),Ue=!0)}function He(e){const t={};return e&&Array.isArray(e)&&0!==e.length?(e.forEach((e=>{t[Je(e)]=e.length})),t):t}function Ve(){return(Math.random()+1).toString(36).substring(7)}function Be(e){if(!e)throw new w(l,"id");const t=e.trim().toLowerCase();if(0===t.length)throw new _(l,"id");return t}function Ge(e,t,r,a,i){const o={id:e,operationCode:t,destination:r,userHash:a,clipboardItemsData:i};return qe(o),o}class Ke{}Ke.localStorageData="localStorage/data",Ke.localStorageMetadata="localStorage/metadata",Ke.initIframe="initIframe";const qe=function(e){if(!e)throw new w(l,"clipboardOperationMessage");if(!e.id||0===e.id.trim().length)throw new w(l,"id");if(!e.operationCode)throw new w(l,"operationCode");if(!e.destination)throw new w(l,"destination");if("get"!==(t=e.operationCode)&&"set"!==t&&"init"!==t)throw new _(l,"operationCode",e.operationCode);var t;if("set"!==e.operationCode&&e.clipboardItemsData)throw new _(`'${e.operationCode}' expects no clipboard items`,"clipboardItemsData")};function Ze(e,t,r,a,i){const o={id:e,operationCode:t,failed:r,error:a,clipboardItemsData:i};return Ye(o),o}const Ye=function(e){if(!e)throw new w(l,"clipboardOperationResultMessage");const t=["failed","error","clipboardItemsData","operationCode","id","userHash"];let r=!1;for(const a of t)if(e.hasOwnProperty(a)){r=!0;break}if(!r)throw new E("clipboardOperationResultMessage has no valid key");if(!e.id||0===e.id.trim().length)throw s().ULS.traceTag(553747865,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`Missing argument 'id'. keys: ${JSON.stringify(Object.keys(e))}, isConstructorObject: ${e.constructor===Object}, operationCode: ${e.operationCode}, id: ${e.id}, failed: ${e.failed}, error: ${e.error}.`),new w(l,"id");if(!e.operationCode)throw new w(l,"operationCode");if("getresult"!==e.operationCode&&"setresult"!==e.operationCode&&"initresult"!==e.operationCode&&"unknownresult"!==e.operationCode&&"getMetadata_longPollingresult"!==e.operationCode)throw new _(l,"operationCode",e.operationCode);if(e.failed){if(!e.error)throw new _(`A failed '${e.operationCode}' operation expects a non-empty error argument`,"error");if(e.clipboardItemsData)throw new _(`A failed '${e.operationCode}' operation does not expect a clipboardItemsData argument`,"clipboardItemsData")}else{if(e.error)throw new _(`'${e.operationCode}' expects an empty error argument`,"error");if("unknownresult"===e.operationCode)throw new _(`'${e.operationCode}' can only be used with a failure message`,"operationCode")}if("getresult"===e.operationCode||"getMetadata_longPollingresult"===e.operationCode){if(!e.failed&&!e.clipboardItemsData)throw new _(`'${e.operationCode}' expects a clipboardItems argument`,"clipboardItemsData")}else if(e.clipboardItemsData)throw new _(`'${e.operationCode}' expects no clipboardItemsData argument`,"clipboardItemsData")};function Xe(e){if(!e||0===e.trim().length)throw new _(l,"className",e);return(()=>{let t=!1;function r(t){return`${e}:${t}: already disposed`}return{dispose:function(){t=!0},logIfDisposed:function(e){return t&&s().ULS.traceTag(596456217,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,r(e)),t},throwIfDisposed:function(e){if(t)throw new T(r(e))}}})()}class Qe{initialize(e){return e.then((e=>(this.clipboardStorage=e,s().ULS.traceTag(596453007,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Clipboard strategy type '${this.clipboardStrategyType}' was initialized.`),Promise.resolve(this))),(e=>(s().ULS.traceTag(596453008,o.nh.msoulscat_ES_EWAJS,b(e)?o.kp.Info:o.kp.Error,`Failed to initialize clipboard strategy type '${this.clipboardStrategyType}'. Error: ${o.Wp.getStringifiedError(e)}`),Promise.reject(e))))}set(e,t){try{if(this.disposableImplementationExtension.throwIfDisposed("set"),!this.clipboardStorage){const e="ClipboardStrategyBase.set: this.clipboardStorage should be defined";return s().ULS.shipAssertTag(596121485,o.nh.msoulscat_ES_EWAJS,!1,e),Promise.reject(new M(m.ClipboardStrategyNotInitialized))}return this.clipboardDataProcessor&&this.clipboardDataProcessor.preSetProcess(e),this.clipboardStorage.set(e,t)}catch(e){return Promise.reject(new M(m.SetClipboardItems,`Failed in (clipboard ${this.clipboardStrategyType}).set`,e))}}get(e){try{if(this.disposableImplementationExtension.throwIfDisposed("get"),!this.clipboardStorage){const e="ClipboardStrategyBase.get: this.clipboardStorage should be defined";return s().ULS.shipAssertTag(596121486,o.nh.msoulscat_ES_EWAJS,!1,e),Promise.reject(new M(m.ClipboardStrategyNotInitialized))}return this.clipboardStorage.get(e).then((e=>(this.clipboardDataProcessor&&this.clipboardDataProcessor.postGetProcess(e),Promise.resolve(e)))).catch((t=>{throw s().ULS.traceTag(507848131,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`ClipboardStrategyBase.get - Failed to get clipboard items. Command id: ${e.id}, Error: ${o.Wp.getStringifiedError(t)}`),t}))}catch(e){return Promise.reject(new M(m.GetClipboardItems,`Failed in (clipboard ${this.clipboardStrategyType}).get`,e))}}onSystemClipboardChangedExternally(e){try{return this.disposableImplementationExtension.throwIfDisposed("onSystemClipboardChangedExternally"),this.clipboardStorage?this.clipboardCapabilities.systemClipboard?Promise.resolve():this.clipboardStorage.set(ie(),e):(s().ULS.shipAssertTag(595882508,o.nh.msoulscat_ES_EWAJS,!1,"ClipboardStrategyBase.onSystemClipboardChangedExternally: this.clipboardStorage should be defined"),Promise.reject(new M(m.ClipboardStrategyNotInitialized)))}catch(e){return Promise.reject(new M(m.ClearClipboardItems,`Failed in (clipboard ${this.clipboardStrategyType}).onSystemClipboardChangedExternally`,e))}}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(this.clipboardStorage&&this.clipboardStorage.dispose(),this.disposableImplementationExtension.dispose())}constructor(e,t,r){this.clipboardStrategyType=e,this.clipboardCapabilities=t,this.clipboardDataProcessor=r,this.disposableImplementationExtension=Xe(`${e}`)}}const et=!!window.performance&&!!window.performance.now&&!!window.performance.timing;function tt(e){let t=e;return t&&0!==t.trim().length||(t=Ve()),new ot(t)}function rt(){return et?window.performance.now():Date.now()}function at(e){return et?new Date(e+window.performance.timing.navigationStart):new Date(e)}function it(e,t,r){if(!r)throw new w(l,"creationTimestamp");return`${e?"Fulfilled":"Still unfulfilled"} after ${e?t?t-r:"?":rt()-r}ms`}class ot{fulfilled(){return this.isFulfilled}resolve(e){this.markAsFulfilled("resolve"),this.internalResolve?this.internalResolve(e):s().ULS.traceTag(596456257,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`Deferred promise - resolve: the resolve for deferred promise #${this.sequenceId} with id '${this.id}' is not tracked with a callback`)}reject(e){this.markAsFulfilled("reject"),this.internalReject?this.internalReject(e):s().ULS.traceTag(596456260,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`Deferred promise - reject: the reject for deferred promise #${this.sequenceId} with id '${this.id}' is not tracked with a callback`)}markAsFulfilled(e){this.fulfillmentCheck(e)||(this.isFulfilled=!0,this.rejected="resolve"!==e,this.fulfillmentTimestamp=rt(),s().ULS.traceTag(596456261,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Deferred promise: marking promise #${this.sequenceId} with id '${this.id}' as fulfilled (${this.rejected?"rejected":"resolved"}). ${it(this.isFulfilled,this.fulfillmentTimestamp,this.creationTimestamp)}`))}fulfillmentCheck(e){return s().ULS.traceTag(596456258,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Deferred promise: asked to ${e} deferred promise #${this.sequenceId} with id '${this.id}'`),this.isFulfilled&&s().ULS.traceTag(596456259,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`Deferred promise: cannot ${e} deferred promise #${this.sequenceId} with id '${this.id}' since it was ${this.rejected?"rejected":"resolved"} already on ${at(this.fulfillmentTimestamp)}. ${it(this.isFulfilled,this.fulfillmentTimestamp,this.creationTimestamp)}`),this.isFulfilled}constructor(e){this.isFulfilled=!1,this.fulfillmentTimestamp=void 0,this.rejected=!1,this.id=Be(e),ot.sequenceId+=1,this.sequenceId=ot.sequenceId,this.creationTimestamp=rt(),s().ULS.traceTag(596456225,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Deferred promise: creating deferred promise #${this.sequenceId} with id '${this.id}' on ${at(this.creationTimestamp)}`),this.promise=new Promise(((e,t)=>{s().ULS.traceTag(596456226,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Deferred promise: registering callback for promise #${this.sequenceId} with id '${this.id}' on ${at(rt())}`),this.internalResolve=e,this.internalReject=t}))}}ot.sequenceId=0;class nt{getDeferredPromise(e){const t=Be(e);return this.deferredResultMessagePromiseCache[t]}getPromise(e){const t=this.getDeferredPromise(e);if(t)return s().ULS.traceTag(596456218,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Deferred promise cache: found a deferred promise with id '${e}'.`),t.promise;s().ULS.traceTag(596456219,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Deferred promise cache: there is no deferred promise with id '${e}'.`)}addNewPromise(e){const t=tt(e);if(this.getDeferredPromise(t.id))throw new _("A deferred promise already exists in the cache for the specified id","id",t.id);const r=Be(t.id);return this.deferredResultMessagePromiseCache[r]=t,s().ULS.traceTag(596456220,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Deferred promise cache: added a new deferred promise with id '${t.id}'.`),t}getLength(){let e=0;for(const t in this.deferredResultMessagePromiseCache)e+=1;return e}delete(e){if(!this.getDeferredPromise(e))return void s().ULS.traceTag(596456221,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Deferred promise cache: no need to delete an item with id '${e}' since this id is not associated with an existing deferred promise.`);const t=Be(e);delete this.deferredResultMessagePromiseCache[t],s().ULS.traceTag(596456222,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Deferred promise cache: deleted id '${e}'.`)}clear(){if(s().ULS.traceTag(596456223,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Deferred promise cache: clearing ${this.getLength()} items from the cache`),this.deferredResultMessagePromiseCache)for(const e in this.deferredResultMessagePromiseCache){const t=this.deferredResultMessagePromiseCache[e];if(t)try{t.reject()}catch(t){s().ULS.traceTag(596456224,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`Deferred promise cache: clear failed to reject promise id '${e}' with this exception: ${t.message}. Ignoring.`)}}this.deferredResultMessagePromiseCache={}}constructor(){this.deferredResultMessagePromiseCache={}}}const st="initmessageid",lt="CreatorOrigin";function ct(e){if(!e)throw new w(l,"remoteWindow");if(!("window"in e)||!e.window)throw new w(l,"remoteWindow.window");if(!("windowOrigin"in e)||!e.windowOrigin)throw new w(l,"remoteWindow.windowOrigin");const t=function(e){je();const t=Fe(e),r=Fe(Pe().origin);if(t===r)return t;if(!ve().whitelistOriginComponents)throw new T(`validateOriginForReceivedMessage: Caller origin '${e}' doesn't match the current window's origin '${r}'`);const a=Ne(t),i=Ne(r);if(a.protocol!==i.protocol)throw new T(`validateRemoteWindowOrigin: Caller origin's protocol '${a.protocol}' doesn't match the current window origin's protocol '${i.protocol}'`);if(a.environment!==i.environment)throw new T(`validateRemoteWindowOrigin: Caller origin's environment '${a.environment}' doesn't match the current window origin's environment '${i.environment}'`);return t}(e.windowOrigin);return{window:e.window,windowOrigin:t}}class dt{get disposableImplementationExtension(){return this._disposableImplementationExtension}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(k([()=>{this.sender&&this.sender.dispose()},()=>{this.receiver&&this.receiver.dispose()}]),this.disposableImplementationExtension.dispose())}postMessage(e){if(this.disposableImplementationExtension.throwIfDisposed("postMessage"),!e)throw new w(l,"outgoingMessage");if(!this.sender){const e="WindowRPCBase::postMessage - this.sender should be defined";throw s().ULS.shipAssertTag(596121484,o.nh.msoulscat_ES_EWAJS,!1,e),new T(e)}this.sender.postMessage(e)}constructor(e,t,r,a){this.serializer=e,this.deserializer=t,this.remoteWindow=r,this.remoteWindow=r,this._disposableImplementationExtension=Xe(a)}}function pt(){return mt}const mt={addEventListener:(e,t)=>window.addEventListener(e,t),removeEventListener:(e,t)=>window.removeEventListener(e,t)},ut="message";class gt{dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(pt().removeEventListener(ut,this.windowMessageHandler),this.disposableImplementationExtension.dispose())}shouldFilterMessageEvent(e){try{if(!e.origin||!e.source)return s().ULS.traceTag(596452370,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"Window RPC Receiver: ignoring messages from unspecified window sources."),!0;if(e.source===window)return s().ULS.traceTag(596452371,o.nh.msoulscat_ES_EWAJS,o.kp.Verbose,"Window RPC Receiver: ignoring messages from this window to itself."),!0;if(this.remoteWindow.window&&e.source!==this.remoteWindow.window)return s().ULS.traceTag(596452372,o.nh.msoulscat_ES_EWAJS,o.kp.Verbose,"Window RPC Receiver: ignoring messages from windows other than the assigned remote window."),!0;if(e.origin.toLowerCase()!==this.remoteWindow.windowOrigin)return s().ULS.traceTag(596452373,o.nh.msoulscat_ES_EWAJS,o.kp.Verbose,"Window RPC Receiver: ignoring messages from windows with an origin that differs from remote window origin."),!0}catch(e){return!0}return!1}onMessageReceived(e){if(this.shouldFilterMessageEvent(e))return;let t;try{t=this.deserializer.deserialize(e.data)}catch(e){s().ULS.traceTag(596452374,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Window RPC Receiver: unable to deserialize incoming message. ${o.Wp.getStringifiedError(e)}`);try{this.handler.handleDeserializationError(e)}catch(e){s().ULS.traceTag(596452184,o.nh.msoulscat_ES_EWAJS,o.kp.Error,`Window RPC Receiver: unable to handle deserialization error. ${o.Wp.getStringifiedError(e)}`)}return}if(t)try{this.handler.handleMessage(t).catch((e=>{s().ULS.traceTag(595985880,o.nh.msoulscat_ES_EWAJS,o.kp.Error,`Window RPC Receiver: unable to process incoming message. ${o.Wp.getStringifiedError(e)}`)}))}catch(e){s().ULS.traceTag(596452186,o.nh.msoulscat_ES_EWAJS,o.kp.Error,`Window RPC Receiver: unable to process incoming message. ${o.Wp.getStringifiedError(e)}`)}else s().ULS.traceTag(596452185,o.nh.msoulscat_ES_EWAJS,o.kp.Error,"Window RPC Receiver: the incoming message is empty")}constructor(e,t,r){if(this.deserializer=e,this.handler=t,this.windowMessageHandler=e=>this.onMessageReceived(e),!e)throw new w(l,"deserializer");if(!t)throw new w(l,"handler");if(!r)throw new w(l,"windowRPC");this.disposableImplementationExtension=Xe("WindowRPCReceiverInternal"),this.remoteWindow=ct(r.remoteWindow),pt().addEventListener(ut,this.windowMessageHandler)}}class ht{postMessage(e){if(!e)throw new w(l,"outgoingMessage");if(!this.remoteWindow.window)throw new T("Configure the remote window");if(!this.remoteWindow.window.postMessage)throw new T("The remote window does not support postMessage");const t=this.serializer.serialize(e);j(this.remoteWindow.window,t,this.remoteWindow.windowOrigin)}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()}constructor(e,t,r=!1){if(this.serializer=e,this.delayedQueueEnabled=r,!e)throw new w(l,"serializer");if(!t)throw new w(l,"windowRPC");this.disposableImplementationExtension=Xe("WindowRPCSenderInternal"),this.remoteWindow=ct(t.remoteWindow)}}const ft="OfficeOnlineCCP_",St=ft+"Metadata_",bt=ft+"Data_",yt="_LocalStorageChangedFlag";function Ct(e){return St+e}class Et{constructor(){this.copyStatus=wt.Started,this.isTimestampStoredInSystemClipboard=!1,this.isAsyncSerializeFailed=!1,this.succeededPopulatingSystemClipboardSync=void 0,this.succeededPopulatingSystemClipboardAsync=void 0,this.isFullSheetCopy=!1}}var wt;function _t(e){let t;return e&&e.lastCopy&&(t={...e.lastCopy}),{lastCopy:t}}!function(e){e[e.Started=1]="Started",e[e.SynchronousPhaseCompleted=2]="SynchronousPhaseCompleted",e[e.Completed=3]="Completed"}(wt||(wt={}));class Tt{get(e){this.disposableImplementationExtension.throwIfDisposed("get"),s().ULS.traceTag(595716238,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`localStorageClipboardStorage.get: commandParameters.id='${e?e.id:l}'`);const t=localStorage.getItem(this.localStorageKey);if(!t)return Promise.resolve(ie());try{const e=JSON.parse(t);if(!e||0===oe(e))return Promise.resolve(ie());const r=se(e);return Promise.resolve(r)}catch(e){return Promise.resolve(ie())}}set(e,t){this.disposableImplementationExtension.throwIfDisposed("set"),s().ULS.traceTag(595716239,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`localStorageClipboardStorage.set: item count=${ne(e)}'; commandParameters.id='${t?t.id:l}'`),0===ne(e)?localStorage.removeItem(this.localStorageKey):localStorage.setItem(this.localStorageKey,JSON.stringify(e.getData()));const r=`${this.localStorageKey+yt}`,a=Ve();return s().ULS.traceTag(595654546,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`localStorageClipboardStorage.set: set local storage value. eventFalgKey = ${r}. eventFlagValue = ${a}`),localStorage.setItem(r,a),Promise.resolve()}getSupportedDataFormats(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[Z,X,"data/shadow-workbook"]}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()}constructor(e){this.localStorageKey=e;try{if(!localStorage)throw new Error("LocalStorageClipboardStorage.ctor: localStorage == null")}catch(e){throw new M(m.LocalStorageInitilizationInaccessible,"LocalStorageClipboardStorage.ctor: failed access to localStorage",e)}if(!e)throw new M(m.LocalStorageInitilizationNoKey,"LocalStorageClipboardStorage.ctor: localStorageKey must be defined");this.clipboardStorageType=ge.LocalStorage,this.disposableImplementationExtension=Xe("LocalStorageClipboardStorage")}}class It extends Qe{constructor(e){super(d.LocalStorage,{browserStorage:!0,systemClipboard:!1,inMemory:!1},e)}}class vt{onStorageChanged(e){s().ULS.shipAssertTag(595716249,o.nh.msoulscat_ES_EWAJS,null!=e,"e should not be null"),s().ULS.traceTag(595716288,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`LocalStorageKeyChangeTracker.onStorageChanged:got storage change event. e.key = ${e.key}. localStorageKeyToWatch = ${this.localStorageKeyToWatch}. lastLocalStorageValue = ${this.lastLocalStorageValue}`),e.key===this.localStorageKeyToWatch&&(this.raiseMetadataChangedEvent(),s().ULS.traceTag(595716289,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`LocalStorageKeyChangeTracker.onStorageChanged: raised metadata change event. lastLocalStorageValue = ${this.lastLocalStorageValue}`),this.isLocalStorageValueChanged()||this.waitForLocalStorageValueToChange(this.maxTimeToWaitInMilliseconds).then((()=>{this.raiseMetadataChangedEvent()}),(()=>{s().ULS.traceTag(595716295,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,"LocalStorageKeyChangeTracker.onStorageChanged: got rejected promise.")})))}raiseMetadataChangedEvent(){return s().ULS.traceTag(595715525,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: starting raiseMetadataChangedEvent. lastLocalStorageValue = ${this.lastLocalStorageValue}`),this.clipboardStrategy.get({userHash:0}).then((e=>{this.listener(e),s().ULS.traceTag(595716232,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: sent message. lastLocalStorageValue = ${this.lastLocalStorageValue}`)}),(e=>{s().ULS.traceTag(595716233,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,"LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: failed to get metadata from clipboardStorage")}))}isLocalStorageValueChanged(){const e=localStorage.getItem(this.localStorageKeyToWatch),t=this.lastLocalStorageValue!==e;return s().ULS.traceTag(595715526,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`LocalStorageKeyChangeTracker.isLocalStorageValueChanged: lastLocalStorageValue = ${this.lastLocalStorageValue}. currentLocalStorageValue = ${e}`),this.lastLocalStorageValue=e,t}waitForLocalStorageValueToChange(e){if(s().ULS.traceTag(595715527,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: start waitForLocalStorageValueToChange. lastLocalStorageValue = ${this.lastLocalStorageValue}`),this.isLocalStorageValueChanged())return s().ULS.traceTag(595715528,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: resolving because value was changed. lastLocalStorageValue = ${this.lastLocalStorageValue}`),Promise.resolve();const t=tt(),r=new Date,a=setInterval((()=>{const i=(new Date).getTime()-r.getTime();s().ULS.traceTag(595715529,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: call by setInterval. startTime = ${r}. elapseTime = ${i}. lastLocalStorageValue = ${this.lastLocalStorageValue}`),this.isLocalStorageValueChanged()?(clearInterval(a),s().ULS.traceTag(595716234,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: resolving. startTime = ${r}. elapseTime = ${i}. lastLocalStorageValue = ${this.lastLocalStorageValue}`),t.resolve()):i>e&&(clearInterval(a),s().ULS.traceTag(595716235,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: rejecting. startTime = ${r}. elapseTime = ${i}. lastLocalStorageValue = ${this.lastLocalStorageValue}`),t.reject())}),200);return t.promise}constructor(e,t,r){this.localStorageKeyToWatch=e,this.clipboardStrategy=t,this.listener=r,this.maxTimeToWaitInMilliseconds=2e3,this.lastLocalStorageValue=null,window.addEventListener("storage",this.onStorageChanged.bind(this)),this.raiseMetadataChangedEvent()}}const At={},Pt="undefined"!=typeof self&&self.trustedTypes?self.trustedTypes:{createPolicy:(e,t)=>t},{entries:Lt,setPrototypeOf:Dt,isFrozen:xt,getPrototypeOf:Mt,getOwnPropertyDescriptor:kt}=Object;let{freeze:Wt,seal:$t,create:Rt}=Object,{apply:Ot,construct:Ut}="undefined"!=typeof Reflect&&Reflect;Wt||(Wt=function(e){return e}),$t||($t=function(e){return e}),Ot||(Ot=function(e,t,r){return e.apply(t,r)}),Ut||(Ut=function(e,t){return new e(...t)});const Ft=er(Array.prototype.forEach),Nt=er(Array.prototype.lastIndexOf),Jt=er(Array.prototype.pop),zt=er(Array.prototype.push),jt=er(Array.prototype.splice),Ht=er(String.prototype.toLowerCase),Vt=er(String.prototype.toString),Bt=er(String.prototype.match),Gt=er(String.prototype.replace),Kt=er(String.prototype.indexOf),qt=er(String.prototype.trim),Zt=er(Object.prototype.hasOwnProperty),Yt=er(RegExp.prototype.test),Xt=(Qt=TypeError,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Ut(Qt,t)});var Qt;function er(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];return Ot(e,t,a)}}function tr(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ht;Dt&&Dt(e,null);let a=t.length;for(;a--;){let i=t[a];if("string"==typeof i){const e=r(i);e!==i&&(xt(t)||(t[a]=e),i=e)}e[i]=!0}return e}function rr(e){for(let t=0;t<e.length;t++)Zt(e,t)||(e[t]=null);return e}function ar(e){const t=Rt(null);for(const[r,a]of Lt(e))Zt(e,r)&&(Array.isArray(a)?t[r]=rr(a):a&&"object"==typeof a&&a.constructor===Object?t[r]=ar(a):t[r]=a);return t}function ir(e,t){for(;null!==e;){const r=kt(e,t);if(r){if(r.get)return er(r.get);if("function"==typeof r.value)return er(r.value)}e=Mt(e)}return function(){return null}}const or=Wt(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),nr=Wt(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),sr=Wt(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),lr=Wt(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),cr=Wt(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),dr=Wt(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),pr=Wt(["#text"]),mr=Wt(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),ur=Wt(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),gr=Wt(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),hr=Wt(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),fr=$t(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Sr=$t(/<%[\w\W]*|[\w\W]*%>/gm),br=$t(/\$\{[\w\W]*/gm),yr=$t(/^data-[\-\w.\u00B7-\uFFFF]+$/),Cr=$t(/^aria-[\-\w]+$/),Er=$t(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),wr=$t(/^(?:\w+script|data):/i),_r=$t(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Tr=$t(/^html$/i),Ir=$t(/^[a-z][.\w]*(-[.\w]+)+$/i);var vr=Object.freeze({__proto__:null,ARIA_ATTR:Cr,ATTR_WHITESPACE:_r,CUSTOM_ELEMENT:Ir,DATA_ATTR:yr,DOCTYPE_NAME:Tr,ERB_EXPR:Sr,IS_ALLOWED_URI:Er,IS_SCRIPT_OR_DATA:wr,MUSTACHE_EXPR:fr,TMPLIT_EXPR:br});var Ar=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof window?null:window;const r=t=>e(t);if(r.version="3.2.6",r.removed=[],!t||!t.document||9!==t.document.nodeType||!t.Element)return r.isSupported=!1,r;let{document:a}=t;const i=a,o=i.currentScript,{DocumentFragment:n,HTMLTemplateElement:s,Node:l,Element:c,NodeFilter:d,NamedNodeMap:p=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:m,DOMParser:u,trustedTypes:g}=t,h=c.prototype,f=ir(h,"cloneNode"),S=ir(h,"remove"),b=ir(h,"nextSibling"),y=ir(h,"childNodes"),C=ir(h,"parentNode");if("function"==typeof s){const e=a.createElement("template");e.content&&e.content.ownerDocument&&(a=e.content.ownerDocument)}let E,w="";const{implementation:_,createNodeIterator:T,createDocumentFragment:I,getElementsByTagName:v}=a,{importNode:A}=i;let P={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};r.isSupported="function"==typeof Lt&&"function"==typeof C&&_&&void 0!==_.createHTMLDocument;const{MUSTACHE_EXPR:L,ERB_EXPR:D,TMPLIT_EXPR:x,DATA_ATTR:M,ARIA_ATTR:k,IS_SCRIPT_OR_DATA:W,ATTR_WHITESPACE:$,CUSTOM_ELEMENT:R}=vr;let{IS_ALLOWED_URI:O}=vr,U=null;const F=tr({},[...or,...nr,...sr,...cr,...pr]);let N=null;const J=tr({},[...mr,...ur,...gr,...hr]);let z=Object.seal(Rt(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),j=null,H=null,V=!0,B=!0,G=!1,K=!0,q=!1,Z=!0,Y=!1,X=!1,Q=!1,ee=!1,te=!1,re=!1,ae=!0,ie=!1,oe=!0,ne=!1,se={},le=null;const ce=tr({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let de=null;const pe=tr({},["audio","video","img","source","image","track"]);let me=null;const ue=tr({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ge="http://www.w3.org/1998/Math/MathML",he="http://www.w3.org/2000/svg",fe="http://www.w3.org/1999/xhtml";let Se=fe,be=!1,ye=null;const Ce=tr({},[ge,he,fe],Vt);let Ee=tr({},["mi","mo","mn","ms","mtext"]),we=tr({},["annotation-xml"]);const _e=tr({},["title","style","font","a","script"]);let Te=null;const Ie=["application/xhtml+xml","text/html"];let ve=null,Ae=null;const Pe=a.createElement("form"),Le=function(e){return e instanceof RegExp||e instanceof Function},De=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Ae||Ae!==e){if(e&&"object"==typeof e||(e={}),e=ar(e),Te=-1===Ie.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,ve="application/xhtml+xml"===Te?Vt:Ht,U=Zt(e,"ALLOWED_TAGS")?tr({},e.ALLOWED_TAGS,ve):F,N=Zt(e,"ALLOWED_ATTR")?tr({},e.ALLOWED_ATTR,ve):J,ye=Zt(e,"ALLOWED_NAMESPACES")?tr({},e.ALLOWED_NAMESPACES,Vt):Ce,me=Zt(e,"ADD_URI_SAFE_ATTR")?tr(ar(ue),e.ADD_URI_SAFE_ATTR,ve):ue,de=Zt(e,"ADD_DATA_URI_TAGS")?tr(ar(pe),e.ADD_DATA_URI_TAGS,ve):pe,le=Zt(e,"FORBID_CONTENTS")?tr({},e.FORBID_CONTENTS,ve):ce,j=Zt(e,"FORBID_TAGS")?tr({},e.FORBID_TAGS,ve):ar({}),H=Zt(e,"FORBID_ATTR")?tr({},e.FORBID_ATTR,ve):ar({}),se=!!Zt(e,"USE_PROFILES")&&e.USE_PROFILES,V=!1!==e.ALLOW_ARIA_ATTR,B=!1!==e.ALLOW_DATA_ATTR,G=e.ALLOW_UNKNOWN_PROTOCOLS||!1,K=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,q=e.SAFE_FOR_TEMPLATES||!1,Z=!1!==e.SAFE_FOR_XML,Y=e.WHOLE_DOCUMENT||!1,ee=e.RETURN_DOM||!1,te=e.RETURN_DOM_FRAGMENT||!1,re=e.RETURN_TRUSTED_TYPE||!1,Q=e.FORCE_BODY||!1,ae=!1!==e.SANITIZE_DOM,ie=e.SANITIZE_NAMED_PROPS||!1,oe=!1!==e.KEEP_CONTENT,ne=e.IN_PLACE||!1,O=e.ALLOWED_URI_REGEXP||Er,Se=e.NAMESPACE||fe,Ee=e.MATHML_TEXT_INTEGRATION_POINTS||Ee,we=e.HTML_INTEGRATION_POINTS||we,z=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&Le(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(z.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&Le(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(z.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(z.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),q&&(B=!1),te&&(ee=!0),se&&(U=tr({},pr),N=[],!0===se.html&&(tr(U,or),tr(N,mr)),!0===se.svg&&(tr(U,nr),tr(N,ur),tr(N,hr)),!0===se.svgFilters&&(tr(U,sr),tr(N,ur),tr(N,hr)),!0===se.mathMl&&(tr(U,cr),tr(N,gr),tr(N,hr))),e.ADD_TAGS&&(U===F&&(U=ar(U)),tr(U,e.ADD_TAGS,ve)),e.ADD_ATTR&&(N===J&&(N=ar(N)),tr(N,e.ADD_ATTR,ve)),e.ADD_URI_SAFE_ATTR&&tr(me,e.ADD_URI_SAFE_ATTR,ve),e.FORBID_CONTENTS&&(le===ce&&(le=ar(le)),tr(le,e.FORBID_CONTENTS,ve)),oe&&(U["#text"]=!0),Y&&tr(U,["html","head","body"]),U.table&&(tr(U,["tbody"]),delete j.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw Xt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw Xt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');E=e.TRUSTED_TYPES_POLICY,w=E.createHTML("")}else void 0===E&&(E=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let r=null;const a="data-tt-policy-suffix";t&&t.hasAttribute(a)&&(r=t.getAttribute(a));const i="dompurify"+(r?"#"+r:"");try{return e.createPolicy(i,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}}(g,o)),null!==E&&"string"==typeof w&&(w=E.createHTML(""));Wt&&Wt(e),Ae=e}},xe=tr({},[...nr,...sr,...lr]),Me=tr({},[...cr,...dr]),ke=function(e){zt(r.removed,{element:e});try{C(e).removeChild(e)}catch(t){S(e)}},We=function(e,t){try{zt(r.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){zt(r.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(ee||te)try{ke(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},$e=function(e){let t=null,r=null;if(Q)e="<remove></remove>"+e;else{const t=Bt(e,/^[\r\n\t ]+/);r=t&&t[0]}"application/xhtml+xml"===Te&&Se===fe&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const i=E?E.createHTML(e):e;if(Se===fe)try{t=(new u).parseFromString(i,Te)}catch(e){}if(!t||!t.documentElement){t=_.createDocument(Se,"template",null);try{t.documentElement.innerHTML=be?w:i}catch(e){}}const o=t.body||t.documentElement;return e&&r&&o.insertBefore(a.createTextNode(r),o.childNodes[0]||null),Se===fe?v.call(t,Y?"html":"body")[0]:Y?t.documentElement:o},Re=function(e){return T.call(e.ownerDocument||e,e,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},Oe=function(e){return e instanceof m&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof p)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},Ue=function(e){return"function"==typeof l&&e instanceof l};function Fe(e,t,a){Ft(e,(e=>{e.call(r,t,a,Ae)}))}const Ne=function(e){let t=null;if(Fe(P.beforeSanitizeElements,e,null),Oe(e))return ke(e),!0;const a=ve(e.nodeName);if(Fe(P.uponSanitizeElement,e,{tagName:a,allowedTags:U}),Z&&e.hasChildNodes()&&!Ue(e.firstElementChild)&&Yt(/<[/\w!]/g,e.innerHTML)&&Yt(/<[/\w!]/g,e.textContent))return ke(e),!0;if(7===e.nodeType)return ke(e),!0;if(Z&&8===e.nodeType&&Yt(/<[/\w]/g,e.data))return ke(e),!0;if(!U[a]||j[a]){if(!j[a]&&ze(a)){if(z.tagNameCheck instanceof RegExp&&Yt(z.tagNameCheck,a))return!1;if(z.tagNameCheck instanceof Function&&z.tagNameCheck(a))return!1}if(oe&&!le[a]){const t=C(e)||e.parentNode,r=y(e)||e.childNodes;if(r&&t)for(let a=r.length-1;a>=0;--a){const i=f(r[a],!0);i.__removalCount=(e.__removalCount||0)+1,t.insertBefore(i,b(e))}}return ke(e),!0}return e instanceof c&&!function(e){let t=C(e);t&&t.tagName||(t={namespaceURI:Se,tagName:"template"});const r=Ht(e.tagName),a=Ht(t.tagName);return!!ye[e.namespaceURI]&&(e.namespaceURI===he?t.namespaceURI===fe?"svg"===r:t.namespaceURI===ge?"svg"===r&&("annotation-xml"===a||Ee[a]):Boolean(xe[r]):e.namespaceURI===ge?t.namespaceURI===fe?"math"===r:t.namespaceURI===he?"math"===r&&we[a]:Boolean(Me[r]):e.namespaceURI===fe?!(t.namespaceURI===he&&!we[a])&&!(t.namespaceURI===ge&&!Ee[a])&&!Me[r]&&(_e[r]||!xe[r]):!("application/xhtml+xml"!==Te||!ye[e.namespaceURI]))}(e)?(ke(e),!0):"noscript"!==a&&"noembed"!==a&&"noframes"!==a||!Yt(/<\/no(script|embed|frames)/i,e.innerHTML)?(q&&3===e.nodeType&&(t=e.textContent,Ft([L,D,x],(e=>{t=Gt(t,e," ")})),e.textContent!==t&&(zt(r.removed,{element:e.cloneNode()}),e.textContent=t)),Fe(P.afterSanitizeElements,e,null),!1):(ke(e),!0)},Je=function(e,t,r){if(ae&&("id"===t||"name"===t)&&(r in a||r in Pe))return!1;if(B&&!H[t]&&Yt(M,t));else if(V&&Yt(k,t));else if(!N[t]||H[t]){if(!(ze(e)&&(z.tagNameCheck instanceof RegExp&&Yt(z.tagNameCheck,e)||z.tagNameCheck instanceof Function&&z.tagNameCheck(e))&&(z.attributeNameCheck instanceof RegExp&&Yt(z.attributeNameCheck,t)||z.attributeNameCheck instanceof Function&&z.attributeNameCheck(t))||"is"===t&&z.allowCustomizedBuiltInElements&&(z.tagNameCheck instanceof RegExp&&Yt(z.tagNameCheck,r)||z.tagNameCheck instanceof Function&&z.tagNameCheck(r))))return!1}else if(me[t]);else if(Yt(O,Gt(r,$,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==Kt(r,"data:")||!de[e])if(G&&!Yt(W,Gt(r,$,"")));else if(r)return!1;return!0},ze=function(e){return"annotation-xml"!==e&&Bt(e,R)},je=function(e){Fe(P.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||Oe(e))return;const a={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:N,forceKeepAttr:void 0};let i=t.length;for(;i--;){const o=t[i],{name:n,namespaceURI:s,value:l}=o,c=ve(n),d=l;let p="value"===n?d:qt(d);if(a.attrName=c,a.attrValue=p,a.keepAttr=!0,a.forceKeepAttr=void 0,Fe(P.uponSanitizeAttribute,e,a),p=a.attrValue,!ie||"id"!==c&&"name"!==c||(We(n,e),p="user-content-"+p),Z&&Yt(/((--!?|])>)|<\/(style|title)/i,p)){We(n,e);continue}if(a.forceKeepAttr)continue;if(!a.keepAttr){We(n,e);continue}if(!K&&Yt(/\/>/i,p)){We(n,e);continue}q&&Ft([L,D,x],(e=>{p=Gt(p,e," ")}));const m=ve(e.nodeName);if(Je(m,c,p)){if(E&&"object"==typeof g&&"function"==typeof g.getAttributeType)if(s);else switch(g.getAttributeType(m,c)){case"TrustedHTML":p=E.createHTML(p);break;case"TrustedScriptURL":p=E.createScriptURL(p)}if(p!==d)try{s?e.setAttributeNS(s,n,p):e.setAttribute(n,p),Oe(e)?ke(e):Jt(r.removed)}catch(t){We(n,e)}}else We(n,e)}Fe(P.afterSanitizeAttributes,e,null)},He=function e(t){let r=null;const a=Re(t);for(Fe(P.beforeSanitizeShadowDOM,t,null);r=a.nextNode();)Fe(P.uponSanitizeShadowNode,r,null),Ne(r),je(r),r.content instanceof n&&e(r.content);Fe(P.afterSanitizeShadowDOM,t,null)};return r.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=null,o=null,s=null,c=null;if(be=!e,be&&(e="\x3c!--\x3e"),"string"!=typeof e&&!Ue(e)){if("function"!=typeof e.toString)throw Xt("toString is not a function");if("string"!=typeof(e=e.toString()))throw Xt("dirty is not a string, aborting")}if(!r.isSupported)return e;if(X||De(t),r.removed=[],"string"==typeof e&&(ne=!1),ne){if(e.nodeName){const t=ve(e.nodeName);if(!U[t]||j[t])throw Xt("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof l)a=$e("\x3c!----\x3e"),o=a.ownerDocument.importNode(e,!0),1===o.nodeType&&"BODY"===o.nodeName||"HTML"===o.nodeName?a=o:a.appendChild(o);else{if(!ee&&!q&&!Y&&-1===e.indexOf("<"))return E&&re?E.createHTML(e):e;if(a=$e(e),!a)return ee?null:re?w:""}a&&Q&&ke(a.firstChild);const d=Re(ne?e:a);for(;s=d.nextNode();)Ne(s),je(s),s.content instanceof n&&He(s.content);if(ne)return e;if(ee){if(te)for(c=I.call(a.ownerDocument);a.firstChild;)c.appendChild(a.firstChild);else c=a;return(N.shadowroot||N.shadowrootmode)&&(c=A.call(i,c,!0)),c}let p=Y?a.outerHTML:a.innerHTML;return Y&&U["!doctype"]&&a.ownerDocument&&a.ownerDocument.doctype&&a.ownerDocument.doctype.name&&Yt(Tr,a.ownerDocument.doctype.name)&&(p="<!DOCTYPE "+a.ownerDocument.doctype.name+">\n"+p),q&&Ft([L,D,x],(e=>{p=Gt(p,e," ")})),E&&re?E.createHTML(p):p},r.setConfig=function(){De(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),X=!0},r.clearConfig=function(){Ae=null,X=!1},r.isValidAttribute=function(e,t,r){Ae||De({});const a=ve(e),i=ve(t);return Je(a,i,r)},r.addHook=function(e,t){"function"==typeof t&&zt(P[e],t)},r.removeHook=function(e,t){if(void 0!==t){const r=Nt(P[e],t);return-1===r?void 0:jt(P[e],r,1)[0]}return Jt(P[e])},r.removeHooks=function(e){P[e]=[]},r.removeAllHooks=function(){P={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},r}();const Pr={ADD_TAGS:["#comment"],RETURN_TRUSTED_TYPE:!1},Lr=["applet","base","basefont","command","embed","frame","frameset","keygen","link","meta","noframes","noscript","object","param","script","title"],Dr=["contenteditable","contextmenu","controls","data","decoding","defer","dirname","draggable","dropzone","form","formaction","http-equiv","icon","importance","itemprop","keytype","kind","language","lazyload","manifest","minlength","muted","ping","sandbox","scoped","slot","spellcheck","srcdoc","srclang","start","target","translate","wrap","onerror","onclick","onload","onmouseover","onfocus","onblur","src","href"],xr=Ar||i;xr.isValidAttribute,((e,t,r=Pt,a,i=!1)=>{try{At[e]||(At[e]=r.createPolicy(e,{createHTML:t.createHTML,createScript:t.createScript,createScriptURL:t.createScriptURL}))}catch(e){if(a?.(`${e}`),i)throw e}At[e]})("domPurifyHTML",{createHTML:(e,t,r)=>((e,t,r)=>{let a=!1;const i=t?(e=>({...Pr,ALLOW_ARIA_ATTR:!1!==e.ALLOW_ARIA_ATTR,ALLOW_DATA_ATTR:!1!==e.ALLOW_DATA_ATTR,FORCE_BODY:e.FORCE_BODY||!1,IN_PLACE:e.IN_PLACE||!1,SAFE_FOR_TEMPLATES:e.SAFE_FOR_TEMPLATES||!1,SANITIZE_DOM:!1!==e.SANITIZE_DOM,SANITIZE_NAMED_PROPS:e.SANITIZE_NAMED_PROPS||!1,USE_PROFILES:!!e.USE_PROFILES&&e.USE_PROFILES,WHOLE_DOCUMENT:e.WHOLE_DOCUMENT||!1,PARSER_MEDIA_TYPE:e.PARSER_MEDIA_TYPE??"text/html"}))(t):Pr;r&&Object.entries(r).forEach((([e,t])=>{xr.addHook(e,t)}));const o=xr.sanitize(e,i);return r&&Object.entries(r).forEach((([e])=>{xr.removeHooks(e)})),t?.USE_PROFILES?o:(a=(e=>{let t=!1,r=!1;const a=new Set,i=new Set;return e.length>0&&(e.forEach((e=>{e.attribute?(r=Dr.includes(e.attribute.localName)||r,a.add(e.attribute.localName)):e.element&&(r=Lr.includes(e.element.localName)||r,i.add(e.element.localName))})),(a.size>0||i.size>0)&&(r||(t=!0))),t})(xr.removed),a?e:o)})(e,t,r)},undefined);const Mr="\n",kr="\r",Wr=new RegExp(`(${Mr}${kr})|(${kr}${Mr})|(${kr})`,"g"),$r=new RegExp("(\t)","g"),Rr=10240,Or=new RegExp("<","g"),Ur=new RegExp(">","g"),Fr="table",Nr="tr",Jr="td",zr=`Version:0.9${Mr}StartHTML:0000000100${Mr}EndHTML:{EndHTML0}${Mr}StartFragment:0000000134${Mr}EndFragment:{EndFragm}${Mr}<html>${Mr}<body>${Mr}\x3c!--StartFragment--\x3e${Mr}`,jr=`\x3c!--EndFragment--\x3e${Mr}</body>${Mr}</html>`,Hr="0000000000",Vr="data-ccp-timestamp";function Br(e){return e?e.replace(Wr,Mr):e}function Gr(e){return e?e.length<=Rr?e:e.substr(0,Rr):l}function Kr(e){var t,r;const a=function(e){return e?e.replace(Wr,`</${Jr}></${Nr}><${Nr}><${Jr}>`):e}((r=(t=e)?t.replace(Or,"&lt;").replace(Ur,"&gt;"):l)?r.replace($r,`</${Jr}><${Jr}>`):r);return`<${Fr}><${Nr}><${Jr}>${a}</${Jr}></${Nr}></${Fr}>`}function qr(e){const t=[],r=e.getElementsByTagName("td");if(r.length>0){t.push(r[0].innerText);for(let e=1;e<r.length;e+=1)t.push("\t"),t.push(r[e].innerText)}return t.join("")}function Zr(e){if(!z()||z()&&R.isEdgeVersionWithTextHtmlWrapperSupportProperty)return e;const t=10,r=zr.length+e.length+jr.length;let a=(r-jr.length).toString();if(a.length<t&&(a=Hr.substr(0,t-a.length)+a),a.length!==t){const e=`addClipboardWrapperForEdge: the string representation of the opening bracket position of the End Fragment xml comment is ${a.length} but it should be 10`;throw s().ULS.shipAssertTag(596128536,o.nh.msoulscat_ES_EWAJS,!1,e),new M(m.UnexpectedClipboardTextHtmlContentLength,e)}let i=(r-7).toString();if(i.length<t&&(i=Hr.substr(0,t-i.length)+i),i.length!==t){const e=`addClipboardWrapperForEdge: the string representation of the opening bracket position of the End Html tag is ${i.length} but it should be 10`;throw s().ULS.shipAssertTag(596128537,o.nh.msoulscat_ES_EWAJS,!1,e),new M(m.UnexpectedClipboardTextHtmlContentLength,e)}const n=zr.replace("{EndHTML0}",i).replace("{EndFragm}",a)+e+jr;return s().ULS.shipAssertTag(596128538,o.nh.msoulscat_ES_EWAJS,n.length===r,`addClipboardWrapperForEdge: The resulting text/html payload length of ${n.length} differs from the expected length of ${r}`),n}let Yr;var Xr=r(7454);let Qr;const ea={serializeMetadata:function(e){if(!e)return"{}";try{const t={},r=function(e){if(e)try{if(!e.id)throw new M(m.SerializedMetadata,"MetadataSerializer.serializeCopyContext: copyContext.id is not defined");if(!e.sessionId)throw new M(m.SerializedMetadata,"MetadataSerializer.serializeCopyContext: copyContext.sessionId is not defined");if(void 0===e.copyStatus)throw new M(m.SerializedMetadata,"MetadataSerializer.serializeCopyContext: copyContext.copyStatus is not defined");return{id:e.id,sessionId:e.sessionId,sourceItem:Qr.serializeSourceItem(e.sourceItem),commandParameters:Qr.serializeCommandParameters(e.commandParameters),copyStatus:e.copyStatus,isTimestampStoredInSystemClipboard:e.isTimestampStoredInSystemClipboard,isAsyncSerializeFailed:e.isAsyncSerializeFailed,asyncClipboardItemsKeys:e.asyncClipboardItemsKeys,syncClipboardItemsKeys:e.syncClipboardItemsKeys,isFullSheetCopy:e.isFullSheetCopy}}catch(e){return void s().ULS.traceTag(595945243,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`MetadataSerializer.serializeCopyContext: failed to serialized copyContext: ${o.Wp.getStringifiedError(e)}`)}}(e.lastCopy);return r&&(t.copyContext=r),JSON.stringify(t)}catch(e){return s().ULS.traceTag(595945242,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`MetadataSerializer.serializeMetadata: failed to serialized metadata: ${o.Wp.getStringifiedError(e)}`),"{}"}},deserializeMetadata:function(e){if(!e)return{};try{const t=JSON.parse(e),r={};return t.copyContext&&(r.lastCopy=function(e){if(e)try{if(!e.id)throw new M(m.DeserializedMetadata,"MetadataSerializer.deserializeCopyContext: copyContextSerializationData.id is not defined");if(!e.sessionId)throw new M(m.DeserializedMetadata,"MetadataSerializer.deserializeCopyContext: copyContextSerializationData.sessionId is not defined");if(!e.copyStatus)throw new M(m.DeserializedMetadata,"MetadataSerializer.deserializeCopyContext: copyContextSerializationData.copyStatus is not defined");if(!e.sourceItem)throw new M(m.DeserializedMetadata,"MetadataSerializer.deserializeCopyContext: copyContextSerializationData.sourceItem is not defined");if(!e.commandParameters)throw new M(m.DeserializedMetadata,"MetadataSerializer.deserializeCopyContext: copyContextSerializationData.commandParameters is not defined");const t=new Et;return t.id=e.id,t.sessionId=e.sessionId,t.copyStatus=e.copyStatus,t.isTimestampStoredInSystemClipboard=e.isTimestampStoredInSystemClipboard,t.isAsyncSerializeFailed=e.isAsyncSerializeFailed,t.sourceItem=Qr.deserializeSourceItem(e.sourceItem),t.commandParameters=Qr.deserializeCommandParameters(e.commandParameters),t.asyncClipboardItemsKeys=e.asyncClipboardItemsKeys,t.syncClipboardItemsKeys=e.syncClipboardItemsKeys,t.isFullSheetCopy=e.isFullSheetCopy,t}catch(e){return void s().ULS.traceTag(595945245,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`MetadataSerializer.deserializeMetadata: failed to deserialized copyContext with error: ${o.Wp.getStringifiedError(e)}.`)}}(t.copyContext)),r}catch(e){s().ULS.traceTag(595945244,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`MetadataSerializer.deserializeMetadata: failed to deserialized metadata with error: ${o.Wp.getStringifiedError(e)}`)}return{}}};let ta,ra,aa,ia={};const oa={};let na;const sa={getCachedMetadata:function(){return s().ULS.traceTag(595730648,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`MetadataManager.getCachedMetadata: get cached metadata with value: ${ma(ia)}`),_t(ia)},updateMetadata:function(e){s().ULS.traceTag(595730652,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`MetadataManager.updateMetadata: start update metadata with metadata : ${ma(e)}`);const t={...ia,...e},r=se();r.setItem("metadata",ra.serializeMetadata(t)),s().ULS.traceTag(595730653,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`MetadataManager.updateMetadata: schedule metadata with value: ${ma(t)}`),da(r,t)},clear:function(){s().ULS.traceTag(595730654,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"MetadataManager.clear: start clear metadata");da(se(),{})},addMetadataChangeListener:function(e,t){e||s().ULS.traceTag(595936158,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,"MetadataManager.addMetadataChangeListener: expected listenerId to be define"),t||s().ULS.traceTag(595936159,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,"MetadataManager.addMetadataChangeListener: expected listener to be define"),oa[e]&&s().ULS.traceTag(595936160,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`MetadataManager.addMetadataChangeListener: listener with same listenerId(${e} already exist.`),oa[e]=t},removeMetadataChangeListener:function(e){e||s().ULS.traceTag(595936161,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,"MetadataManager.addMetadataChangeListener: expected listenerId to be define"),oa[e]?delete oa[e]:s().ULS.traceTag(595936162,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`MetadataManager.removeMetadataChangeListener: can't find listener with listenerId = ${e}.`)},getMetadataSyncPromise:function(){return na&&(0,Xr.isChangeGateEnabled)("OfficeVSO:2594435_ArtCCPWaitForCopyToComplete")?(s().ULS.traceTag(595937174,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"MetadataManager.getMetadataSyncPromise: metadata not sync, return deferred promise."),na.deferredPromise.promise.then((e=>(s().ULS.traceTag(595937175,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"MetadataManager.getMetadataSyncPromise: sync promise resolved."),e)))):(s().ULS.traceTag(595937173,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"MetadataManager.getMetadataSyncPromise: metadata is sync, return resolved promise."),Promise.resolve(_t(ia)))},isMetadataSync:function(){return!na},serializeMetadata:function(e){return ra.serializeMetadata(e)},deserializeMetadata:function(e){return ra.deserializeMetadata(e)}};function la(e){try{if(e&&0!==ne(e)){const t=e.getItem("metadata");ia=ra.deserializeMetadata(t),s().ULS.traceTag(595730650,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`MetadataManager.onMetadataChanged: set cached metadata with value ${ma(ia)}`)}else s().ULS.traceTag(595730649,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"MetadataManager.onMetadataChanged: set empty cached metadata because clipboardItems were not found"),ia={}}catch(e){s().ULS.traceTag(595945248,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`MetadataManager.onMetadataChanged: failed to parse metadata string with error: ${o.Wp.getStringifiedError(e)}`),ia={}}ca(_t(ia))}function ca(e){s().ULS.traceTag(595730651,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`MetadataManager.updateListenerForMetadataChanged: update listeners with metadata : ${ma(e)}`);for(const t in oa){const r=oa[t];r&&r(e)}}function da(e,t){const r=Ve();na?na.metadataSyncMessageId=r:(na={metadataSyncMessageId:r,deferredPromise:tt()},s().ULS.traceTag(595937176,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`MetadataManager.scheduleMetadataUpdate: _syncMetadata created. ${na.metadataSyncMessageId}`)),s().ULS.traceTag(595937177,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`MetadataManager.scheduleMetadataUpdate: set metadata request was sent with message id ${r}.`),setTimeout((()=>{ta.set(e,{}).then((()=>{ia=t,s().ULS.traceTag(595937178,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`MetadataManager.scheduleMetadataUpdate: set metadata successfully. messageId=${r}. _syncMetadata.metadataSyncMessageId = ${na&&na.metadataSyncMessageId}. newMetadata = ${ma(t)}`),pa(r)}),(e=>{s().ULS.traceTag(595945250,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`MetadataManager.updateMetadata: failed to update metadata store with error: ${o.Wp.getStringifiedError(e)}`),pa(r)}))}),0)}function pa(e){if(s().ULS.traceTag(595730655,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`MetadataManager.notifyMetadataSyncIfNeeded: start notifyMetadataSyncIfNeeded with messageId: ${e}`),na&&na.metadataSyncMessageId===e){const e=na;na=void 0;const t=_t(ia);s().ULS.traceTag(595730656,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`MetadataManager.notifyMetadataSyncIfNeeded: resolve with metadata: ${ma(t)}`),ca(t),e.deferredPromise.resolve(t)}}function ma(e){return e?e.lastCopy?`copyContext.id=${e.lastCopy.id}`:"copy context is null":"metadata is null"}const ua="ccp_infra_version=['|\"](\\d+)['|\"]";class ga{wrapTextWithDataSignature(e,t,r,a="null",i){const o={ccp_infra_version:3,ccp_infra_timestamp:r,ccp_infra_user_hash:this.userHash,ccp_infra_copy_id:a};let n;return n=null!==i&&0!==Object.keys(i).length?{...o,...i}:o,n[Vr]=r,function(e,t,r){let a="";return r&&(a=Object.keys(r).reduce(((e,t)=>t?`${e} ${t}='${r[t]}'`:e),"")),`<${t}${a}>${e}</${t}>`}(e,t,n)}ensureDataSignatureInHtmlItem(e){if(0===ne(e))return;const t=me(e),r=de(t,re),a=de(t,"metadata/additional-signature-data-attributes");let i=null;if(a!==l&&(i=JSON.parse(a)),e.hasDeferredItem(X)){const t=e.getDeferredItem(X);if(t){const a=t.then((e=>e.text())).then((e=>void 0!==this.getRegExIntValue(e,ua)?new Blob([e],{type:X}):new Blob([this.wrapTextWithDataSignature(e,"div",Date.now(),r,i)],{type:X})));return void e.setDeferredItem(X,a)}}else{const a=de(t,X);if(a){if(void 0!==this.getRegExIntValue(a,ua))return;return void e.setItem(X,this.wrapTextWithDataSignature(a,"div",Date.now(),r,i))}}if(e.hasDeferredItem(Z)){const t=e.getDeferredItem(Z);if(t){const a=t.then((e=>e.text())).then((e=>{const t=Kr(e),a=this.wrapTextWithDataSignature(t,"pre",Date.now(),r,i);return new Blob([Zr(a)],{type:X})}));e.setDeferredItem(X,a)}}else{const a=Kr(pe(t)),o=this.wrapTextWithDataSignature(a,"pre",Date.now(),r,i);e.setItem(X,Zr(o))}}extractSignatureData(e){if(oe(e)>0){const t=le(e,X),r=this.getRegExIntValue(t,ua);if(void 0===r)return this.parsePreSignatureData(t);if(this.blockMismatchDataVersion&&3!==r)throw s().ULS.traceTag(595902983,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`clipboardDataManager.extractSignatureData: block mismatch version. dataVer = ${r}, CCPInfraVersion = 3`),new I("ClipboardDataManagerImpl.extractSignatureData",r,3,this.blockMismatchDataVersion);return r<3?(s().ULS.traceTag(595902986,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`clipboardDataManager.extractSignatureData: got data with older version then app version: dataVer = ${r}, CCPInfraVersion = 3. Converting to the data`),this.parseOldSignatureData(t)):(r>3&&s().ULS.traceTag(595900176,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`clipboardDataManager.extractSignatureData: got data with newer version then app version: dataVer = ${r}, CCPInfraVersion = 3. ( It's OK - Should be forward compatibility)`),this.parseCurrentVersionSignatureData(t))}}parseCurrentVersionSignatureData(e){const t=this.getRegExIntValue(e,"\\s+ccp_infra_timestamp=['|\"](\\d+)['|\"]"),r=this.getRegExIntValue(e,"\\s+ccp_infra_user_hash=['|\"](\\d+)['|\"]");if(void 0!==t&&void 0!==r){const a=this.getRegExStringValue(e,"\\s+ccp_infra_copy_id=['|\"]([\\w-]+)['|\"]");return a&&s().ULS.traceTag(595183181,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`clipboardDataManager.parseCurrentVersionSignatureData: copy ID of legacy paste cross session : ${a}`),{ccp_infra_version:3,ccp_infra_timestamp:t,ccp_infra_user_hash:r,ccp_infra_copy_id:a||""}}s().ULS.traceTag(595902985,o.nh.msoulscat_ES_EWAJS,o.kp.Error,`clipboardDataManager.extractSignatureData: Failed to extract SignatureData. textHtmlItem: ${e}`)}parseOldSignatureData(e){return this.parseCurrentVersionSignatureData(e)}parsePreSignatureData(e){const t=function(e){const t=function(e,t){if(!e||!e.trim())return;if(!t||!t.trim())throw new w(l,"attributeName");const r=new RegExp(`${t}=['"](\\d+)['"]`,"i").exec(e);return!r||r.length<2?void 0:r[1]}(e,Vr);if(!t||!t.trim())return;const r=Number(t);return!r&&0!==r||isNaN(r)?void 0:r}(e);if(s().ULS.traceTag(595723668,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`clipboardDataManager.parsePreSignatureData: dataTimeStamp=${t}`),t){if(this.blockMismatchDataVersion)throw s().ULS.traceTag(595899270,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,"clipboardDataManager.parsePreSignatureData: block mismatch version. block pre signature data"),new I("ClipboardDataManagerImpl.extractSignatureData",NaN,3,this.blockMismatchDataVersion);const e={ccp_infra_version:3,ccp_infra_timestamp:t,ccp_infra_user_hash:0};return s().ULS.traceTag(595723669,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"clipboardDataManager.parsePreSignatureData"),e}}validateTTL(e){if(e&&this.ttlInMs){const t=Date.now()-e.ccp_infra_timestamp;if(t>this.ttlInMs)throw s().ULS.traceTag(595899858,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`Time elapsed (${t} ms) from setting Clipboard (${e.ccp_infra_timestamp}) is greater then TTL (${this.ttlInMs} ms) - return error`),new v("clipboardDataManager.validateTTL validation failed",t,this.ttlInMs)}}validateUserHash(e){if(e&&e.ccp_infra_user_hash!==this.userHash)throw s().ULS.traceTag(595723670,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,"clipboardDataManager.validateUserHash: user hash mismatch detected. throw error"),new A("clipboardDataManager.validateUserHash validation failed",e?e.ccp_infra_user_hash:0,this.userHash)}setMetaDataVersionItem(e){if(0===ne(e))return;e.setItem(te,JSON.stringify({ccp_infra_version:3}))}validateMetaDataVersionItem(e){if(e&&ne(e)>0){const t=le(e.getData(),te);let r;try{r=JSON.parse(t)}catch(e){if(!this.blockMismatchDataVersion)return;throw s().ULS.traceTag(595899272,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`clipboardDataManager.validateMetaDataVersionItem: failed parse SignatureMetaData. error = ${e}`),new P(`ClipboardDataManagerImpl.validateMetaDataVersionItem: failed parse SignatureMetaData. SignatureMetaData text = ${t}`)}if(this.blockMismatchDataVersion&&3!==r.ccp_infra_version)throw s().ULS.traceTag(595899203,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`clipboardDataManager.validateMetaDataVersionItem: block mismatch version. dataVer = ${r.ccp_infra_version}, CCPInfraVersion = 3`),new I("ClipboardDataManagerImpl.validateMetaDataVersionItem",r.ccp_infra_version,3,this.blockMismatchDataVersion)}}createClipboardDataProcessor(e){return s().ULS.traceTag(595723671,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`clipboardDataManager.createClipboardDataProcessor: get called. validateUserHash=${e}`),{preSetProcess:this.ensureDataSignatureInHtmlItem.bind(this),postGetProcess:(t=>{if(s().ULS.traceTag(595723672,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`clipboardDataManager.createClipboardDataProcessor.postGet: get called. validateUserHash=${e}`),t){const r=this.extractSignatureData(t.getData());s().ULS.traceTag(595723673,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`clipboardDataManager.createClipboardDataProcessor.postGet: clipboardItems not empty. validateUserHash=${e}`),r&&t.setItem(re,r.ccp_infra_copy_id),this.validateTTL(r),e&&(s().ULS.traceTag(595723674,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`clipboardDataManager.createClipboardDataProcessor.postGet: going to validate user hash. validateUserHash=${e}`),this.validateUserHash(r))}}).bind(this)}}createDualClipboardDataProcessor(e){return s().ULS.traceTag(595723675,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"clipboardDataManager.createDualClipboardDataProcessor: get called."),{preSetProcess:this.ensureDataSignatureInHtmlItem.bind(this),postGetProcess:(e=>{s().ULS.traceTag(595723676,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"clipboardDataManager.createDualClipboardDataProcessor.postGet: get called."),e&&e.clipboardItemsData&&(e.signatureData=this.extractSignatureData(e.clipboardItemsData),e.signatureData&&(e.clipboardItemsData.items[re]=e.signatureData.ccp_infra_copy_id),this.validateTTL(e.signatureData))}).bind(this),validateUserHash:e?this.validateUserHash.bind(this):()=>{}}}createClipboardMetaDataProcessor(){return{preSetProcess:this.setMetaDataVersionItem.bind(this),postGetProcess:this.validateMetaDataVersionItem.bind(this)}}getRegExStringValue(e,t){const r=new RegExp(t,"g").exec(e);if(r&&r.length&&r.length>1)return r[1]}getRegExIntValue(e,t){const r=this.getRegExStringValue(e,t);if(r){const e=Number(r);return isNaN(e)?void 0:e}}constructor(e,t,r){this.ttlInMs=t,this.blockMismatchDataVersion=r,e?this.userHash=o.Wp.calcHashCode(e):(this.userHash=1565411791,s().ULS.traceTag(595903939,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,"userId not exist!. Use default ID"))}}class ha extends dt{init(e){var t,r;return this.deferredResultMessagePromiseCache=new nt,this.sender=(t=this.serializer,new ht(t,this)),this.receiver=(r=this.deserializer,new gt(r,this,this)),this.postInitMessage(e).catch((e=>(s().ULS.traceTag(596129250,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Init failure or timeout. Error: ${o.Wp.getStringifiedError(e)}`),f(e,m.IframeInitializationTimeout)?Promise.reject(e):Promise.reject(new M(m.IframeInitialization,"failed to init the Shared Clipboard",e)))))}registerPushMessageListener(e,t){this.pushMessageListeners[e]=t}postInitMessage(e){const t=Ge(st,"init",Ke.initIframe);if(!this.deferredResultMessagePromiseCache){const e="RPC Client - postInitMessage: this.deferredResultMessagePromiseCache should be defined";return s().ULS.shipAssertTag(596121487,o.nh.msoulscat_ES_EWAJS,!1,e),Promise.reject(new T(e))}const r=this.postMessage(t),a=this.deferredResultMessagePromiseCache.getDeferredPromise(t.id),i=Date.now();return setTimeout((()=>{if(a&&!a.fulfilled()){const e=Date.now(),t=`initialization started on ${new Date(i)} and timed out on ${new Date(e)} after ${e-i} ms`;s().ULS.traceTag(596129251,o.nh.msoulscat_ES_EWAJS,o.kp.Info,t),a.reject(new M(m.IframeInitializationTimeout,t))}}),e),r}postMessage(e){try{if(!e)throw new w(l,"outgoingMessage");if(s().ULS.shipAssertTag(596452175,o.nh.msoulscat_ES_EWAJS,!!e.id,"postMessage: outgoingMessage.id must be defined"),super.postMessage(e),!this.deferredResultMessagePromiseCache){const e="RPC Client - postMessage: this.deferredResultMessagePromiseCache should be defined";throw s().ULS.shipAssertTag(596121488,o.nh.msoulscat_ES_EWAJS,!1,e),new T(e)}return this.deferredResultMessagePromiseCache.addNewPromise(e.id).promise}catch(t){return Promise.reject(new T(`Unable to post message for operation '${e?e.operationCode:void 0}'`,t))}}handleMessage(e){s().ULS.traceTag(596452376,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`RPC Client - handleMessage: incomingMessage.id='${e&&e.id}'; incomingMessage.operationCode='${e&&e.operationCode}'; incomingMessage.failed='${e&&e.failed}'; incomingMessage.error='${e&&e.error}'; incomingMessage.clipboardItems.length=${oe(e&&e.clipboardItemsData)}`);const t=this.pushMessageListeners[e.operationCode];if(t)return t(e.clipboardItemsData),Promise.resolve();if(!this.deferredResultMessagePromiseCache){const e="RPC Client - handleMessage: this.deferredResultMessagePromiseCache should be defined";return s().ULS.shipAssertTag(596121489,o.nh.msoulscat_ES_EWAJS,!1,e),Promise.reject(new T(e))}const r="initresult"===e.operationCode?st:e.id,a=this.deferredResultMessagePromiseCache.getDeferredPromise(r);return a?(this.deferredResultMessagePromiseCache.delete(r),e.failed?a.reject(e.error):a.resolve(e),Promise.resolve()):(s().ULS.traceTag(596452377,o.nh.msoulscat_ES_EWAJS,o.kp.Info,r===e.id?`RPC Client - handleMessage: no deferred promise with id '${e.id}'; dropping this result.`:`RPC Client - handleMessage: no deferred promise with id '${r}' for message id '${e.id}'; dropping this result.`),Promise.resolve())}handleDeserializationError(e){return!e||"NoValidKeyError"!==e.errorName||this.deferredResultMessagePromiseCache&&0!==this.deferredResultMessagePromiseCache.getLength()?(s().ULS.traceTag(596452379,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`RPC Client - handleDeserializationError. There are ${this.deferredResultMessagePromiseCache?this.deferredResultMessagePromiseCache.getLength():0} deferred promise(s) in the cache. Error: ${o.Wp.getStringifiedError(e)}`),Promise.resolve()):(s().ULS.traceTag(542687372,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`RPC Client - handleDeserializationError. Error: ${o.Wp.getStringifiedError(e)}`),Promise.resolve())}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(k([()=>{this.deferredResultMessagePromiseCache&&this.deferredResultMessagePromiseCache.clear()}]),super.dispose())}constructor(e,t,r){super(e,t,r,"WindowRPCClientInternal"),this.pushMessageListeners={}}}const fa=[],Sa="load",ba="clipboard",ya="clipboard/shared.aspx",Ca="corrid",Ea={initialized:!1,origin:l,src:l,deferredPromise:void 0};let wa,_a;function Ta(){return Ea}function Ia(){if(wa){try{wa()}catch{}wa=void 0}}function va(e){return _a||(_a=Ta()),_a.initialized||(_a.origin=function(e){je();const t=Fe(e);let r=t.split(Le);if(!r||2!==r.length||!r[0]||!r[1])throw new _("Invalid origin","parentOrigin",e);const a=ve();let i=l;if(a.whitelistOriginComponents){const t=r[0]+Le;if(r=r[1].split(Me),!r||r.length<2||!r[0])throw new _("Invalid origin","parentOrigin",e);r.splice(0,1,a.sharedClipboardHostingApp),i=t+r.join(Me)}else i=t;return s().ULS.traceTag(596452424,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`getSharedClipboardValidatedOrigin: app's origin = '${e}'; Shared Clipboard iframe origin = '${i}' components=${JSON.stringify(r)}`),i}(e),_a.src=function(e){const t=Ta().origin;let r=t;"/"!==t.charAt(t.length-1)&&(r+="/"),r+=ya,e&&(r+=`?${encodeURIComponent(lt)}=${encodeURIComponent(e)}`);const a=[];fa.forEach((e=>{(0,Xr.isChangeGateEnabled)(e)||a.push({key:e,value:"1"})}));const i=function(){if(!Yr)throw new T("ClipboardPlatformSettings is not ready. Call ClipboardPlatformEnvironment.init(...).");return Yr}();i&&(i.sessionId&&a.push({key:ye,value:i.sessionId}),i.bulsEndpointUrl&&a.push({key:be,value:i.bulsEndpointUrl}));const[n,l]=(0,o.kA)();return s().ULS.traceTag(595722560,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`getValidatedIframeSrc.getValidatedIframeSrc: Generate correlation if for loading the shared clipboard frame. CorrelationId: ${n} newGuidLogging: ${l}`),a.push({key:Ca,value:n}),a.push({key:"NoAuth",value:"true"}),a.length>0&&a.forEach((e=>{r+=r.indexOf("?")>=0?"&":"?",r+=`${encodeURIComponent(e.key)}=${encodeURIComponent(e.value)}`})),r}(e),_a.initialized=!0),_a.origin}function Aa(){if(!_a)return Promise.reject("state in undefined, please make sure to call initialize first");let e=function(){if(!Ta().initialized)throw new T("getIframe: the initialize function should be called beforehand");const e=document.getElementsByTagName("iframe");if(e&&0!==e.length){s().ULS.traceTag(595952723,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`getIframe: found ${e.length} iframes`);for(let t=0;t<e.length;t+=1){const r=e[t];if(r&&r.id&&r.id===ba)return r}s().ULS.traceTag(595952724,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"getIframe: the CCP iframe does not exist")}else s().ULS.traceTag(595952722,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"getIframe: found no iframes")}();e&&(s().ULS.traceTag(596448770,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`ensureIframeWindow: The CCP iframe exists. Removing the iframe and re-adding it. iframe.src ${void 0!==e.src&&void 0!==_a.src&&e.src.toLowerCase()===_a.src.toLowerCase()?"===":"!=="} src; deferredPromise ${void 0===_a.deferredPromise?"does not exist":"exists"}; The iframe's content window ${void 0===e.contentWindow?"does not exist":"exists"}.`),function(e){if(!e)throw new w(l,"iframe");s().ULS.traceTag(595952725,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,"removeIframe: removing the CCP iframe"),Ia(),e.parentNode&&e.parentNode.removeChild(e)}(e),e=void 0);let t=_a.deferredPromise,r=t?t.id:l;if(t){Ia(),_a.deferredPromise=void 0;const e=`ensureIframeWindow: the CCP iframe does not exist and the deferred promise of its content window should not exist as well. Rejecting deferred promise id '${r}' and creating a new one`;s().ULS.shipAssertTag(596453587,o.nh.msoulscat_ES_EWAJS,!1,e),t.reject(new T(e)),t=void 0}_a.deferredPromise=tt(Ve()),t=_a.deferredPromise,r=t.id;try{e=function(){const e=document.createElement("iframe");return e.style.display="none",e.id=ba,s().ULS.shipAssertTag(595952726,o.nh.msoulscat_ES_EWAJS,!wa,"createIframe: the last shared clipboard iframe's onload event listener should have been removed. Removing it and registering a new event listener."),Ia(),wa=q(e,Sa,(e=>function(e){s().ULS.traceTag(595952727,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"CCP iframe onload event: Entering"),Ia();const t=Ta().deferredPromise;if(!t)return void s().ULS.shipAssertTag(595952728,o.nh.msoulscat_ES_EWAJS,!1,"CCP iframe onload event: the CCP iframe does not have a matching deferred promise to notify subscribers when the iframe loaded");const r=t.id;try{Ta().deferredPromise=void 0;const a=e.target;if(!a){const e=`CCP iframe onload event: the CCP iframe should exist when its onload event is called. Rejecting deferred promise id '${r}'`;return s().ULS.shipAssertTag(595952729,o.nh.msoulscat_ES_EWAJS,!1,e),void t.reject(new T(e))}if(!a.contentWindow){const e=`CCP iframe onload event: the contentWindow of the CCP iframe does not exist. Rejecting deferred promise id '${r}'`;return s().ULS.shipAssertTag(595952730,o.nh.msoulscat_ES_EWAJS,!1,e),void t.reject(new T(e))}s().ULS.traceTag(595952732,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`CCP iframe onload event: resolving deferred promise id '${r}' with the iframe`),t.resolve(a)}catch(e){const a=`iframeOnLoad: an error has occurred: [${o.Wp.getStringifiedError(e)}]. Rejecting deferred promise id '${r}'`;s().ULS.traceTag(595952733,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,a),t.reject(new T(a,e))}}(e))),e.src=Ta().src,e}(),document.getElementsByTagName("body")[0].appendChild(e)}catch(e){const t=`ensureIframeWindow: unable to create and/or add a CCP iframe. Dropping tentative deferred promise id '${r}'`;return s().ULS.traceTag(596453588,o.nh.msoulscat_ES_EWAJS,o.kp.Error,t),_a.deferredPromise=void 0,Ia(),Promise.reject(new T(t,e))}return t&&!t.fulfilled()?t.promise:(Ia(),e.contentWindow?(_a.deferredPromise=void 0,Promise.resolve(e)):(s().ULS.shipAssertTag(596453589,o.nh.msoulscat_ES_EWAJS,!1,`ensureIframeWindow: the iframe's content window should exist. Deferred promise id = '${r}'`),Promise.reject(new T(`ensureIframeWindow: the iframe's content window should exist. Deferred promise id = '${r}'`))))}let Pa,La;function Da(){if(La)return La.promise;La=tt(Ve());try{const e=va(Pe().origin);Pa=function(e,t){return new ha(function(e){if(!e)throw new w(l,"validator");return{serialize:t=>function(e,t){if(!e)throw new w(l,"outgoingMessage");if(!t)throw new w(l,"validator");return t(e),function(e){let t;try{t=JSON.stringify(e)}catch(t){throw new _("Serialization failed","outgoingMessage",`${Object.keys(e).length} properties`,t)}return s().ULS.traceTag(596452375,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`The length of the serialized message is ${t.length}`),t}(e)}(t,e)}}(qe),function(e){if(!e)throw new w(l,"validator");return{deserialize:t=>function(e,t){if(!e)throw new w(l,"incomingMessage");if(!t)throw new w(l,"validator");if(0===e.length)throw new _("An empty message is invalid","incomingMessage");const r=e.trim();if(0===r.length)throw new _("A message cannot contain only spaces","incomingMessage");let a;try{a=JSON.parse(r)}catch(t){throw new _("Deserialization failed","incomingMessage",`Contains ${e.length.toString()} characters`,t)}if(!a)throw new _("Deserialization returned nothing","incomingMessage");return t(a),a}(t,e)}}(Ye),{window:void 0,windowOrigin:e})}(e),o.Wp.retry(((e,t)=>function(e,t){if(!Pa){const e="clipboardIframeLoader::initializeIframe - windowRPCClient should be defined";return s().ULS.shipAssertTag(595947544,o.nh.msoulscat_ES_EWAJS,!1,e),Promise.reject(new T(e))}const r=o.TZ.start(`Iframe_initialize_${e}`);o.TZ.mark(r,"start"),Pa.remoteWindow.window=void 0;const a=a=>{const i=f(a,m.IframeInitializationTimeout)?` due to a timeout of approx. ${t} ms`:l;o.TZ.mark(r,"finish_error"),o.TZ.failure(r,(e=>s().ULS.traceTag(596452419,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,e)),`Attempt #${e} failed to initialize an iframe ${i}. ${e<3?"Retrying...":"No more retries!"}. Error: ${o.Wp.getStringifiedError(a)}`)},i=tt();return Aa().then((i=>{if(o.TZ.mark(r,"iframe_loaded"),o.TZ.mark(r,"iframe_waiting_for_idb_init"),!Pa){const e="clipboardIframeLoader::initializeIframe - windowRPCClient should be defined";s().ULS.shipAssertTag(595947545,o.nh.msoulscat_ES_EWAJS,!1,e);const t=new T(e);return a(t),Promise.reject(t)}if(!i.contentWindow){const e="clipboardIframeLoader::initializeIframe - remoteWindow.contentWindow should be defined";s().ULS.shipAssertTag(595903557,o.nh.msoulscat_ES_EWAJS,!1,e);const t=new T(e);return a(t),Promise.reject(t)}return Pa.remoteWindow.window=i.contentWindow,Pa.init(t).then((()=>(o.TZ.mark(r,"iframe_idb_init_complete"),o.TZ.mark(r,"finish"),o.TZ.success(r,(e=>s().ULS.traceTag(596452418,o.nh.msoulscat_ES_EWAJS,o.kp.Info,e)),`Attempt #${e} initialized iframe`),Promise.resolve())))})).then((()=>{i.resolve()}),(e=>{a(e),i.reject(e)})),i.promise}(e,2e4+(f(t,m.IframeInitializationTimeout)?5e3:0)*(e-1))),3).then((()=>{La.resolve(Pa)}),(e=>{La.reject(e)}))}catch(e){La.reject(e)}return La.promise}class xa{innerInitialize(){return Da().then((e=>(this.initialized=!0,this.windowRPCClient=e,this)))}registerPushMessageListener(e,t){this.windowRPCClient&&this.windowRPCClient.registerPushMessageListener(e,t)}postMessage(e,t){if(!this.initialized)return Promise.reject(new M(m.IframeInitialization));const r=o.TZ.start(`BaseIframeProxy_${t}`);o.TZ.mark(r,"start");const a=e=>(o.TZ.mark(r,"finish_error"),o.TZ.failure(r,(e=>s().ULS.traceTag(596452188,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,e)),`Failed in BaseIframeProxy.postMessage. Error: ${o.Wp.getStringifiedError(e)}`),Promise.reject(new M(m.IframeProxyGeneralError,"Failed in BaseIframeProxy.postMessage",e)));if(!this.windowRPCClient){const e="BaseIframeProxy.postMessage - this.windowRPCClient should be defined";return s().ULS.shipAssertTag(595944461,o.nh.msoulscat_ES_EWAJS,!1,e),a(new T(e))}return this.windowRPCClient.postMessage(e).then((e=>(s().ULS.shipAssertTag(595944462,o.nh.msoulscat_ES_EWAJS,!!e,"BaseIframeProxy.postMessage: postMessage must have returned a result message"),e?e.failed?Promise.reject(new M(m.IframeProxyGeneralError,`BaseIframeProxy.postMessage: the operation failed. Error: ${e.error}`)):(o.TZ.mark(r,"finish"),o.TZ.success(r,(e=>s().ULS.traceTag(596452187,o.nh.msoulscat_ES_EWAJS,o.kp.Info,e))),Promise.resolve(e)):Promise.reject(new M(m.IframeProxyEmptyResultMessage,"BaseIframeProxy.postMessage: postMessage succeeded but returned nothing"))))).catch((e=>a(e)))}constructor(){this.initialized=!1}}class Ma{initialize(e){return new vt(this.localStorageKey,e,(e=>{this._onMetadataChangedListener&&this._onMetadataChangedListener(e)})),Promise.resolve()}setOnMetadataChangedListener(e){s().ULS.traceTag(595716297,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"LocalStorageKeyTrackerMetadataWatcher.setOnMetadataChangedListener: start setOnMetadataChangedListener"),s().ULS.shipAssertTag(595716298,o.nh.msoulscat_ES_EWAJS,!!e,"LocalStorageKeyTrackerMetadataWatcher.setOnMetadataChangedListener: expect listener to be defined."),this._onMetadataChangedListener=e}constructor(e){this.localStorageKey=e}}class ka extends xa{initialize(e){return super.innerInitialize().then((()=>{this.registerPushMessageListener("getMetadata_longPollingresult",(e=>{this._onMetadataChangedListener&&this._onMetadataChangedListener(se(e))}))}))}setOnMetadataChangedListener(e){s().ULS.traceTag(595730647,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"LongPollingMetadataWatcher.setOnMetadataChangedListener: start setOnMetadataChangedListener"),s().ULS.shipAssertTag(595944466,o.nh.msoulscat_ES_EWAJS,!!e,"LongPollingMetadataWatcher.setOnMetadataChangedListener: expect listener to be defined."),this._onMetadataChangedListener=e}}class Wa extends Qe{constructor(e){super(d.SystemClipboard,{browserStorage:!1,systemClipboard:!0,inMemory:!1},e)}}let $a=!0;function Ra(){return $a}function Oa(){$a=!1}let Ua=!0;function Fa(){return Ua}function Na(){Ua=!1}function Ja(){let e;try{e=window.clipboardData}catch(e){s().ULS.traceTag(595985225,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`ieSystemClipboard.getDataTransfer: An error occurred when attempting to access window.clipboardData. Error: ${o.Wp.getStringifiedError(e)}`)}return e}function za(){if(s().ULS.shipAssertTag(596455701,o.nh.msoulscat_ES_EWAJS,J(),"The browser must be IE"),!J())throw new T("The browser must be IE")}function ja(e){return!!e}function Ha(e){if(!e)return void s().ULS.traceTag(596456320,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"A clipboard event parameter is missing");let t;try{t=e.clipboardData}catch(e){throw s().ULS.traceTag(595985224,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`systemClipboard.getDataTransfer: An error occurred when attempting to access rawEvent.clipboardData. Error: ${o.Wp.getStringifiedError(e)}`),e}return t}function Va(e,t,r,a){let i=!1;try{const a=Ha(r);if(!a||!ja(a))return s().ULS.traceTag(596456264,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`setData - programmatic ${H} and ${V} is broken. There is no valid data transfer object. clipboardDataFormat = '${e}'`),!1;i=a.setData(e,t),!1===i&&s().ULS.traceTag(596456265,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`setData returned false for '${e}'.`)}catch(t){s().ULS.traceTag(596456266,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`setData with '${e}' threw an exception: ${o.Wp.getStringifiedError(t)}`)}return void 0===i&&(i=!0),i}function Ba(e,t,r,a){if(za(),!a&&!Ra()&&!Fa())return s().ULS.traceTag(596456269,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`setData - programmatic ${H} and ${V} clipboard access is not supported. rawEvent is empty = ${!!r}`),!1;const i=Ja();if(!i||!ja(i))return s().ULS.traceTag(596456270,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`setData - ${H} and ${V} is broken. There is no valid global data transfer object. Do not try again to fetch it. clipboardDataFormat = '${e}'`),a||(s().ULS.shipAssertTag(596456271,o.nh.msoulscat_ES_EWAJS,Ra()&&Fa(),`setData - programmatic ${H} and ${V} is broken because the global data transfer object was previously available and now it's not available. isBeforeFirstProgrammaticAccess = '${Ra()}'. isProgrammaticAccessSupported = '${Fa()}'. clipboardDataFormat = '${e}'`),Oa(),Na()),!1;let n,l=e;l===Z&&(l=Y);try{n=i.setData(l,t),!1===n&&s().ULS.traceTag(596456272,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`setData returned false for '${l}'.`)}catch(e){s().ULS.traceTag(596456273,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`setData with '${l}' threw an exception: ${e.message}`)}return!a&&Ra()&&(Oa(),!1===n&&Na()),void 0===n&&(n=!0),n}function Ga(){return Ra()&&Ba(Z,l,void 0,!1),!!Fa()||(s().ULS.traceTag(596456274,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`document.execCommand - programmatic clipboard access is not allowed for '${H}' and '${V}'.`),!1)}const Ka={execCommandCopy:function(){let e;try{e=document.execCommand(H,!1,null)}catch(e){s().ULS.traceTag(596456262,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`document.execCommand('${H}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return void 0===e&&(e=!0),e},execCommandCut:function(){let e;try{e=document.execCommand(V,!1,null)}catch(e){s().ULS.traceTag(596456263,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`document.execCommand('${V}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return void 0===e&&(e=!0),e},setData:Va,defaultClipboardDataFormat:Z},qa={execCommandCopy:function(){if(za(),!Ga())return!1;try{document.execCommand(H,!1,null)}catch(e){s().ULS.traceTag(596456267,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`document.execCommand('${H}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return!0},execCommandCut:function(){if(za(),!Ga())return!1;try{document.execCommand(V,!1,null)}catch(e){s().ULS.traceTag(596456268,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`document.execCommand('${V}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return!0},setData:Ba,defaultClipboardDataFormat:Y};let Za;function Ya(e,t,r,a){return Xa().setData(e,t,r,a)}function Xa(){return void 0===Za&&(Za=Ka),Za}J()&&(Za=qa);const Qa="command",ei="getClipboardData",ti="getAvailableCommands";let ri;const ai={};function ii(){if(void 0===ri&&(ri=!1,"chrome"in window)){const e=window.chrome;e&&("runtime"in e&&e.runtime?"sendMessage"in e.runtime&&e.runtime.sendMessage?ri=!0:s().ULS.traceTag(596455703,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,"chrome.runtime.sendMessage is not available"):s().ULS.traceTag(596455704,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"chrome.runtime is not available"))}return ri}function oi(e){if(!e||!e.items)return Promise.reject(new x(g.ClipboardIsInaccessible,`getImageDataUrlFromClipboardData: clipboardData is undefined=${!e} clipboardData.items is undefined=${!e.items}`));for(let t=0;t<e.items.length;t+=1){const r=e.items[t].type&&e.items[t].type.startsWith("image");if(r||s().ULS.traceTag(528859143,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"Non-image type read from System Clipboard. File Type is "+e.items[t].type),"file"===e.items[t].kind&&r)return ni(e.items[t].getAsFile())}return Promise.resolve(l)}function ni(e){const t=o.TZ.start("ImageFile_Read_From_Clipboard"),r=e?e.size:-1,a=tt(),i=new FileReader;return i.onload=()=>{i.result?(o.TZ.success(t,(e=>s().ULS.traceTag(595911452,o.nh.msoulscat_ES_EWAJS,o.kp.Info,si(e,r)))),a.resolve(i.result.toString())):(o.TZ.failure(t,(e=>s().ULS.traceTag(595911453,o.nh.msoulscat_ES_EWAJS,o.kp.Info,si(e,r)))),a.reject(new x(g.FileReaderResultIsEmpty,"getImageDataUrlFromClipboardData: FileReader result is null or undefined")))},i.onerror=()=>{o.TZ.failure(t,(e=>s().ULS.traceTag(595911454,o.nh.msoulscat_ES_EWAJS,o.kp.Info,si(e,r)))),a.reject(new x(g.FileReaderFailed,"getImageDataUrlFromClipboardData: FileReader failed"))},o.TZ.mark(t,"Starting_readAsDataURL"),i.readAsDataURL(e),a.promise}function si(e,t){const r=JSON.parse(e);return r.filesize=t,JSON.stringify(r)}function li(e,t,r){if(za(),!r&&!Ra()&&!Fa())return s().ULS.traceTag(596456327,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`getData - programmatic ${B} clipboard access is not supported. rawEvent is empty = ${!!t}`),Promise.resolve(l);const a=Ja();if(!a||!ja(a))return s().ULS.traceTag(596456328,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`getData - ${B} is broken. There is no valid global data transfer object. Do not try again to fetch it. clipboardDataFormat = '${e}'`),r||(s().ULS.shipAssertTag(596456329,o.nh.msoulscat_ES_EWAJS,Ra()&&Fa(),`getData - programmatic ${B} is broken because the global data transfer object was previously available and now it's not available. isBeforeFirstProgrammaticAccess = '${Ra()}'. isProgrammaticAccessSupported = '${Fa()}'. clipboardDataFormat = '${e}'`),Oa(),Na()),Promise.resolve(l);let i=e;i===Z&&(i=Y);let n=l;try{n=a.getData(i),n||(n=l),s().ULS.traceTag(596456330,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`getData('${i}') returned ${n.length} characters`)}catch(e){s().ULS.traceTag(596456331,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`getData with '${i}' threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}if(!r&&Ra()&&(Oa(),n===l)){if(Va(e," ",void 0))return li(e,void 0,!1).then((t=>(t===l?Na():Va(e,l,void 0),Promise.resolve(n))));Na()}return Promise.resolve(n)}const ci={init:function(){},execCommandPaste:function(){let e;try{e=document.execCommand(B,!1,null)}catch(e){s().ULS.traceTag(596456322,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`document.execCommand('${B}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return void 0===e&&(e=!0),e},getData:function(e,t,r){let a=l;try{const r=Ha(t);if(!r||!ja(r))return Promise.resolve(a);if(e===Q)return oi(r);a=r.getData(e),a||(a=l),s().ULS.traceTag(596456323,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`getData('${e}') returned ${a.length} characters`)}catch(t){s().ULS.traceTag(596456324,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`getData with '${e}' threw an exception. This is a browser bug. Ignoring. Exception:: ${o.Wp.getStringifiedError(t)}`)}return Promise.resolve(a)},browserExtensionPaste:function(){return Promise.reject(new M(m.NoBrowserExtensionsInConfiguration))}},di={init:function(){},execCommandPaste:function(){if(za(),Ra()&&li(Z,void 0,!1),!Fa())return s().ULS.traceTag(596456325,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`document.execCommand - programmatic clipboard '${B}' access is not allowed in this session.`),!1;try{document.execCommand(B,!1,null)}catch(e){s().ULS.traceTag(596456326,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`document.execCommand('${B}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return!0},getData:li,browserExtensionPaste:function(){return Promise.reject(new M(m.NoBrowserExtensionsInConfiguration))}},pi={init:function(){!function(){const e=Xi().getChromeExtensionIds();if(0===e.length)return;const t={};t[Qa]=ti,e.forEach((e=>{window.chrome.runtime.sendMessage(e,t,void 0,(t=>{const r=window.chrome.runtime.lastError;if(t&&Array.isArray(t)&&0!==t.length&&!r)ai[e]=t;else{let t=l;r&&"message"in r&&"string"==typeof r.message&&(t=r.message),s().ULS.traceTag(589947074,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`chromeSystemClipboard - '${ti}': browser extension '${e}' is not available. Error: ${t}`)}}))}))}()},execCommandPaste:function(){let e=!1;try{e=document.execCommand(B,!1,null),void 0===e&&(e=!0)}catch(e){s().ULS.traceTag(596455698,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Chrome: document.execCommand('${B}') threw an exception. This is a browser bug. Ignoring. Exception: ${e.message}`)}return e},getData:function(e,t,r){let a=l;try{const r=Ha(t);if(!r||!ja(r))return Promise.resolve(a);if(e===Q)return oi(r);a=r.getData(e),a||(a=l),s().ULS.traceTag(596455699,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Chrome: getData('${e}') returned ${a.length} characters`)}catch(t){s().ULS.traceTag(596455700,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`Chrome: getData with '${e}' threw an exception. This is a browser bug. Ignoring. Exception:: ${o.Wp.getStringifiedError(t)}`)}return Promise.resolve(a)},browserExtensionPaste:function(){return function(){if(!ii())return Promise.reject(new M(m.MissingBrowserExtensionCapability));const e=function(){for(const e in ai)if(ai[e].includes(ei))return e;return null}();if(!e)return Promise.reject(new M(m.NoBrowserExtensionWithGetClipboardDataCommand));const t={};return t[Qa]="getClipboardData",function(e,t){return new Promise(((r,a)=>{let i=!0;window.chrome.runtime.sendMessage(e,t,void 0,(t=>{const o=window.chrome.runtime.lastError;if(!t||"object"!=typeof t||Array.isArray(t)||o){i=!1;let t=l;o&&"message"in o&&"string"==typeof o.message&&(t=o.message),a(new M(m.UnavailableBrowserExtension,`chromeSystemClipboard - '${ei}': browser extension '${e}' is not available. Error: ${t}`))}else{i=!1;const e=t,a=e.html,o=e.img,n=e.text,s=function(e,t,r){const a=!!e,i=!!t,o=!!r,n=e.includes("<img src=");return i&&!o||i&&a&&n}(a,o,n);r({text:n,html:s?o:a})}})),setTimeout((()=>{i&&(s().ULS.traceTag(589947076,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`chromeSystemClipboard - getPasteWithExtensionPromise reject the promise after timeout. chromeExtenstionsInfo: '${ai}'`),a(new M(m.UnavailableBrowserExtension,`chromeSystemClipboard - '${ei}': browser extension '${e}' is not available. Timeout after : 2000 ms`)))}),2e3)}))}(e,t).then((t=>{if(!t)return Promise.reject(new M(m.NoAvailableBrowserExtensions));s().ULS.traceTag(589947075,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`chromeSystemClipboard - paste by browser extension '${e}'`);const r=se();return r.setItem(Z,t.text),r.setItem(X,t.html),r.setItem("metadata/chrome-extension-id",e),r}))}()}};let mi;function ui(){return void 0===mi&&(mi=ii()?pi:ci),mi}J()&&(mi=di);const gi=(e,t)=>{if(fi(e))e.replaceChildren(t);else{for(;e.firstChild;)e.removeChild(e.firstChild);hi(e,t)}},hi=(e,t)=>{if(Si(e))e.append(t);else if("string"==typeof t){const r=document.createTextNode(t);e.appendChild(r)}else e.appendChild(t)},fi=e=>!!e.replaceChildren,Si=e=>!!e.append,bi="ccpContentEditable";function yi(){const e=document.getSelection();if(e&&e.getRangeAt&&"function"==typeof e.getRangeAt&&!(e.rangeCount<1))return e.getRangeAt(0)}function Ci(e,t,r=void 0){s().ULS.shipAssertTag(596444114,o.nh.msoulscat_ES_EWAJS,!1===t&&!r||!0===t&&(!!r||r===l),`enableClipboardEvents: useTextHtmlContentCandidate = '${t}', textHtmlContentCandidate is ${r||r===l?l:"not "}provided`);let a=document.activeElement&&document.activeElement.id;a||s().ULS.traceTag(595719625,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,"hiddenContentEditableDiv.enableClipboardEvents: activeElementIdToRestore must to be define");const n=function(e,t){let r=_i();if(r&&r.tagName&&"div"!==r.tagName.toLowerCase()&&(r.parentElement&&r.parentElement.removeChild(r),r=void 0),r||(r=function(){const e=document.createElement("div");return function(e){e.id=bi,e.contentEditable="true",vi()&&(e.contentEditable="false"),e.spellcheck=!1,e.setAttribute("autocomplete","off"),e.setAttribute("autocorrect","off"),e.setAttribute("autocapitalize","off"),e.setAttribute("aria-hidden","true"),e.tabIndex=-1,e.style.display="inline-block",e.style.position="absolute",e.style.fontSize="10",e.style.height="0px",e.style.width="0px",e.style.top="0px",e.style.left="0px",e.style.zIndex="-100",e.style.overflow="hidden",e.onmousemove=()=>{e.onmousemove=null,s().ULS.assertTag(595957699,o.nh.msoulscat_ES_EWAJS,!1,`contentEditableElement.onmousemove: Mouse move event is not expected on element '${bi}'. it should be covered by other elements`)}}(e),document.body.appendChild(e),e}()),J()){let a=t;e?a||(a=l):a=Ii().outerHTML,r.innerHTML=i.sanitize(a)}else gi(r,e?t??l:Ii());return r}(t,r);a&&a===n.id&&(a=void 0),n.focus();const c=document.getSelection();if(c){c.removeAllRanges();const e=document.createRange();e.selectNodeContents(n),c.addRange(e)}return e&&Ei(!0),a}function Ei(e){if(!vi())return;const t=_i();t&&(t.contentEditable=e?"true":"false")}function wi(){const e=_i();if(!e)return!1;try{const t=e.clientLeft+e.scrollWidth/2,r=e.clientTop+e.scrollTop/2,a=document.elementFromPoint(t,r);return!!a&&(a.id===e.id||!!a.parentElement&&a.parentElement.id===e.id)}catch(e){return s().ULS.traceTag(595957534,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`isContentEditableElementVisibleToUser: hit test failed with error: ${o.Wp.getStringifiedError(e)}`),!1}}function _i(){return document.getElementById(bi)}function Ti(){const e=_i();e&&(J()?e.innerHTML=i.sanitize(Ii().outerHTML):gi(e,Ii()))}function Ii(){const e=document.createElement("span");return e.innerText=c,e}function vi(){return!J()}let Ai;const Pi=e=>{Ai=e},Li=(e,t=!1)=>Ai?Ai.getBooleanFeatureGate(e,t):t;class Di{get(e){if(this.disposableImplementationExtension.throwIfDisposed("get"),s().ULS.traceTag(596449096,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`SystemClipboardStorage.get: isKeyboardEvent = '${e.isKeyboardEvent}'`),e.skipSystemClipboardAccess){s().ULS.traceTag(596124883,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"SystemClipboardStorage.get: Skipping system clipboard access");const e=q(document,K,(t=>this.skipSystemClipboardPasteHandler(t,e)),!this.isFixTagSpike99teiEnabled||{capture:!0,once:!0});return this.removeLastPasteEventListenerCallback=e,Promise.resolve(ie())}if(this.lastDeferredPastePromise&&!this.lastDeferredPastePromise.fulfilled()){const e=this.lastDeferredPastePromise,t=`There exists a pending deferred promise with id '${e.id}', representing an active ${B} event. Scheduling a rejection to execute after the current operation.`;s().ULS.traceTag(596455680,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,t),window.setTimeout((()=>{e.reject(new M(m.RejectingPendingPastePromiseDueToNewPasteOperation,t))}),0)}this.clearPasteCallbackConfiguration(this.lastDeferredPastePromise,!0,!1);const t=tt();this.lastDeferredPastePromise=t;const r=t.id,a=q(document,K,(r=>this.pasteHandler(r,t,e.isKeyboardEvent,a)),!this.isFixTagSpike99teiEnabled||{capture:!0,once:!0});this.removeLastPasteEventListenerCallback=a,this.selectedRangeToRestore=yi(),this.activeElementIdToRestore=Ci(!0,!1);try{let a=!1;if(e.isKeyboardEvent||(a=ui().execCommandPaste()),e.isKeyboardEvent);else if(!a)return this.clearPasteCallbackConfiguration(t,!0,!0),e.isAsyncSystemClipboardEnabled?Promise.reject(new M(m.ClipboardIsInaccessible,`Reject the Promise if not keyboard event in SystemClipboardStorage.get. Deferred promise id = '${r}'`)):ui().browserExtensionPaste().then((t=>(e.isChromiumExtension=!0,e.clearSystemClipboard&&this.clearSystemClipboard(),t)),(t=>(!e.isAsyncSystemClipboardEnabled&&e.clearSystemClipboard&&this.clearSystemClipboard(),Promise.reject(new M(m.ClipboardIsInaccessible,`document.execCommand(${B}) failed in SystemClipboard.get. Deferred promise id = '${r}'`,t)))))}catch(e){return this.clearPasteCallbackConfiguration(t,!0,!1),Promise.reject(new M(m.GetClipboardItems,`Failed in SystemClipboard.get. Deferred promise id = '${r}'`,e))}return t.promise.then((t=>(e.clearSystemClipboard&&this.clearSystemClipboard(),t)),(t=>(e.clearSystemClipboard&&this.clearSystemClipboard(),f(t,m.RejectingPendingPastePromiseDueToNewPasteOperation)?Promise.reject(t):Promise.reject(new M(m.GetClipboardItems,`Failed in SystemClipboard.get. Deferred promise id = '${r}'`,t)))))}set(e,t){if(this.disposableImplementationExtension.throwIfDisposed("set"),s().ULS.traceTag(596449097,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`SystemClipboardStorage.set: isKeyboardEvent = '${t.isKeyboardEvent}'; cutCopyPasteFlags = '${t.commandType}'`),s().ULS.shipAssertTag(595932513,o.nh.msoulscat_ES_EWAJS,!t.skipSystemClipboardAccess,"SystemClipboardStorage.set: skipSystemClipboardAccess shouldn't be used using set of SystemClipboardStorage as we have to set the timestamp metadata in the html in order to support last copy item scenario. "),J()&&!t.isKeyboardEvent){if(t.silentClipboardAccessFailures&&Ra())return s().ULS.traceTag(596455681,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"Aborting attempt to store content in the clipboard since silentClipboardAccessFailures is on and the user did not select Allow access in IE's clipboard access dialog"),Promise.resolve();if(!Ra()&&!Fa())return s().ULS.traceTag(596455682,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"Aborting attempt to store content in the clipboard since the user selected Dont Allow in IE's clipboard access dialog. Use the active selection."),Promise.resolve()}if(this.lastDeferredCutCopyPromise&&!this.lastDeferredCutCopyPromise.fulfilled()){const e=this.lastDeferredCutCopyPromise,r=`There exists a pending deferred promise with id '${e.id}', representing an active ${V}/${H} event. Scheduling a rejection to execute after the current operation.`;s().ULS.traceTag(596455683,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,r),window.setTimeout((()=>{e.reject(new M(t.isKeyboardEvent?m.RejectingPendingCutCopyPromiseDueToNewCutCopyOperation:m.RejectingBlockedSyncCutCopyPromise,r))}),0)}this.clearCutCopyCallbackConfiguration(this.lastDeferredCutCopyPromise,!0,!1);const r=tt();this.lastDeferredCutCopyPromise=r;const a=r.id;try{const i=me(e),n=Di.getClipboardCutCopyEventType(t.commandType),c=q(document,n,(e=>{t.isTimestampStoredInSystemClipboard=!0,this.cutCopyHandler(e,r,i,t.isKeyboardEvent,t.commandType,c)}),this.isFixTagSpike99teiEnabled&&{capture:!1,once:!0});this.removeLastCutCopyEventListenerCallback=c;let d=l;J()&&(d=de(i,X)),this.selectedRangeToRestore=yi(),this.activeElementIdToRestore=Ci(!1,!!d,d);let p=!1;if(J()&&t.isKeyboardEvent||(p=t.commandType===fe.Cut?Xa().execCommandCut():Xa().execCommandCopy()),t.isKeyboardEvent);else if(!p)return this.clearCutCopyCallbackConfiguration(r,!0,!0),!J()||Ra()||Fa()||(s().ULS.traceTag(596455684,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Aborting attempt to store content in the clipboard since the user selected Dont Allow in IE's clipboard access dialog. Use the active selection. Deferred promise id = '${a}'`),r.resolve()),Promise.resolve()}catch(e){return this.clearCutCopyCallbackConfiguration(r,!0,!1),Promise.reject(new M(m.SetClipboardItems,`Failed in SystemClipboard.set. Deferred promise id = '${a}'`,e))}return r.promise.catch((e=>e&&S(e,[m.RejectingPendingCutCopyPromiseDueToNewCutCopyOperation,m.RejectingBlockedSyncCutCopyPromise])?Promise.reject(e):Promise.reject(new M(m.SetClipboardItems,`Failed in SystemClipboard.set. Deferred promise id = '${a}'`,e))))}getSupportedDataFormats(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[Z,X,Q]}cutCopyHandler(e,t,r,a,i,n){try{if(s().ULS.traceTag(596449098,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`SystemClipboardStorage.cutCopyHandler: isKeyboardEvent = '${a}'; cutCopyPasteFlags = '${i}'; bubbles = '${e.bubbles}'; eventPhase = '${e.eventPhase}'`),n(),this.removeLastCutCopyEventListenerCallback===n&&(this.removeLastCutCopyEventListenerCallback=void 0),this.disposableImplementationExtension.logIfDisposed("cutCopyHandler"))return;if(s().ULS.shipAssertTag(596455686,o.nh.msoulscat_ES_EWAJS,!!t,`SystemClipboardStorage.cutCopyHandler: the deferred promise parameter is missing. isKeyboardEvent = '${a}'; cutCopyPasteFlags = '${i}'`),!t)return;if(s().ULS.traceTag(596455687,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`SystemClipboardStorage.cutCopyHandler: isKeyboardEvent = '${a}'; cutCopyPasteFlags = '${i}'; deferred promise id = '${t.id}'`),s().ULS.shipAssertTag(596455688,o.nh.msoulscat_ES_EWAJS,!t.fulfilled(),`SystemClipboardStorage.cutCopyHandler: deferred promise '${t.id}' is already fulfilled. isKeyboardEvent = '${a}'; cutCopyPasteFlags = '${i}'`),t.fulfilled())return;const l=()=>{t.resolve(),this.clearCutCopyCallbackConfiguration(t,!1,!1)},c=de(r,X);if(c&&J())window.setTimeout(l,0);else{c&&Ya(X,c,e,a);const t=pe(r);Ya(Xa().defaultClipboardDataFormat,t,e,a),e.preventDefault(),l()}}catch(e){this.clearCutCopyCallbackConfiguration(t,!1,!1),s().ULS.traceTag(596455689,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`SystemClipboardStorage.cutCopyHandler callback with deferred promise id '${t?t.id:l}' (fulfilled = '${t?t.fulfilled():l}') failed with this exception: ${e&&e.message?e.message:"NA"}. Call stack: ${e.stack?e.stack:"NA"}`),t&&t.reject(new M(m.SetClipboardItems,`Failed in SystemClipboard.set > cutCopyHandler callback. Deferred promise id = '${t.id}'. Error: ${e&&e.message?e.message:"NA"}`,e))}}pasteHandler(e,t,r,a){let n=!0;try{if(s().ULS.traceTag(596449099,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`SystemClipboardStorage.pasteHandler: isKeyboardEvent = '${r}'; eventPhase='${e.eventPhase}'`),e.preventDefault(),a(),this.removeLastPasteEventListenerCallback===a&&(this.removeLastPasteEventListenerCallback=void 0),this.disposableImplementationExtension.logIfDisposed("pasteHandler"))return;if(s().ULS.shipAssertTag(596455690,o.nh.msoulscat_ES_EWAJS,!!t,`SystemClipboardStorage.pasteHandler: the deferred promise parameter is missing. isKeyboardEvent = '${r}'`),!t)return;if(s().ULS.traceTag(596455691,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`SystemClipboardStorage.pasteHandler: isKeyboardEvent = '${r}'; deferred promise id = '${t.id}'`),s().ULS.shipAssertTag(596455692,o.nh.msoulscat_ES_EWAJS,!t.fulfilled(),`SystemClipboardStorage.pasteHandler: deferred promise '${t.id}' is already fulfilled. isKeyboardEvent = '${r}'`),t.fulfilled())return;const c=se(),d=this.getSupportedDataFormats(),p=this.readDataFormats(d,e,r,c);Promise.all(p).then((()=>{e.stopPropagation(),n=!1,J()?window.setTimeout((()=>{const e=document.getElementById(bi);if(e&&e.firstChild&&"IMG"===e.firstChild.nodeName){const t=e.firstChild;t&&t.src&&t.src.indexOf("base64")>-1?c.setItem(Q,t.src):s().ULS.traceTag(595907107,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"SystemClipboardStorage.pasteHandler: IE has provided the IMG HTML rather than the image blob, which is unsupported.")}else c.setItem(X,function(){const e=_i();return s().ULS.shipAssertTag(596444113,o.nh.msoulscat_ES_EWAJS,!!e,"getTextHtmlContent: the content editable element does not exist"),e?i.sanitize(e.innerHTML):l}()),(r=e)&&r.firstChild&&r.firstElementChild&&r.firstElementChild.getAttribute(Vr)&&c.setItem(Z,function(e){const t=[],r=e.getElementsByTagName("tr");if(r.length>0){const e=qr(r[0]);t.push(e);for(let e=1;e<r.length;e+=1){t.push(kr),t.push(Mr);const a=qr(r[e]);t.push(a)}}return t.join("")}(e));var r;Ti(),t.resolve(c),this.clearPasteCallbackConfiguration(t,!1,!1)}),0):(Ti(),t.resolve(c),this.clearPasteCallbackConfiguration(t,!1,!1))}))}catch(r){Ti();try{n&&e.stopPropagation()}catch(e){s().ULS.traceTag(595985030,o.nh.msoulscat_ES_EWAJS,o.kp.Error,`SystemClipboardStorage.pasteHandler: failed when performing stopPropagation/preventDefault on the raw event. Failed with an exception: ${o.Wp.getStringifiedError(e)}`)}this.clearPasteCallbackConfiguration(t,!1,!1),s().ULS.traceTag(596455693,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`SystemClipboardStorage.pasteHandler callback with deferred promise id '${t?t.id:l}' (fulfilled = '${t?t.fulfilled():l}') failed with an exception: ${r&&r.message?r.message:"NA"}. Call stack: ${r.stack?r.stack:"NA"}`),t&&t.reject(new M(m.GetClipboardItems,`Failed in SystemClipboard.get > pasteHandler callback. Deferred promise id = '${t.id}'. Error: ${r&&r.message?r.message:"NA"}`,r))}}isFileFormat(e){return e===Q}isPlainTextEmpty(e){const t=e.getItem("text/plain");return!t||0===t.length}readDataFormats(e,t,r,a){if(!this.skipFilesIfPlainTextExists||!r&&function(){const e=W();let t=!1;if(e&&e.userAgent){const r=e.userAgent();r&&r.indexOf("Edg/")>=0&&(t=!0)}return t}())return this.readDataFormatsInternal(e,t,r,a);const i=e.filter((e=>this.isFileFormat(e)));if(0===i.length)return this.readDataFormatsInternal(e,t,r,a);const n=e.filter((e=>!this.isFileFormat(e))),l=this.readDataFormatsInternal(n,t,r,a);return[Promise.all(l).then((()=>{if(!this.isPlainTextEmpty(a))return s().ULS.traceTag(595653317,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"SystemClipboardStorage.readDataFormats: skip files loading because clipboard contains plain text"),Promise.resolve();const e=this.readDataFormatsInternal(i,t,r,a);return Promise.all(e)}))]}readDataFormatsInternal(e,t,r,a){const i=[];return e.forEach((e=>{i.push(function(e,t,r){return ui().getData(e,t,r)}(e,t,r).then((t=>{s().ULS.traceTag(541646989,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"SystemClipboardStorage.readDataFormatsInternal: Read "+e+" from clipboard"),a.setItem(e,t)})).catch((t=>{s().ULS.traceTag(595653318,o.nh.msoulscat_ES_EWAJS,o.kp.Error,`SystemClipboardStorage.readDataFormatsInternal: Failed to get data of type [${e}]. Error [${o.Wp.getStringifiedError(t)}]`)})))})),i}skipSystemClipboardPasteHandler(e,t){try{t(),e.stopPropagation(),e.preventDefault()}catch(e){s().ULS.traceTag(595993058,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`SystemClipboardStorage.skipSystemClipboardPasteHandler: failed with an exception: ${e&&e.message?e.message:"NA"}. Call stack: ${e.stack?e.stack:"NA"}`)}this.removeLastPasteEventListenerCallback===t&&(this.removeLastPasteEventListenerCallback=void 0)}hasPlainText(e){return!!e&&Object.keys(e.getData().items).indexOf(Z)>-1}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(k([()=>{this.lastDeferredCutCopyPromise&&!this.lastDeferredCutCopyPromise.fulfilled()&&(this.lastDeferredCutCopyPromise.reject(),this.lastDeferredCutCopyPromise=void 0,this.removeLastCutCopyEventListenerCallback&&(this.removeLastCutCopyEventListenerCallback(),this.removeLastCutCopyEventListenerCallback=void 0))},()=>{this.lastDeferredPastePromise&&!this.lastDeferredPastePromise.fulfilled()&&(this.lastDeferredPastePromise.reject(),this.lastDeferredPastePromise=void 0,this.removeLastPasteEventListenerCallback&&(this.removeLastPasteEventListenerCallback(),this.removeLastPasteEventListenerCallback=void 0))}]),this.disposableImplementationExtension.dispose())}static getClipboardCutCopyEventType(e){if(!e)return G;if(e===fe.Copy)return G;if(e===fe.Cut)return"cut";throw new _(l,"cutCopyPasteFlags",e.toString())}restoreFocusToPreviouslyActiveElement(){if(!this.activeElementIdToRestore)return;const e=document.getElementById(this.activeElementIdToRestore);e&&e.focus(),this.activeElementIdToRestore=void 0}restoreSelection(){this.selectedRangeToRestore&&(function(e){if(!e)return;const t=document.getSelection();t&&t.removeAllRanges&&"function"==typeof t.removeAllRanges&&t.addRange&&"function"==typeof t.addRange&&(t.removeAllRanges(),t.addRange(e))}(this.selectedRangeToRestore),this.selectedRangeToRestore=void 0)}clearCutCopyCallbackConfiguration(e,t,r){this.restoreFocusToPreviouslyActiveElement(),this.restoreSelection(),s().ULS.shipAssertTag(595957697,o.nh.msoulscat_ES_EWAJS,!wi(),"SystemClipboardStorage.set: ccpContentEditable is visible to the user during a copy/cut operation, but it should not be visible."),(e===this.lastDeferredCutCopyPromise||e&&this.lastDeferredCutCopyPromise&&e.id===this.lastDeferredCutCopyPromise.id)&&(this.lastDeferredCutCopyPromise=void 0),t&&this.removeLastCutCopyEventListenerCallback&&(r||s().ULS.traceTag(596449290,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`SystemClipboardStorage.set: the ${V}/${H} event listener was not called. Calling removeLastCutCopyEventListenerCallback()`),this.removeLastCutCopyEventListenerCallback(),this.removeLastCutCopyEventListenerCallback=void 0)}clearPasteCallbackConfiguration(e,t,r){this.restoreFocusToPreviouslyActiveElement(),this.restoreSelection(),Ei(!1),s().ULS.shipAssertTag(595957698,o.nh.msoulscat_ES_EWAJS,!wi(),"SystemClipboardStorage.clearPasteCallbackConfiguration: ccpContentEditable is visible to the user during a paste operation, but it should not be visible"),(e===this.lastDeferredPastePromise||e&&this.lastDeferredPastePromise&&e.id===this.lastDeferredPastePromise.id)&&(this.lastDeferredPastePromise=void 0),t&&this.removeLastPasteEventListenerCallback&&(r||s().ULS.traceTag(596449291,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`SystemClipboardStorage.get: the ${B} event listener was not called. Calling removeLastPasteEventListenerCallback()`),this.removeLastPasteEventListenerCallback(),this.removeLastPasteEventListenerCallback=void 0)}clearSystemClipboard(){const e=ie(),t={isKeyboardEvent:!1,commandType:fe.Copy};this.set(e,t).then((()=>{s().ULS.traceTag(595935906,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"SystemClipboardStorage.clearSystemClipboard: clear system clipboard succeed")}),(()=>{s().ULS.traceTag(595935907,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"SystemClipboardStorage.clearSystemClipboard: clear system clipboard failed")}))}constructor(e){this.lastDeferredCutCopyPromise=void 0,this.removeLastCutCopyEventListenerCallback=void 0,this.lastDeferredPastePromise=void 0,this.selectedRangeToRestore=void 0,this.removeLastPasteEventListenerCallback=void 0,this.activeElementIdToRestore=void 0,this.skipFilesIfPlainTextExists=e,this.clipboardStorageType=ge.SystemClipboard,this.disposableImplementationExtension=Xe("SystemClipboardStorage"),ui().init(),this.isFixTagSpike99teiEnabled=Li("Microsoft.Office.Excel.FixTagSpike99tei",!1)}}class xi extends Qe{constructor(e){super(d.InMemory,{browserStorage:!1,systemClipboard:!1,inMemory:!0},e)}}class Mi{dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(this.inMemoryClipboardItems=void 0,this.disposableImplementationExtension.dispose())}get(e){return this.disposableImplementationExtension.throwIfDisposed("get"),this.inMemoryClipboardItems?Promise.resolve(this.inMemoryClipboardItems):Promise.resolve(ie())}set(e,t){return this.disposableImplementationExtension.throwIfDisposed("set"),this.inMemoryClipboardItems=e,Promise.resolve()}getSupportedDataFormats(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[Z,X,"data/shadow-workbook"]}constructor(){this.clipboardStorageType=ge.InMemory,this.disposableImplementationExtension=Xe("InMemoryClipboardStorage")}}class ki extends Qe{constructor(e){super(d.LocalStorage,{browserStorage:!0,systemClipboard:!1,inMemory:!1},e)}}class Wi{initialize(e,t){return this.initialized=!1,this.systemClipboardStrategy=void 0,this.fullAccessClipboardStrategy=void 0,e.then((e=>(this.systemClipboardStrategy=e,t.then((e=>(this.fullAccessClipboardStrategy=e,this.initialized=!0,Promise.resolve(this)))))))}set(e,t){try{if(this.disposableImplementationExtension.throwIfDisposed("set"),!this.initialized||!this.systemClipboardStrategy)return Promise.reject(new M(m.ClipboardStrategyNotInitialized));const r={systemClipboardOperationResult:Ze(c,"setresult",!1),fullAccessClipboardOperationResult:Ze(c,"setresult",!1)};return this.dualClipboardDataProcessor&&this.dualClipboardDataProcessor.preSetProcess(e),this.systemClipboardStrategy.set(e,t).then((()=>Promise.resolve(r)),(e=>(r.systemClipboardOperationResult.failed=!0,r.systemClipboardOperationResult.clipboardOperationResultError=e,S(e,[m.RejectingPendingCutCopyPromiseDueToNewCutCopyOperation,m.RejectingBlockedSyncCutCopyPromise])?Promise.reject(e):Promise.resolve(r)))).then((r=>this.fullAccessClipboardStrategy?this.fullAccessClipboardStrategy.set(e,t).then((()=>Promise.resolve(r)),(e=>(s().ULS.traceTag(595933078,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`Failed to save to fullAccessClipboardStrategy. clipboardStrategyType: '${this.fullAccessClipboardStrategy&&this.fullAccessClipboardStrategy.clipboardStrategyType}', Command Id: '${t.id?t.id:l}', Error: ${o.Wp.getStringifiedError(e)}`),r.fullAccessClipboardOperationResult.failed=!0,r.fullAccessClipboardOperationResult.clipboardOperationResultError=e,Promise.resolve(r)))):(r.fullAccessClipboardOperationResult.failed=!0,Promise.resolve(r)))).then((e=>{if(e.systemClipboardOperationResult.failed&&e.fullAccessClipboardOperationResult.failed){let t=e.systemClipboardOperationResult.clipboardOperationResultError;return t||(t=e.fullAccessClipboardOperationResult.clipboardOperationResultError),t?Promise.reject(t):Promise.reject(new M(m.SetClipboardItems,l))}return Promise.resolve()}))}catch(e){return Promise.reject(new M(m.SetClipboardItems,"Failed in system clipboard.set",e))}}get(e){try{if(this.disposableImplementationExtension.throwIfDisposed("get"),!this.initialized||!this.systemClipboardStrategy)return Promise.reject(new M(m.ClipboardStrategyNotInitialized));const t={systemClipboardOperationResult:Ze(c,"getresult",!1,void 0,{items:{}}),fullAccessClipboardOperationResult:Ze(c,"getresult",!1,void 0,{items:{}})};return this.systemClipboardStrategy.get(e).then((e=>(t.systemClipboardOperationResult.clipboardItemsData=e.getData(),this.dualClipboardDataProcessor&&this.dualClipboardDataProcessor.postGetProcess(t.systemClipboardOperationResult),Promise.resolve(t)))).catch((r=>(s().ULS.traceTag(507904974,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Failed to get data from systemClipboardStrategy. clipboardStrategyType: '${this.systemClipboardStrategy&&this.systemClipboardStrategy.clipboardStrategyType}', Command Id: '${e.id?e.id:l}', Error: ${o.Wp.getStringifiedError(r)}`),t.systemClipboardOperationResult.failed=!0,t.systemClipboardOperationResult.clipboardOperationResultError=r,f(r,m.RejectingPendingPastePromiseDueToNewPasteOperation)?Promise.reject(r):Promise.resolve(t)))).then((t=>this.fullAccessClipboardStrategy?this.fullAccessClipboardStrategy.get(e).then((e=>(t.fullAccessClipboardOperationResult.clipboardItemsData=e.getData(),this.dualClipboardDataProcessor&&this.dualClipboardDataProcessor.postGetProcess(t.fullAccessClipboardOperationResult),Promise.resolve(t)))).catch((r=>(s().ULS.traceTag(595933079,o.nh.msoulscat_ES_EWAJS,o.kp.Warning,`Failed to get from fullAccessClipboardStrategy. clipboardStrategyType: '${this.fullAccessClipboardStrategy&&this.fullAccessClipboardStrategy.clipboardStrategyType}', Command Id: '${e.id?e.id:l}', Error: ${o.Wp.getStringifiedError(r)}`),t.fullAccessClipboardOperationResult.failed=!0,t.fullAccessClipboardOperationResult.clipboardOperationResultError=r,Promise.resolve(t)))):(t.fullAccessClipboardOperationResult.failed=!0,Promise.resolve(t)))).then((t=>{if(t.systemClipboardOperationResult.failed||e.skipSystemClipboardAccess){if(t.fullAccessClipboardOperationResult.failed){let e=t.systemClipboardOperationResult.clipboardOperationResultError;return e||(e=t.fullAccessClipboardOperationResult.clipboardOperationResultError),e?Promise.reject(e):Promise.reject(new M(m.GetClipboardItems,l))}return 0===oe(t.fullAccessClipboardOperationResult.clipboardItemsData)?Promise.reject(t.systemClipboardOperationResult.clipboardOperationResultError):this.validateAndReturnFullAccessData(t)}return t.fullAccessClipboardOperationResult.failed?Promise.resolve(se(t.systemClipboardOperationResult.clipboardItemsData)):!z()||z()&&R.isEdgeWithTextHtmlClipboardSupportProperty?this.pasteSourceReconciliation(t,e):this.pasteSourceReconciliationBasedOnlyOnTextPlain(t)}))}catch(e){return Promise.reject(new M(m.GetClipboardItems,"Failed in system clipboard.get",e))}}onSystemClipboardChangedExternally(e){try{return this.disposableImplementationExtension.throwIfDisposed("onSystemClipboardChangedExternally"),this.initialized?this.fullAccessClipboardStrategy?this.fullAccessClipboardStrategy.onSystemClipboardChangedExternally(e):(s().ULS.shipAssertTag(595882509,o.nh.msoulscat_ES_EWAJS,!1,"ClipboardStrategyBase.onSystemClipboardChangedExternally: this.fullAccessClipboardStrategy should be defined"),Promise.reject(new M(m.ClipboardStrategyNotInitialized))):Promise.reject(new M(m.ClipboardStrategyNotInitialized))}catch(e){return Promise.reject(new M(m.ClearClipboardItems,`Failed in (clipboard ${this.clipboardStrategyType}).onSystemClipboardChangedExternally`,e))}}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(k([()=>{this.systemClipboardStrategy&&this.systemClipboardStrategy.dispose()},()=>{this.fullAccessClipboardStrategy&&this.fullAccessClipboardStrategy.dispose()}]),this.disposableImplementationExtension.dispose())}pasteSourceReconciliation(e,t){let r,a,i;return e.systemClipboardOperationResult.signatureData&&(r=e.systemClipboardOperationResult.signatureData.ccp_infra_timestamp),e.fullAccessClipboardOperationResult.signatureData&&(a=e.fullAccessClipboardOperationResult.signatureData.ccp_infra_timestamp),s().ULS.traceTag(595719624,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`systemClipboardAndFullAccessClipboardStrategy.pasteSourceReconciliation: ccpTimestampInSystemClipboard=${r} ccpTimestampInFullAccessClipboard=${a}`),r?(i=a||0,r>i?($i(e.systemClipboardOperationResult.clipboardItemsData,!0),Promise.resolve(se(e.systemClipboardOperationResult.clipboardItemsData))):Promise.resolve(se(e.fullAccessClipboardOperationResult.clipboardItemsData))):t.isTimestampStoredInSystemClipboard&&Ri(e)?Promise.resolve(se(e.fullAccessClipboardOperationResult.clipboardItemsData)):Oi(e)?this.validateAndReturnFullAccessData(e):($i(e.systemClipboardOperationResult.clipboardItemsData,!1),Promise.resolve(se(e.systemClipboardOperationResult.clipboardItemsData)))}validateAndReturnFullAccessData(e){return this.dualClipboardDataProcessor&&this.dualClipboardDataProcessor.validateUserHash(e.fullAccessClipboardOperationResult.signatureData),Promise.resolve(se(e.fullAccessClipboardOperationResult.clipboardItemsData))}pasteSourceReconciliationBasedOnlyOnTextPlain(e){return 0===oe(e.systemClipboardOperationResult.clipboardItemsData)||0===oe(e.fullAccessClipboardOperationResult.clipboardItemsData)?Promise.resolve(se(e.systemClipboardOperationResult.clipboardItemsData)):Ri(e)?Promise.resolve(se(e.fullAccessClipboardOperationResult.clipboardItemsData)):Oi(e)?this.validateAndReturnFullAccessData(e):(e.systemClipboardOperationResult.clipboardItemsData.items[ee]="1",Promise.resolve(se(e.systemClipboardOperationResult.clipboardItemsData)))}constructor(e,t,r,a){this.clipboardStrategyType=e,this.clipboardCapabilities=t,this._fullAccessClipboardStrategyType=r,this.dualClipboardDataProcessor=a,this.initialized=!1,this.clipboardStrategyType=e,this.clipboardCapabilities=t,this.disposableImplementationExtension=Xe(`${e}`)}}function $i(e,t){e.items[ee]="1",t&&(e.items["metadata/is-last-copy-was-external-XLO-source"]="1")}function Ri(e){const t=Br(Gr(e.systemClipboardOperationResult.clipboardItemsData.items[Z])),r=e.fullAccessClipboardOperationResult.clipboardItemsData.items[Z];return!!r&&t===Br(Gr(r))}function Oi(e){return Br(Gr(e.systemClipboardOperationResult.clipboardItemsData.items[Z]))===Xi().getCopyToClipboardLatencyMessage()}class Ui extends Wi{constructor(e){super(d.SystemClipboardAndLocalStorage,{browserStorage:!0,systemClipboard:!0,inMemory:!1},d.LocalStorage,e)}}class Fi extends Wi{constructor(e){super(d.SystemClipboardAndInMemory,{browserStorage:!1,systemClipboard:!0,inMemory:!0},d.InMemory,e)}}class Ni extends xa{initialize(){return this.innerInitialize().then((()=>this))}get(e){this.disposableImplementationExtension.throwIfDisposed("get"),s().ULS.traceTag(595947538,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`ClipboardStorageIframeProxy.get: isKeyboardEvent = ${e.isKeyboardEvent}; silentClipboardAccessFailures = ${e.silentClipboardAccessFailures||!1}`);const t=Ge(Ve(),"get",this.messageDestination,e.userHash);return this.postMessage(t,"get").then((e=>e.clipboardItemsData?Promise.resolve(se(e.clipboardItemsData)):Promise.resolve(ie())))}set(e,t){let r;return this.disposableImplementationExtension.throwIfDisposed("set"),s().ULS.traceTag(595947541,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`ClipboardStorageIframeProxy.set: isKeyboardEvent = ${t.isKeyboardEvent}; silentClipboardAccessFailures = ${t.silentClipboardAccessFailures||!1}`),r=ne(e)>0?Ge(Ve(),"set",this.messageDestination,t.userHash,e.getData()):Ge(Ve(),"set",this.messageDestination),this.postMessage(r,"set").then((()=>{}))}clearClipboardNecessary(e,t){return function(e,t){return null==e||1===e||null==t||e!==t}(e,t)}getSupportedDataFormats(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[Z,X,"data/shadow-workbook"]}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()}constructor(e,t){if(super(),this.messageDestination=t,!t)throw new w(l,"messageDestination");this.clipboardStorageType=e,this.disposableImplementationExtension=Xe(t)}}class Ji extends Ni{constructor(e){super(ge.LocalStorage,e)}}class zi extends Qe{constructor(e){super(d.AsyncSystemClipboard,{browserStorage:!1,systemClipboard:!0,inMemory:!1},e)}}class ji{async get(e){if(this.disposableImplementationExtension.throwIfDisposed("get"),e.isAsyncClipboardAPI=!0,e.skipSystemClipboardAccess)return Promise.resolve(ie());const t={name:"clipboard-read",allowWithoutGesture:!1};try{const r=await(navigator.permissions?.query(t));e.asyncClipboardReadPermissionState=r?.state,s().ULS.traceTag(507626376,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.get - Clipboard read permission state: ${r?.state}. Command id: ${e.id}`),this.initialClipboardPermissionState=r?.state,"prompt"===r?.state&&(this.isActionPerformedOnPermissionPrompt=!1,r.onchange=()=>{e.asyncClipboardReadPermissionUpdatedState=r?.state,this.isActionPerformedOnPermissionPrompt=!0,"denied"===r?.state?s().ULS.traceTag(507626375,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.get - Clipboard read permission is denied from prompt. Command id: ${e.id}`):"granted"===r?.state&&s().ULS.traceTag(507626374,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.get - Clipboard read permission is granted from prompt. Command id: ${e.id}`)})}catch(t){e.asyncClipboardReadPermissionState=`Failed to query "clipboard-read" permission. Error: ${o.Wp.getStringifiedError(t)}`,s().ULS.traceTag(508651269,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.get: Failed to query "clipboard-read" permission. Command id: ${e.id}, Error: ${o.Wp.getStringifiedError(t)}`)}return await this.readFromSystemClipboard(e)}async set(e,t){this.disposableImplementationExtension.throwIfDisposed("set"),t.isAsyncClipboardAPI=!0;const r=this.getSupportedDataFormats();try{const a={name:"clipboard-write",allowWithoutGesture:!0};try{const e=await(navigator.permissions?.query(a));t.asyncClipboardWritePermissionState=e?.state,s().ULS.traceTag(507626372,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.set - Clipboard write permission state: ${e?.state}. Command id: ${t.id}`),this.initialClipboardPermissionState=e?.state,"prompt"===e?.state&&(this.isActionPerformedOnPermissionPrompt=!1,e.onchange=()=>{t.asyncClipboardWritePermissionUpdatedState=e?.state,this.isActionPerformedOnPermissionPrompt=!0,"denied"===e?.state?s().ULS.traceTag(507626371,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.set - Clipboard write permission is denied from prompt. Command id: ${t.id}`):"granted"===e?.state&&s().ULS.traceTag(507626370,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.set - Clipboard write permission is granted from prompt. Command id: ${t.id}`)})}catch(e){t.asyncClipboardWritePermissionState=`Failed to query "clipboard-write" permission. Error: ${o.Wp.getStringifiedError(e)}`,s().ULS.traceTag(508651268,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.set: Failed to query "clipboard-write" permission. Command id: ${t.id}, Error: ${o.Wp.getStringifiedError(e)}`)}const i=me(e);if(!i||i.length<1)return;const n={};for(const e of i){if(!r.includes(e.clipboardDataFormat))continue;let t;t=e.deferred?e.data:new Blob([e.data],{type:e.clipboardDataFormat});const a=r.includes(`${this.webCustomFormatPrefix}${e.clipboardDataFormat}`);a&&this.isAsyncClipboardEnhancementsEnabled?n[`${this.webCustomFormatPrefix}${e.clipboardDataFormat}`]=t:a||(n[e.clipboardDataFormat]=t)}const l=new ClipboardItem(n,{unsanitized:[X]});t.timeElapsedBeforeAsyncClipboardWrite=t.stopwatch?.getElapsedTime?.(),t.isDocumentFocusedBeforeAsyncClipboardWrite=document.hasFocus?.(),t.isTransientUserActiveBeforeAsyncClipboardWrite=navigator?.userActivation?.isActive,await navigator.clipboard.write([l]);const c=t.stopwatch?.getElapsedTime?.();t.asyncClipboardWriteDuration=c-t.timeElapsedBeforeAsyncClipboardWrite,t.isAsyncClipboardWriteSucceeded=!0,s().ULS.traceTag(508703872,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.set: Write successful. Command id: ${t.id}, TimeElapsedBeforeClipboardWrite: ${t.timeElapsedBeforeAsyncClipboardWrite}ms, ClipboardWriteDurationInMs: ${t.asyncClipboardWriteDuration}ms, IsDocumentFocused: ${t.isDocumentFocusedBeforeAsyncClipboardWrite}, IsTransientUserActive: ${t.isTransientUserActiveBeforeAsyncClipboardWrite}`),t.isTimestampStoredInSystemClipboard=!0}catch(e){if(!t.id&&t.silentClipboardAccessFailures)return void s().ULS.traceTag(506009493,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.set: Failed to write data formats to system clipboard in Non-Copy flow. Error: ${o.Wp.getStringifiedError(e)}`);throw t.isAsyncClipboardWriteSucceeded=!1,t.asyncClipboardWriteErrorMessage=o.Wp.getStringifiedError(e),"prompt"!==this.initialClipboardPermissionState||this.isActionPerformedOnPermissionPrompt||s().ULS.traceTag(507626369,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.set - Clipboard write permission prompt is closed without any action. Command id: ${t.id}`),s().ULS.traceTag(508843076,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.set: Failed to write data formats to system clipboard. Command id: ${t.id}, Error: ${o.Wp.getStringifiedError(e)}, TimeElapsedBeforeClipboardWrite: ${t.timeElapsedBeforeAsyncClipboardWrite}ms, IsDocumentFocused: ${t.isDocumentFocusedBeforeAsyncClipboardWrite}, IsTransientUserActive: ${t.isTransientUserActiveBeforeAsyncClipboardWrite}`),this.isAsyncClipboardEnhancementsEnabled?e?.message?.includes(this.clipboardWritePermissionDeniedErrorMessage)?new M(m.ClipboardIsInaccessible,`AsyncSystemClipboardStorage.set - Clipboard permission is denied. Command id: ${t.id}`,e):new M(m.AsyncClipboardWriteFailure,`AsyncSystemClipboardStorage.set - Failed to write clipboard items. Command id: ${t.id}`,e):new M(m.ClipboardIsInaccessible,`AsyncSystemClipboardStorage.set - Clipboard permission is denied or failed to write. Command id: ${t.id}`,e)}}getSupportedDataFormats(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[Z,X,Q,"data/shadow-workbook","web data/shadow-workbook","metadata/copy-context","web metadata/copy-context"]}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()}async readFromSystemClipboard(e){const t=se();try{e.timeElapsedBeforeAsyncClipboardRead=e.stopwatch?.getElapsedTime?.(),e.isDocumentFocusedBeforeAsyncClipboardRead=document.hasFocus?.(),e.isTransientUserActiveBeforeAsyncClipboardRead=navigator?.userActivation?.isActive;const a=await navigator.clipboard.read({unsanitized:[X]}),i=e.stopwatch?.getElapsedTime?.();e.isAsyncClipboardReadSucceeded=!0,e.asyncClipboardReadDuration=i-e.timeElapsedBeforeAsyncClipboardRead,s().ULS.traceTag(506017227,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.readFromSystemClipboard: Read successful, Command id: ${e.id}, isKeyboardEvent: ${e.isKeyboardEvent}, TimeElapsedBeforeClipboardRead: ${e.timeElapsedBeforeAsyncClipboardRead}ms, ClipboardReadDurationInMs: ${e.asyncClipboardReadDuration}ms, IsDocumentFocused: ${e.isDocumentFocusedBeforeAsyncClipboardRead}, IsTransientUserActive: ${e.isTransientUserActiveBeforeAsyncClipboardRead}`);const n=this.getSupportedDataFormats();if(!a||a.length<1)return t;for(const i of a)for(const a of i.types){if(!n.includes(a))continue;const l=await i.getType(a);if(!l){s().ULS.traceTag(506840981,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.readFromSystemClipboard: Failed to read blob for '${a}' type, Command id: ${e.id}, isKeyboardEvent: ${e.isKeyboardEvent}`);continue}let c;c=a===Q?await(r=l,ni(r)):await l.text();const d=a.startsWith(this.webCustomFormatPrefix);d&&this.isAsyncClipboardEnhancementsEnabled?t.setItem(a.replace(this.webCustomFormatPrefix,""),c):d||t.setItem(a,c)}}catch(r){if(e.isAsyncClipboardReadSucceeded=!1,e.asyncClipboardReadErrorMessage=o.Wp.getStringifiedError(r),"prompt"!==this.initialClipboardPermissionState||this.isActionPerformedOnPermissionPrompt||e.isKeyboardEvent||s().ULS.traceTag(507626373,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.readFromSystemClipboard - Clipboard read permission prompt is closed without any action. Command id: ${e.id}`),r.name===this.emptyClipboardReadErrorName&&r.message===this.emptyClipboardReadErrorMessage)return s().ULS.traceTag(508352130,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.readFromSystemClipboard: System clipboard is empty. Command id: ${e.id}, Error: ${o.Wp.getStringifiedError(r)}`),t;if(s().ULS.traceTag(508843077,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`AsyncSystemClipboardStorage.readFromSystemClipboard: Failed to read data formats from system clipboard. Command id: ${e.id}, IsKeyboardEvent: ${e.isKeyboardEvent}, Error: ${o.Wp.getStringifiedError(r)}, TimeElapsedBeforeClipboardRead: ${e.timeElapsedBeforeAsyncClipboardRead}ms, IsDocumentFocused: ${e.isDocumentFocusedBeforeAsyncClipboardRead}, IsTransientUserActive: ${e.isTransientUserActiveBeforeAsyncClipboardRead}`),this.isAsyncClipboardEnhancementsEnabled)throw r?.message?.includes(this.clipboardReadPermissionDeniedErrorMessage)?new M(m.ClipboardIsInaccessible,`AsyncSystemClipboardStorage.readFromSystemClipboard - Clipboard read permission is denied. Command id: ${e.id}`,r):new M(m.AsyncClipboardReadFailure,`AsyncSystemClipboardStorage.readFromSystemClipboard - Failed to read clipboard items. Command id: ${e.id}`,r);throw new M(m.ClipboardIsInaccessible,`AsyncSystemClipboardStorage.readFromSystemClipboard - Clipboard permission is denied or failed to read. Command id: ${e.id}`,r)}finally{e.clearSystemClipboard&&this.clearSystemClipboard()}var r;return t}async clearSystemClipboard(){try{await navigator.clipboard.writeText(""),s().ULS.traceTag(508703843,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"AsyncSystemClipboardStorage.clearSystemClipboard: Clipboard cleared")}catch(e){s().ULS.traceTag(508703842,o.nh.msoulscat_ES_EWAJS,o.kp.Info,"AsyncSystemClipboardStorage.clearSystemClipboard: Failed to clear system clipboard.")}}constructor(){this.initialClipboardPermissionState=null,this.isActionPerformedOnPermissionPrompt=!1,this.webCustomFormatPrefix="web ",this.emptyClipboardReadErrorName="DataError",this.clipboardReadPermissionDeniedErrorMessage="Read permission denied",this.clipboardWritePermissionDeniedErrorMessage="Write permission denied",this.emptyClipboardReadErrorMessage="No valid data on clipboard.",this.clipboardPermissionDeniedErrorMessage="AsyncSystemClipboardStorage - Clipboard permission is denied",this.clipboardIsInaccessibleError=new M(m.ClipboardIsInaccessible,this.clipboardPermissionDeniedErrorMessage),this.isAsyncClipboardEnhancementsEnabled=!1,this.clipboardStorageType=ge.AsyncSystemClipboard,this.disposableImplementationExtension=Xe("AsyncSystemClipboardStorage"),this.isAsyncClipboardEnhancementsEnabled=Li("Microsoft.Office.Excel.AsyncClipboardEnhancements",!1)}}class Hi extends Wi{constructor(e){super(d.AsyncSystemClipboardAndLocalStorage,{browserStorage:!0,systemClipboard:!0,inMemory:!1},d.LocalStorage,e)}}class Vi{async initialize(e,t){this.initialized=!1;const[r,a]=await Promise.all([e,t]);return this.systemClipboardStorage=r,this.asyncSystemClipboardStorage=a,this.initialized=!0,this}async get(e){this.disposableImplementationExtension.throwIfDisposed("get");const t=window.performance.now();if(!this.initialized||!this.asyncSystemClipboardStorage||!this.systemClipboardStorage)throw new M(m.ClipboardStrategyNotInitialized);try{return await this.systemClipboardStorage.get(e)}catch(t){s().ULS.traceTag(508154642,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`CombinedSystemClipboardStorage.get - systemClipboardStorage get failed. Command id: ${e.id}, Error: ${o.Wp.getStringifiedError(t)}`);try{return await this.asyncSystemClipboardStorage.get(e)}catch(t){throw s().ULS.traceTag(507904976,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`CombinedSystemClipboardStorage.get - asyncSystemClipboardStorage get failed. Command id: ${e.id}, Error: ${o.Wp.getStringifiedError(t)}`),new M(m.ClipboardIsInaccessible,"CombinedSystemClipboardStorage.get - Clipboard permission is denied or failed to read",t)}}finally{s().ULS.traceTag(508154640,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`CombinedSystemClipboardStorage.get | System clipboard total read time: ${window.performance.now()-t} ms, Command id: ${e.id}`)}}async set(e,t){this.disposableImplementationExtension.throwIfDisposed("set");const r=window.performance.now();if(!this.initialized||!this.asyncSystemClipboardStorage||!this.systemClipboardStorage)throw new M(m.ClipboardStrategyNotInitialized);try{return void await this.systemClipboardStorage.set(e,t)}catch(r){s().ULS.traceTag(508154638,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`CombinedSystemClipboardStorage.set - systemClipboardStorage set failed. Command id: ${t.id}, Error: ${o.Wp.getStringifiedError(r)}`);try{return void await this.asyncSystemClipboardStorage.set(e,t)}catch(e){throw s().ULS.traceTag(507904975,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`CombinedSystemClipboardStorage.set - asyncSystemClipboardStorage set failed. Command id: ${t.id}, Error: ${o.Wp.getStringifiedError(e)}`),new M(m.ClipboardIsInaccessible,"CombinedSystemClipboardStorage.set - Clipboard permission is denied or failed to write",e)}}finally{s().ULS.traceTag(508154637,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`CombinedSystemClipboardStorage.set - System clipboard total write time: ${window.performance.now()-r} ms, Command id: ${t.id}`)}}getSupportedDataFormats(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[...this.systemClipboardStorage?.getSupportedDataFormats()??[],...this.asyncSystemClipboardStorage?.getSupportedDataFormats()??[]].reduce(((e,t)=>(-1===e.indexOf(t)&&e.push(t),e)),[])}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()}constructor(){this.initialized=!1,this.clipboardStorageType=ge.AsyncSystemClipboard,this.disposableImplementationExtension=Xe("CombinedSystemClipboardStorage")}}class Bi extends Wi{constructor(e){super(d.AsyncSystemClipboardAndInMemory,{browserStorage:!1,systemClipboard:!0,inMemory:!0},d.InMemory,e)}}class Gi{async initialize(e,t,r){const[a,i]=await Promise.all([e,t]);return this.primarySystemClipboardStrategy=a,this.secondarySystemClipboardStrategy=i,this.currentSystemClipboardStrategy=a,this.initialized=!0,this.isAsyncClipboardRoamingSettingsEnabled&&r&&queueMicrotask((()=>{this.switchToSecondaryStrategyIfClipboardPermissionDenied(r)})),this}async set(e,t){if(this.disposableImplementationExtension.throwIfDisposed("set"),!this.initialized)throw new M(m.ClipboardStrategyNotInitialized);try{return void await this.currentSystemClipboardStrategy.set(e,t)}catch(e){throw this.handleClipboardStrategyFailure(t,e),e}}async get(e){if(this.disposableImplementationExtension.throwIfDisposed("get"),!this.initialized)throw new M(m.ClipboardStrategyNotInitialized);try{return await this.currentSystemClipboardStrategy.get(e)}catch(t){throw this.handleClipboardStrategyFailure(e,t),t}}onSystemClipboardChangedExternally(e){if(this.disposableImplementationExtension.throwIfDisposed("onSystemClipboardChangedExternally"),!this.initialized)throw new M(m.ClipboardStrategyNotInitialized);return this.currentSystemClipboardStrategy.onSystemClipboardChangedExternally(e)}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(this.primarySystemClipboardStrategy?.dispose(),this.secondarySystemClipboardStrategy?.dispose(),this.initialized=!1,this.primarySystemClipboardStrategy=null,this.secondarySystemClipboardStrategy=null,this.currentSystemClipboardStrategy=null,this.disposableImplementationExtension.dispose())}async switchToSecondaryStrategyIfClipboardPermissionDenied(e){try{await e&&this.currentSystemClipboardStrategy===this.primarySystemClipboardStrategy&&this.switchToSecondaryStrategy(void 0,!0)}catch(e){s().ULS.traceTag(504739846,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`CircuitBreakerSystemClipboardStrategy.switchToSecondaryStrategyIfClipboardPermissionDenied: Error while switching clipboard strategy: ${e}`)}}handleClipboardStrategyFailure(e,t){const r=t;this.currentSystemClipboardStrategy===this.primarySystemClipboardStrategy&&r.reason===m.ClipboardIsInaccessible&&(this.errorCount++,this.errorCount>=this.circuitBreakerThreshold&&this.switchToSecondaryStrategy(e))}switchToSecondaryStrategy(e,t){this.currentSystemClipboardStrategy=this.secondarySystemClipboardStrategy,e&&(e.dataClipboardStrategyType=this.secondarySystemClipboardStrategy?.clipboardStrategyType),s().ULS.traceTag(505520142,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`Switched to secondary system clipboard strategy. isAppBootPhase: ${!!t}`)}constructor(){this.initialized=!1,this.primarySystemClipboardStrategy=null,this.secondarySystemClipboardStrategy=null,this.currentSystemClipboardStrategy=null,this.circuitBreakerThreshold=1,this.errorCount=0,this.clipboardStrategyType=d.AsyncSystemClipboard,this.clipboardCapabilities={browserStorage:!0,systemClipboard:!0,inMemory:!1},this.disposableImplementationExtension=Xe("CircuitBreakerSystemClipboardStrategy"),this.isAsyncClipboardRoamingSettingsEnabled=Li("Microsoft.Office.Excel.AsyncClipboardRoamingSettings",!1)}}function Ki(e){return new Di(e)}function qi(){return new ji}function Zi(e,t,r,a,i,n,c){const p=function(e,t,r){return new ga(e,t,r)}(r,a,i);return function(e,t,r,a,i){let n=Se.NoError;return o.Wp.chainFallbackPromises(e,(e=>function(e,t,r,a,i){s().ULS.traceTag(595716231,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`clipboardPlatformEnvironmentFactory.createClipboardEnvironmentComponentsByType: Attempting to create clipboard strategy type '${e.clipboardStrategyType}'`);const n=()=>(()=>{switch(e.clipboardStrategyType){case d.SystemClipboard:case d.SystemClipboardAndInMemory:case d.AsyncSystemClipboard:case d.AsyncSystemClipboardAndInMemory:return e;case d.SystemClipboardAndLocalStorage:case d.AsyncSystemClipboardAndLocalStorage:return e.systemClipboardStrategyParameters;default:throw new P(`createClipboardEnvironmentComponentsByType: getSystemClipboardParameters couldn't be used for ${e.clipboardStrategyType}`)}})().skipFilesIfPlainTextExists,c=()=>{switch(e.clipboardStrategyType){case d.LocalStorage:return e;case d.AsyncSystemClipboard:case d.AsyncSystemClipboardAndInMemory:case d.SystemClipboardAndLocalStorage:case d.AsyncSystemClipboardAndLocalStorage:return e.localStorageStrategyParameters;default:throw new P(`createClipboardEnvironmentComponentsByType: getLocalStorageParameters couldn't be used for ${e.clipboardStrategyType}`)}},p=e=>r.createClipboardDataProcessor(e),u=()=>r.createClipboardMetaDataProcessor(),g=e=>r.createDualClipboardDataProcessor(e),h=()=>{const e=c();return e.useSharedClipboardIframe?new ka:function(e){return new Ma(e)}(Ct(e.sharedClipboardSchemaVersion)+yt)},f=(e,r)=>(r?r.initialize(e):Promise.resolve(void 0)).then((()=>function(e,t,r){return s().ULS.shipAssertTag(595945246,o.nh.msoulscat_ES_EWAJS,!!e,"MetadataManager.createMetadataManager: expected clipboardStrategy to be defined."),s().ULS.shipAssertTag(595945247,o.nh.msoulscat_ES_EWAJS,!!e,"MetadataManager.createMetadataManager: expected metadataSerializationHelper to be defined."),ta=e,ra=function(e){return Qr=e,ea}(t),aa=r,aa&&aa.setOnMetadataChangedListener(la),sa}(e,t,r))),S=e=>{let t;return t=Li("Microsoft.Office.Excel.AsyncClipboardEnhancements",!1)?Promise.resolve(qi()):Promise.resolve((new Vi).initialize(Promise.resolve(Ki(n())),Promise.resolve(qi()))),function(e){return new zi(e)}(e).initialize(t)},b=()=>(new Wa).initialize(Promise.resolve(Ki(n()))),y=e=>function(e){return new xi(e)}(e).initialize(Promise.resolve(new Mi)),C=e=>{const t={};e.wacCluster&&(t.wacCluster=e.wacCluster.trim()),e.sessionId&&(t.sessionId=e.sessionId),a&&(t.bulsEndpointUrl=a);const r=e.sharedClipboardOverrideOrigin?1:0;var i;i={sharedClipboardHostingApp:e.sharedClipboardHostingApp,sharedClipboardHostingApps:e.sharedClipboardHostingApps,sharedClipboardHostingEnvironments:e.sharedClipboardHostingEnvironments,sharedClipboardSchemaVersion:e.sharedClipboardSchemaVersion,sharedClipboardExpirationInMinutes:e.sharedClipboardExpirationInMinutes,clipboardPromiseTimeoutInMinutes:e.sharedClipboardExpirationInMinutes,whitelistOriginComponents:r},Ie=!1,function(e){if(!e)throw new w(l,"sharedClipboardSettingsCandidate");const t=Ae();if("number"!=typeof e.sharedClipboardSchemaVersion||isNaN(e.sharedClipboardSchemaVersion)||(t.sharedClipboardSchemaVersion=e.sharedClipboardSchemaVersion),"number"!=typeof e.sharedClipboardExpirationInMinutes||isNaN(e.sharedClipboardExpirationInMinutes)||(t.sharedClipboardExpirationInMinutes=e.sharedClipboardExpirationInMinutes),"number"!=typeof e.clipboardPromiseTimeoutInMinutes||isNaN(e.clipboardPromiseTimeoutInMinutes)||(t.clipboardPromiseTimeoutInMinutes=e.clipboardPromiseTimeoutInMinutes),"string"==typeof e.remoteLoggerPath&&e.remoteLoggerPath&&e.remoteLoggerPath.trim()&&(t.remoteLoggerPath=e.remoteLoggerPath),"number"!=typeof e.whitelistOriginComponents||1!==e.whitelistOriginComponents)return Te=t,void(Ie=!0);if("string"!=typeof e.sharedClipboardHostingApp||!e.sharedClipboardHostingApp||!e.sharedClipboardHostingApp.trim())return s().ULS.traceTag(596124181,o.nh.msoulscat_ES_EWAJS,o.kp.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApp should be a non empty string"),Te=t,void(Ie=!0);t.sharedClipboardHostingApp=e.sharedClipboardHostingApp.trim();let r=t.sharedClipboardHostingApp;const a=r.indexOf(Ce);a>=0&&(r=r.substr(a+1));try{t.sharedClipboardHostingApps=e.sharedClipboardHostingApps?JSON.parse(e.sharedClipboardHostingApps):void 0}catch{s().ULS.traceTag(579737680,o.nh.msoulscat_ES_EWAJS,o.kp.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApps JSON parsing failed. String : "+e.sharedClipboardHostingApps)}if(!t.sharedClipboardHostingApps||!Array.isArray(t.sharedClipboardHostingApps)||0===t.sharedClipboardHostingApps.length||t.sharedClipboardHostingApps.some((e=>!e||!e.trim())))return s().ULS.traceTag(596124182,o.nh.msoulscat_ES_EWAJS,o.kp.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApps should be a JSON string representing an array with at list one app"),t.sharedClipboardHostingApp=l,t.sharedClipboardHostingApps=[],Te=t,void(Ie=!0);try{t.sharedClipboardHostingEnvironments=e.sharedClipboardHostingEnvironments?JSON.parse(e.sharedClipboardHostingEnvironments):void 0}catch{s().ULS.traceTag(579737681,o.nh.msoulscat_ES_EWAJS,o.kp.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingEnvironments JSON parsing failed. String : "+e.sharedClipboardHostingEnvironments)}if(!t.sharedClipboardHostingEnvironments||!Array.isArray(t.sharedClipboardHostingEnvironments)||0===t.sharedClipboardHostingEnvironments.length||t.sharedClipboardHostingEnvironments.some((e=>!e||!e.trim())))return s().ULS.traceTag(596124183,o.nh.msoulscat_ES_EWAJS,o.kp.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingEnvironments should be a JSON string representing an array with at list one environment"),t.sharedClipboardHostingApp=l,t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],Te=t,void(Ie=!0);if(t.sharedClipboardHostingApps.indexOf(t.sharedClipboardHostingApp)<0){if(t.sharedClipboardHostingApp===r)return s().ULS.traceTag(596124184,o.nh.msoulscat_ES_EWAJS,o.kp.Error,`sharedClipboardSettings.initialize: when sharedClipboardHostingApp is defined, then its app name component '${t.sharedClipboardHostingApp}' should be listed in sharedClipboardHostingApps`),t.sharedClipboardHostingApp=l,t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],Te=t,void(Ie=!0);if(t.sharedClipboardHostingApps.indexOf(r)<0)return s().ULS.traceTag(596124185,o.nh.msoulscat_ES_EWAJS,o.kp.Error,`sharedClipboardSettings.initialize: when sharedClipboardHostingApp is defined, then its app name component '${t.sharedClipboardHostingApp}' or '${r}' should be listed in sharedClipboardHostingApps`),t.sharedClipboardHostingApp=l,t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],Te=t,void(Ie=!0)}t.whitelistOriginComponents=!0,Te=t,Ie=!0}(i),function(e){s().ULS.shipAssertTag(595944468,o.nh.msoulscat_ES_EWAJS,!!e,"ClipboardPlatformSettings.setClipboardPlatformSettings: expect clipboardPlatformSettings to be defined."),Yr=e}(t)},E=(e,t)=>{const r=c();return r.useSharedClipboardIframe?(C(r),function(e){return new ki(e)}(t).initialize((a=e?Ke.localStorageMetadata:Ke.localStorageData,new Ji(a)).initialize())):function(e){return new It(e)}(t).initialize(Promise.resolve((i=e?Ct(r.sharedClipboardSchemaVersion):(o=r.sharedClipboardSchemaVersion,bt+o),new Tt(i))));var a,i,o},_=()=>{return(e=g(!0),new Ui(e)).initialize(b(),E(!1));var e},T=(e,t,r)=>Promise.all([e,t]).then((([e,t])=>f(t,r).then((t=>({dataClipboardStrategy:e,metadataManager:t})))));try{switch(e.clipboardStrategyType){case d.AsyncSystemClipboard:return T((e=>{const t=p(!1);return(new Gi).initialize(S(t),_(),e)})(i),E(!0,u()),h());case d.SystemClipboard:return T(b(),y(u()));case d.InMemory:return T(y(p(!1)),y(u()));case d.LocalStorage:return T(E(!1,p(!0)),E(!0,u()),h());case d.AsyncSystemClipboardAndLocalStorage:return T((I=g(!0),new Hi(I)).initialize(S(),E(!1)),E(!0,u()),h());case d.AsyncSystemClipboardAndInMemory:return T((()=>{return(e=g(!1),new Bi(e)).initialize(S(),y());var e})(),E(!0,u()),h());case d.SystemClipboardAndLocalStorage:return T(_(),E(!0,u()),h());case d.SystemClipboardAndInMemory:return T((()=>{return(e=g(!1),new Fi(e)).initialize(b(),y());var e})(),y(u()))}return Promise.reject(new M(m.UnsupportedClipboardStrategyType,`Clipboard strategy type '${e.clipboardStrategyType}' is not supported`))}catch(t){return Promise.reject(new M(m.UnsupportedClipboardStrategyType,`failed to create clipboardStrategyType: '${e.clipboardStrategyType}' with error: ${o.Wp.getStringifiedError(t)}`))}var I}(e,t,r,a,i).then((t=>(s().ULS.traceTag(595716294,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`clipboardPlatformEnvironmentFactory.createClipboardEnvironmentComponentsByType: Clipboard strategy type '${e.clipboardStrategyType}' was created.`),t.infraInitializationError=n,t))).catch((t=>{let r=!1;r=b(t),r&&(n=Se.LocalStorageInaccessible);const a=`clipboardPlatformEnvironmentFactory.createClipboardEnvironmentComponentsByType: selectClipboardStrategy: failed to create clipboard strategy type '${e.clipboardStrategyType}'. Error: ${o.Wp.getStringifiedError(t)}`;return s().ULS.traceTag(595716230,o.nh.msoulscat_ES_EWAJS,r?o.kp.Info:o.kp.Error,a),Promise.reject(new M(m.SelectClipboardStrategy,a,t))}))))}(e,t,p,n,c).then((e=>({dataClipboardStrategy:e.dataClipboardStrategy,clipboardDataManager:p,metadataManager:e.metadataManager,infraInitializationError:e.infraInitializationError})))}class Yi{static setFeatureGateManager(e){Pi(e)}}function Xi(){return ro}function Qi(e){Yi.setFeatureGateManager(e)}var eo;!function(e){e[e.NotInitialized=0]="NotInitialized",e[e.StateReady=1]="StateReady",e[e.InitializationSucceed=2]="InitializationSucceed"}(eo||(eo={}));const to={initializationStatus:eo.NotInitialized,stateInitialized:!1,clipboardStrategy:void 0,chromeExtensionIds:[],clipboardPromiseTimeoutInMinutes:_e,copyToClipboardLatencyMessage:"Retrieving data. Wait a few seconds and try to cut or copy again.",metadataManager:void 0,clipboardDataManager:void 0,initializationError:Se.NoError},ro={init:function(e,t,r,a,i,c,d,p,m,u,g,h,f,S,b,y,C,E,_){return to.lastClipboardPlatformEnvironmentInitializationInfo?Promise.resolve(to.lastClipboardPlatformEnvironmentInitializationInfo):(function(e){if(!e)throw new Error("The 'logger' argument is missing");n=o.Hv.getFromExternalLogger(e)}(e),t&&Array.isArray(t)?(s().ULS.traceTag(596455702,o.nh.msoulscat_ES_EWAJS,o.kp.Info,`ClipboardPlatformEnvironment.init: chromeExtensionIds = '${JSON.stringify(t)}'`),to.chromeExtensionIds=function(e){const t=[];if(!e)return t;for(const r of e)r&&"string"==typeof r&&r.trim().length>0&&t.push(r);return t}(t),u&&(to.copyToClipboardLatencyMessage=u),"number"!=typeof m||isNaN(m)||(to.clipboardPromiseTimeoutInMinutes=m),to.initializationStatus=eo.StateReady,Zi(f,h,S,b,y,E,_).then((e=>(to.clipboardDataManager=e.clipboardDataManager,to.metadataManager=e.metadataManager,to.clipboardStrategy=e.dataClipboardStrategy,to.initializationError=e.infraInitializationError,to.initializationStatus=eo.InitializationSucceed,to.lastClipboardPlatformEnvironmentInitializationInfo={clipboardStrategiesToInitialize:f,dataClipboardCapabilities:to.clipboardStrategy&&to.clipboardStrategy.clipboardCapabilities,dataClipboardStrategyType:to.clipboardStrategy&&to.clipboardStrategy.clipboardStrategyType,infraInitializationError:to.initializationError},to.lastClipboardPlatformEnvironmentInitializationInfo)))):Promise.reject(new w(l,"chromeExtensionIds")))},getClipboardStrategy:function(){if(ao(),!to.clipboardStrategy)throw new T("A clipboard strategy has not been selected. Call selectClipboardStrategy.");return to.clipboardStrategy},getChromeExtensionIds:function(){return io(),to.chromeExtensionIds},getClipboardPromiseTimeoutInMinutes:function(){return io(),to.clipboardPromiseTimeoutInMinutes},getCopyToClipboardLatencyMessage:function(){return io(),to.copyToClipboardLatencyMessage},getMetadataManager:function(){return ao(),to.metadataManager},getClipboardDataManager:function(){return ao(),to.clipboardDataManager},getInitializationError:function(){return ao(),to.initializationError}};function ao(){if(to.initializationStatus!==eo.InitializationSucceed)throw new T("ClipboardPlatformEnvironment is not initialized. Call init(...).")}function io(){if(to.initializationStatus<eo.StateReady)throw new T("ClipboardPlatformEnvironment state is not ready. Call init(...).")}clipboardPlatform=a}();
//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/clipboardPlatform.min.js.map/884dcf0c198e21e8989a240167f16cb4/clipboardPlatform.min.js.map